"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4799],{8188:(zs,Lt,Z)=>{Z.d(Lt,{P:()=>je});var _=Z(9212),Se=Z(451),f=Z(6814);function yt(F,Je){if(1&F&&(_.TgZ(0,"ion-label"),_._uU(1),_.qZA()),2&F){const Oe=_.oxw();_.xp6(),_.Oqu(Oe.label)}}function Bt(F,Je){if(1&F&&(_.TgZ(0,"ion-text",3)(1,"strong"),_._uU(2),_.qZA()()),2&F){const Oe=_.oxw();_.xp6(2),_.hij(" ",Oe.text," ")}}function be(F,Je){if(1&F){const Oe=_.EpF();_.TgZ(0,"ion-button",4),_.NdJ("click",function(){_.CHM(Oe);const Ke=_.oxw();return _.KtG(Ke.action(Ke.parameters))}),_._uU(1),_.qZA()}if(2&F){const Oe=_.oxw();_.xp6(),_.hij(" ",Oe.actionTitle," ")}}let je=(()=>{var F;class Je{constructor(){}ngOnInit(){}}return(F=Je).\u0275fac=function($e){return new($e||F)},F.\u0275cmp=_.Xpm({type:F,selectors:[["item-component"]],inputs:{label:"label",text:"text",action:"action",actionTitle:"actionTitle",parameters:"parameters"},decls:4,vars:3,consts:[[4,"ngIf"],["class","ion-text-center","color","tertiary",4,"ngIf"],["expand","block","fill","clear","shape","round","slot","end",3,"click",4,"ngIf"],["color","tertiary",1,"ion-text-center"],["expand","block","fill","clear","shape","round","slot","end",3,"click"]],template:function($e,Ke){1&$e&&(_.TgZ(0,"ion-item"),_.YNc(1,yt,2,1,"ion-label",0)(2,Bt,3,1,"ion-text",1)(3,be,2,1,"ion-button",2),_.qZA()),2&$e&&(_.xp6(),_.Q6J("ngIf",Ke.label),_.xp6(),_.Q6J("ngIf",Ke.text),_.xp6(),_.Q6J("ngIf",Ke.action))},dependencies:[Se.YG,Se.Ie,Se.Q$,Se.yW,f.O5]}),Je})()},2020:(zs,Lt,Z)=>{Z.d(Lt,{J:()=>_i});var _=Z(5861),Se=Z(1145),f=Z(9212),yt=Z(3830),Bt=Z(5370),be=Z(6814),je=Z(95),F=Z(451);function Je(N,$){if(1&N){const Y=f.EpF();f.TgZ(0,"div",3),f.NdJ("click",function(){f.CHM(Y);const b=f.oxw();return f.KtG(b.removeItem())}),f._UZ(1,"ion-icon",4),f.qZA()}}let Oe=(()=>{var N;class ${constructor(){this.showButton=!1}ngOnInit(){}removeItem(){this.callback({listName:this.listName,item:this.player})}}return(N=$).\u0275fac=function(S){return new(S||N)},N.\u0275cmp=f.Xpm({type:N,selectors:[["card-component"]],inputs:{players:"players",player:"player",listName:"listName",callback:"callback",index:"index"},decls:6,vars:4,consts:[[3,"mouseenter","mouseleave"],[3,"alt","src"],["class","deleteButton",3,"click",4,"ngIf"],[1,"deleteButton",3,"click"],["name","trash",1,"ico"]],template:function(S,b){1&S&&(f.TgZ(0,"ion-card",0),f.NdJ("mouseenter",function(){return b.showButton=!0})("mouseleave",function(){return b.showButton=!1}),f._UZ(1,"img",1),f.YNc(2,Je,2,0,"div",2),f.TgZ(3,"ion-card-header")(4,"ion-card-title"),f._uU(5),f.qZA()()()),2&S&&(f.xp6(),f.MGl("alt","",b.player," + picture")("src","https://robohash.org/ + ",b.player,"",f.LSH),f.xp6(),f.Q6J("ngIf",b.showButton),f.xp6(3),f.hij(" ",b.player," "))},dependencies:[F.PM,F.Zi,F.Dq,F.gu,be.O5],styles:["ion-card[_ngcontent-%COMP%]{min-width:200px;max-width:200px;min-height:300px;max-height:300px}ion-card[_ngcontent-%COMP%]:hover   div[_ngcontent-%COMP%]{display:block}ion-icon[_ngcontent-%COMP%]{cursor:pointer}.deleteButton[_ngcontent-%COMP%]{position:absolute;right:2px;top:2px;display:none}.ico[_ngcontent-%COMP%]{width:50px;height:50px}.d-flex[_ngcontent-%COMP%]{display:flex}.overflow-x[_ngcontent-%COMP%]{overflow-x:auto}"]}),$})();var $e=Z(8188);function Ke(N,$){if(1&N){const Y=f.EpF();f.TgZ(0,"ion-button",2),f.NdJ("click",function(){f.CHM(Y);const b=f.oxw();return f.KtG(b.addItem())}),f._UZ(1,"ion-icon",3),f.qZA()}if(2&N){const Y=f.oxw();f.xp6(),f.s9C("name",Y.icon)}}let gc=(()=>{var N;class ${constructor(){this.id="",this.type="text",this.placeholder="Ingresa nuevo ...",this.parameter="",this.icon=null,this.count=20,this.inputModel=""}ngOnInit(){}addItem(){const S=document.getElementById(this.id);if(""===this.inputModel.trim())return null==S||S.focus(),alert("Los campos no deben estar vacios");this.action(this.parameter,this.inputModel),this.inputModel="",null==S||S.focus()}}return(N=$).\u0275fac=function(S){return new(S||N)},N.\u0275cmp=f.Xpm({type:N,selectors:[["input-component"]],inputs:{id:"id",type:"type",model:"model",placeholder:"placeholder",action:"action",parameter:"parameter",icon:"icon",count:"count"},decls:2,vars:7,consts:[["fill","outline",3,"id","placeholder","ngModel","type","counter","maxlength","ngModelChange","keyup.enter"],["fill","clear","slot","end","aria-label","Show/hide",3,"click",4,"ngIf"],["fill","clear","slot","end","aria-label","Show/hide",3,"click"],["slot","icon-only","aria-hidden","true",3,"name"]],template:function(S,b){1&S&&(f.TgZ(0,"ion-input",0),f.NdJ("ngModelChange",function(Qe){return b.inputModel=Qe})("keyup.enter",function(){return b.addItem()}),f.YNc(1,Ke,2,1,"ion-button",1),f.qZA()),2&S&&(f.s9C("id",b.id),f.s9C("placeholder",b.placeholder),f.s9C("type",b.type),f.s9C("maxlength",b.count),f.Q6J("ngModel",b.inputModel)("counter",!0),f.xp6(),f.Q6J("ngIf",b.inputModel.trim().length>0))},dependencies:[F.YG,F.gu,F.pK,F.j9,be.O5,je.JJ,je.nD,je.On]}),$})();function pi(N,$){1&N&&(f.TgZ(0,"ion-label"),f._uU(1,"* No hay participantes todavia *"),f.qZA())}function js(N,$){if(1&N&&f._UZ(0,"card-component",19),2&N){const Y=$.$implicit,S=$.index,b=f.oxw();f.Q6J("player",Y)("listName","players")("callback",b.removeItem)("index",S)}}function $s(N,$){1&N&&(f.TgZ(0,"ion-label"),f._uU(1,"* No hay sitios todavia *"),f.qZA())}const Ks=N=>({listName:"sites",item:N});function Qs(N,$){if(1&N&&f._UZ(0,"item-component",20),2&N){const Y=$.$implicit,S=f.oxw();f.Q6J("action",S.removeItem)("actionTitle","Eliminar")("label",Y.title)("parameters",f.VKq(4,Ks,Y))}}function Ws(N,$){1&N&&(f.TgZ(0,"ion-label"),f._uU(1,"* No hay situaciones todavia *"),f.qZA())}const dn=N=>({listName:"situations",item:N});function Hs(N,$){if(1&N&&f._UZ(0,"item-component",20),2&N){const Y=$.$implicit,S=f.oxw();f.Q6J("action",S.removeItem)("actionTitle","Eliminar")("label",Y.title)("parameters",f.VKq(4,dn,Y))}}function Zs(N,$){1&N&&(f.TgZ(0,"ion-label"),f._uU(1,"* No hay temas todavia *"),f.qZA())}const gi=N=>({listName:"temes",item:N});function _c(N,$){if(1&N&&f._UZ(0,"item-component",20),2&N){const Y=$.$implicit,S=f.oxw();f.Q6J("action",S.removeItem)("actionTitle","Eliminar")("label",Y.title)("parameters",f.VKq(4,gi,Y))}}let _i=(()=>{var N;class ${constructor(S,b){var Te=this;this.store=S,this.fireDatabase=b,this.appTitle="",this.subs=[],this.listSubs=[],this.players=[],this.sites=[],this.situations=[],this.temes=[],this.repeat=!0,this.help=!0,this.addItem=function(){var Qe=(0,_.Z)(function*(Be,et){if(""===et.trim())return alert("Campos vacios");Be.toLowerCase()!="players".toLowerCase()?yield Te.fireDatabase.addNewDocument(Be.toLowerCase(),{title:et.trim()}):Te.setStore(Be,[...Te.players,et])});return function(Be,et){return Qe.apply(this,arguments)}}(),this.removeItem=function(){var Qe=(0,_.Z)(function*({listName:Be,item:et}){let ar=[];ar=Te.listAssign(Be),Be.toLowerCase()!="players".toLowerCase()&&(yield Te.fireDatabase.deleteDocument(Be,et.id));const yi=[...ar];yi.splice(yi.indexOf(et),1),Te.setStore(Be,yi)});return function(Be){return Qe.apply(this,arguments)}}(),this.config$=this.store.select("config")}ngOnInit(){this.getStore(),this.listSubs.push(this.fireDatabase.getCollection("sites").subscribe(S=>{this.sites=S,this.setStore("sites",S)})),this.listSubs.push(this.fireDatabase.getCollection("situations").subscribe(S=>{this.situations=S,this.setStore("situations",S)})),this.listSubs.push(this.fireDatabase.getCollection("temes").subscribe(S=>{this.temes=S,this.setStore("temes",S)}))}ngOnDestroy(){this.subs.forEach(S=>S.unsubscribe())}getStore(){this.subs.push(this.config$.subscribe(({appTitle:S,players:b,sites:Te,situations:Qe,temes:Be,repeat:et,help:ar})=>{this.appTitle=S,this.players=b,this.sites=Te,this.situations=Qe,this.temes=Be,this.repeat=et,this.help=ar}))}setStore(S,b){S.toLowerCase()==="players".toLowerCase()&&this.store.dispatch((0,Se.U4)({players:b})),S.toLowerCase()==="sites".toLowerCase()&&this.store.dispatch((0,Se.Ui)({sites:b})),S.toLowerCase()==="situations".toLowerCase()&&this.store.dispatch((0,Se.a9)({situations:b})),S.toLowerCase()==="temes".toLowerCase()&&this.store.dispatch((0,Se.zt)({temes:b})),S.toLowerCase()==="repeat".toLowerCase()&&this.store.dispatch((0,Se.Oo)({repeat:b})),S.toLowerCase()==="help".toLowerCase()&&this.store.dispatch((0,Se.gp)({help:b}))}setRepeat(){this.store.dispatch((0,Se.Oo)({repeat:!!this.repeat}))}listAssign(S){let b=[];return S.toLowerCase()=="players".toLowerCase()&&(b=this.players),S.toLowerCase()=="sites".toLowerCase()&&(b=this.sites),S.toLowerCase()=="temes".toLowerCase()&&(b=this.temes),S.toLowerCase()=="situations".toLowerCase()&&(b=this.situations),b}}return(N=$).\u0275fac=function(S){return new(S||N)(f.Y36(yt.yh),f.Y36(Bt.u))},N.\u0275cmp=f.Xpm({type:N,selectors:[["config-page"]],decls:75,vars:40,consts:[[3,"translucent"],["color","tertiary"],[3,"fullscreen"],[1,"ion-justify-content-center"],["size","12","size-sm","12","size-md","10","size-lg","8"],["collapse","condense"],["color","tertiary","size","large"],[1,"content-header"],["color","tertiary",1,"content-title"],[1,"content-input"],[3,"id","type","placeholder","action","parameter","icon"],[1,"d-flex","overflow-x"],[4,"ngIf"],[3,"player","listName","callback","index",4,"ngFor","ngForOf"],[1,"pt-2"],[3,"click"],["slot","end",3,"ngModel","ngModelChange"],[3,"id","type","placeholder","action","parameter","icon","count"],[3,"action","actionTitle","label","parameters",4,"ngFor","ngForOf"],[3,"player","listName","callback","index"],[3,"action","actionTitle","label","parameters"]],template:function(S,b){1&S&&(f.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title",1),f._uU(3,"CONFIGURACION"),f.qZA()()(),f.TgZ(4,"ion-content",2)(5,"ion-row",3)(6,"ion-col",4)(7,"ion-header",5)(8,"ion-toolbar")(9,"ion-card-subtitle"),f._uU(10),f.qZA(),f.TgZ(11,"ion-card-title",6),f._uU(12,"CONFIGURACION"),f.qZA()()(),f.TgZ(13,"ion-card")(14,"ion-card-content")(15,"ion-text")(16,"p"),f._uU(17,"Aqu\xed puedes agregar participantes, marcos de circunstancias para la predicaci\xf3n, temas de conversaci\xf3n y los diferentes territorios donde quieres practicar."),f.qZA(),f.TgZ(18,"p"),f._uU(19,"Que te diviertas!"),f.qZA()()()(),f.TgZ(20,"ion-card")(21,"ion-card-content")(22,"div",7)(23,"ion-text",8)(24,"h1"),f._uU(25,"Jugadores"),f.qZA()(),f.TgZ(26,"div",9),f._UZ(27,"input-component",10),f.qZA()(),f.TgZ(28,"div",11),f.YNc(29,pi,2,0,"ion-label",12)(30,js,1,4,"card-component",13),f.qZA()()(),f.TgZ(31,"ion-card")(32,"ion-card-content")(33,"div",14)(34,"ion-item",15),f.NdJ("click",function(){return b.setStore("repeat",b.repeat)}),f.TgZ(35,"ion-label"),f._uU(36,"Repetir participantes"),f.qZA(),f.TgZ(37,"ion-checkbox",16),f.NdJ("ngModelChange",function(Qe){return b.repeat=Qe}),f.qZA()(),f.TgZ(38,"ion-item",15),f.NdJ("click",function(){return b.setStore("help",b.help)}),f.TgZ(39,"ion-label"),f._uU(40,"Activar ayuda"),f.qZA(),f.TgZ(41,"ion-checkbox",16),f.NdJ("ngModelChange",function(Qe){return b.help=Qe}),f.qZA()()()()(),f.TgZ(42,"ion-card")(43,"ion-card-content")(44,"div",7)(45,"ion-text",8)(46,"h1"),f._uU(47,"Sitios"),f.qZA()(),f.TgZ(48,"div",9),f._UZ(49,"input-component",17),f.qZA()(),f.TgZ(50,"div",14),f.YNc(51,$s,2,0,"ion-label",12)(52,Qs,1,6,"item-component",18),f.qZA()()(),f.TgZ(53,"ion-card")(54,"ion-card-content")(55,"div",7)(56,"ion-text",8)(57,"h1"),f._uU(58,"Situaciones"),f.qZA()(),f.TgZ(59,"div",9),f._UZ(60,"input-component",17),f.qZA()(),f.TgZ(61,"div",14),f.YNc(62,Ws,2,0,"ion-label",12)(63,Hs,1,6,"item-component",18),f.qZA()()(),f.TgZ(64,"ion-card")(65,"ion-card-content")(66,"div",7)(67,"ion-text",8)(68,"h1"),f._uU(69,"Temas"),f.qZA()(),f.TgZ(70,"div",9),f._UZ(71,"input-component",17),f.qZA()(),f.TgZ(72,"div",14),f.YNc(73,Zs,2,0,"ion-label",12)(74,_c,1,6,"item-component",18),f.qZA()()()()()()),2&S&&(f.Q6J("translucent",!0),f.xp6(4),f.Q6J("fullscreen",!0),f.xp6(6),f.Oqu(b.appTitle),f.xp6(17),f.Q6J("id","players")("type","text")("placeholder","Agrega m\xe1s aqu\xed.")("action",b.addItem)("parameter","players")("icon","add-circle"),f.xp6(2),f.Q6J("ngIf",0==b.players.length),f.xp6(),f.Q6J("ngForOf",b.players),f.xp6(7),f.Q6J("ngModel",b.repeat),f.xp6(4),f.Q6J("ngModel",b.help),f.xp6(8),f.Q6J("id","sites")("type","text")("placeholder","Agrega m\xe1s aqu\xed.")("action",b.addItem)("parameter","sites")("icon","add-circle")("count",30),f.xp6(2),f.Q6J("ngIf",0==b.sites.length),f.xp6(),f.Q6J("ngForOf",b.sites),f.xp6(8),f.Q6J("id","situations")("type","text")("placeholder","Agrega m\xe1s aqu\xed.")("action",b.addItem)("parameter","situations")("icon","add-circle")("count",30),f.xp6(2),f.Q6J("ngIf",0==b.situations.length),f.xp6(),f.Q6J("ngForOf",b.situations),f.xp6(8),f.Q6J("id","temes")("type","text")("placeholder","Agrega m\xe1s aqu\xed.")("action",b.addItem)("parameter","temes")("icon","add-circle")("count",30),f.xp6(2),f.Q6J("ngIf",0==b.temes.length),f.xp6(),f.Q6J("ngForOf",b.temes))},dependencies:[be.sg,be.O5,je.JJ,je.On,F.PM,F.FN,F.tO,F.Dq,F.nz,F.wI,F.W2,F.Gu,F.Ie,F.Q$,F.Nd,F.yW,F.wd,F.sr,F.w,Oe,$e.P,gc],styles:[".d-flex[_ngcontent-%COMP%]{display:flex}.between[_ngcontent-%COMP%]{justify-content:space-between}.align-center[_ngcontent-%COMP%]{align-items:center}.overflow-x[_ngcontent-%COMP%]{overflow-x:auto}.overflow-y[_ngcontent-%COMP%]{overflow-y:auto}.grid[_ngcontent-%COMP%]{max-height:10%}.content-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.content-title[_ngcontent-%COMP%]{display:flex;align-items:center;transform:translateY(-10px);width:30%}.content-input[_ngcontent-%COMP%]{width:60%}.pt-2[_ngcontent-%COMP%]{padding-top:15px!important}"]}),$})()},5370:(zs,Lt,Z)=>{Z.d(Lt,{u:()=>CE});var _=Z(5861),Se=Z(553);const be=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=63&i|128):55296==(64512&i)&&r+1<n.length&&56320==(64512&n.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&n.charCodeAt(++r)),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=63&i|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=63&i|128)}return e},F={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){const s=n[i],o=i+1<n.length,a=o?n[i+1]:0,u=i+2<n.length,c=u?n[i+2]:0;let d=(15&a)<<2|c>>6,p=63&c;u||(p=64,o||(d=64)),r.push(t[s>>2],t[(3&s)<<4|a>>4],t[d],t[p])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(be(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):function(n){const e=[];let t=0,r=0;for(;t<n.length;){const i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=n[t++];e[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const u=((7&i)<<18|(63&n[t++])<<12|(63&n[t++])<<6|63&n[t++])-65536;e[r++]=String.fromCharCode(55296+(u>>10)),e[r++]=String.fromCharCode(56320+(1023&u))}else{const s=n[t++],o=n[t++];e[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){const s=t[n.charAt(i++)],a=i<n.length?t[n.charAt(i)]:0;++i;const c=i<n.length?t[n.charAt(i)]:64;++i;const h=i<n.length?t[n.charAt(i)]:64;if(++i,null==s||null==a||null==c||null==h)throw new Je;r.push(s<<2|a>>4),64!==c&&(r.push(a<<4&240|c>>2),64!==h&&r.push(c<<6&192|h))}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class Je extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const $e=function(n){return function(n){const e=be(n);return F.encodeByteArray(e,!0)}(n).replace(/\./g,"")},dn=()=>{try{return function $s(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if(typeof process>"u"||typeof process.env>"u")return;const n=process.env.__FIREBASE_DEFAULTS__;return n?JSON.parse(n):void 0})()||(()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&function(n){try{return F.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null}(n[1]);return e&&JSON.parse(e)})()}catch(n){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`)}},gi=()=>{var n;return null===(n=dn())||void 0===n?void 0:n.config};class _i{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,r))}}}function $(){return typeof navigator<"u"&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function yc(){try{return"object"==typeof indexedDB}catch{return!1}}class fn extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name="FirebaseError",Object.setPrototypeOf(this,fn.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Ic.prototype.create)}}class Ic{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],o=s?function Am(n,e){return n.replace(wm,(t,r)=>{const i=e[r];return null!=i?String(i):`<${r}?>`})}(s,r):"Error";return new fn(i,`${this.serviceName}: ${o} (${i}).`,r)}}const wm=/\{\$([^}]+)}/g;function Js(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const i of t){if(!r.includes(i))return!1;const s=n[i],o=e[i];if(Tc(s)&&Tc(o)){if(!Js(s,o))return!1}else if(s!==o)return!1}for(const i of r)if(!t.includes(i))return!1;return!0}function Tc(n){return null!==n&&"object"==typeof n}function mn(n){return n&&n._delegate?n._delegate:n}class ur{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Ut="[DEFAULT]";class Dm{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new _i;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:t});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),i=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(r)&&!this.shouldAutoInitialize()){if(i)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:r})}catch(s){if(i)return null;throw s}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function km(n){return"EAGER"===n.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:Ut})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(t);try{const s=this.getOrInitializeService({instanceIdentifier:i});r.resolve(s)}catch{}}}}clearInstance(e=Ut){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){var e=this;return(0,_.Z)(function*(){const t=Array.from(e.instances.values());yield Promise.all([...t.filter(r=>"INTERNAL"in r).map(r=>r.INTERNAL.delete()),...t.filter(r=>"_delete"in r).map(r=>r._delete())])})()}isComponentSet(){return null!=this.component}isInitialized(e=Ut){return this.instances.has(e)}getOptions(e=Ut){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[s,o]of this.instancesDeferred.entries())r===this.normalizeInstanceIdentifier(s)&&o.resolve(i);return i}onInit(e,t){var r;const i=this.normalizeInstanceIdentifier(t),s=null!==(r=this.onInitCallbacks.get(i))&&void 0!==r?r:new Set;s.add(e),this.onInitCallbacks.set(i,s);const o=this.instances.get(i);return o&&e(o,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const i of r)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:(n=e,n===Ut?void 0:n),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}var n;return r||null}normalizeInstanceIdentifier(e=Ut){return this.component?this.component.multipleInstances?e:Ut:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class Mm{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Dm(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const eo=[];var j=function(n){return n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT",n}(j||{});const vc={debug:j.DEBUG,verbose:j.VERBOSE,info:j.INFO,warn:j.WARN,error:j.ERROR,silent:j.SILENT},Om=j.INFO,Fm={[j.DEBUG]:"log",[j.VERBOSE]:"log",[j.INFO]:"info",[j.WARN]:"warn",[j.ERROR]:"error"},Lm=(n,e,...t)=>{if(e<n.logLevel)return;const r=(new Date).toISOString(),i=Fm[e];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[i](`[${r}]  ${n.name}:`,...t)};class Ac{constructor(e){this.name=e,this._logLevel=Om,this._logHandler=Lm,this._userLogHandler=null,eo.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in j))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?vc[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,j.DEBUG,...e),this._logHandler(this,j.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,j.VERBOSE,...e),this._logHandler(this,j.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,j.INFO,...e),this._logHandler(this,j.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,j.WARN,...e),this._logHandler(this,j.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,j.ERROR,...e),this._logHandler(this,j.ERROR,...e)}}const Bm=(n,e)=>e.some(t=>n instanceof t);let wc,Rc;const Pc=new WeakMap,to=new WeakMap,Sc=new WeakMap,no=new WeakMap,ro=new WeakMap;let io={get(n,e,t){if(n instanceof IDBTransaction){if("done"===e)return to.get(n);if("objectStoreNames"===e)return n.objectStoreNames||Sc.get(n);if("store"===e)return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return It(n[e])},set:(n,e,t)=>(n[e]=t,!0),has:(n,e)=>n instanceof IDBTransaction&&("done"===e||"store"===e)||e in n};function Km(n){return"function"==typeof n?function $m(n){return n!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?function qm(){return Rc||(Rc=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}().includes(n)?function(...e){return n.apply(so(this),e),It(Pc.get(this))}:function(...e){return It(n.apply(so(this),e))}:function(e,...t){const r=n.call(so(this),e,...t);return Sc.set(r,e.sort?e.sort():[e]),It(r)}}(n):(n instanceof IDBTransaction&&function zm(n){if(to.has(n))return;const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",o),n.removeEventListener("abort",o)},s=()=>{t(),i()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",s),n.addEventListener("error",o),n.addEventListener("abort",o)});to.set(n,e)}(n),Bm(n,function Um(){return wc||(wc=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}())?new Proxy(n,io):n)}function It(n){if(n instanceof IDBRequest)return function Gm(n){const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("success",s),n.removeEventListener("error",o)},s=()=>{t(It(n.result)),i()},o=()=>{r(n.error),i()};n.addEventListener("success",s),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&Pc.set(t,n)}).catch(()=>{}),ro.set(e,n),e}(n);if(no.has(n))return no.get(n);const e=Km(n);return e!==n&&(no.set(n,e),ro.set(e,n)),e}const so=n=>ro.get(n),Wm=["get","getKey","getAll","getAllKeys","count"],Hm=["put","add","delete","clear"],oo=new Map;function bc(n,e){if(!(n instanceof IDBDatabase)||e in n||"string"!=typeof e)return;if(oo.get(e))return oo.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,i=Hm.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!Wm.includes(t))return;const s=function(){var o=(0,_.Z)(function*(a,...u){const c=this.transaction(a,i?"readwrite":"readonly");let l=c.store;return r&&(l=l.index(u.shift())),(yield Promise.all([l[t](...u),i&&c.done]))[0]});return function(u){return o.apply(this,arguments)}}();return oo.set(e,s),s}!function jm(n){io=n(io)}(n=>({...n,get:(e,t,r)=>bc(e,t)||n.get(e,t,r),has:(e,t)=>!!bc(e,t)||n.has(e,t)}));class Zm{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(function Jm(n){const e=n.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}return null}).filter(t=>t).join(" ")}}const ao="@firebase/app",qt=new Ac("@firebase/app"),Ei="[DEFAULT]",Ap={[ao]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},Gt=new Map,Ti=new Map;function wp(n,e){try{n.container.addComponent(e)}catch(t){qt.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function vi(n){const e=n.name;if(Ti.has(e))return qt.debug(`There were multiple attempts to register component ${e}.`),!1;Ti.set(e,n);for(const t of Gt.values())wp(t,n);return!0}const ct=new Ic("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class Pp{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new ur("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ct.create("app-deleted",{appName:this._name})}}function Vc(n,e={}){let t=n;"object"!=typeof e&&(e={name:e});const r=Object.assign({name:Ei,automaticDataCollectionEnabled:!1},e),i=r.name;if("string"!=typeof i||!i)throw ct.create("bad-app-name",{appName:String(i)});if(t||(t=gi()),!t)throw ct.create("no-options");const s=Gt.get(i);if(s){if(Js(t,s.options)&&Js(r,s.config))return s;throw ct.create("duplicate-app",{appName:i})}const o=new Mm(i);for(const u of Ti.values())o.addComponent(u);const a=new Pp(t,r,o);return Gt.set(i,a),a}function pn(n,e,t){var r;let i=null!==(r=Ap[n])&&void 0!==r?r:n;t&&(i+=`-${t}`);const s=i.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const a=[`Unable to register library "${i}" with version "${e}":`];return s&&a.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void qt.warn(a.join(" "))}vi(new ur(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}const xp="firebase-heartbeat-database",Cp=1,cr="firebase-heartbeat-store";let co=null;function Dc(){return co||(co=function Qm(n,e,{blocked:t,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(n,e),a=It(o);return r&&o.addEventListener("upgradeneeded",u=>{r(It(o.result),u.oldVersion,u.newVersion,It(o.transaction),u)}),t&&o.addEventListener("blocked",u=>t(u.oldVersion,u.newVersion,u)),a.then(u=>{s&&u.addEventListener("close",()=>s()),i&&u.addEventListener("versionchange",c=>i(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}(xp,Cp,{upgrade:(n,e)=>{if(0===e)try{n.createObjectStore(cr)}catch(t){console.warn(t)}}}).catch(n=>{throw ct.create("idb-open",{originalErrorMessage:n.message})})),co}function lo(){return(lo=(0,_.Z)(function*(n){try{return yield(yield Dc()).transaction(cr).objectStore(cr).get(kc(n))}catch(e){if(e instanceof fn)qt.warn(e.message);else{const t=ct.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});qt.warn(t.message)}}})).apply(this,arguments)}function Nc(n,e){return ho.apply(this,arguments)}function ho(){return(ho=(0,_.Z)(function*(n,e){try{const r=(yield Dc()).transaction(cr,"readwrite");yield r.objectStore(cr).put(e,kc(n)),yield r.done}catch(t){if(t instanceof fn)qt.warn(t.message);else{const r=ct.create("idb-set",{originalErrorMessage:null==t?void 0:t.message});qt.warn(r.message)}}})).apply(this,arguments)}function kc(n){return`${n.name}!${n.options.appId}`}class kp{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Op(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}triggerHeartbeat(){var e=this;return(0,_.Z)(function*(){var t,r;const s=e.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),o=Mc();if((null!=(null===(t=e._heartbeatsCache)||void 0===t?void 0:t.heartbeats)||(e._heartbeatsCache=yield e._heartbeatsCachePromise,null!=(null===(r=e._heartbeatsCache)||void 0===r?void 0:r.heartbeats)))&&e._heartbeatsCache.lastSentHeartbeatDate!==o&&!e._heartbeatsCache.heartbeats.some(a=>a.date===o))return e._heartbeatsCache.heartbeats.push({date:o,agent:s}),e._heartbeatsCache.heartbeats=e._heartbeatsCache.heartbeats.filter(a=>{const u=new Date(a.date).valueOf();return Date.now()-u<=2592e6}),e._storage.overwrite(e._heartbeatsCache)})()}getHeartbeatsHeader(){var e=this;return(0,_.Z)(function*(){var t;if(null===e._heartbeatsCache&&(yield e._heartbeatsCachePromise),null==(null===(t=e._heartbeatsCache)||void 0===t?void 0:t.heartbeats)||0===e._heartbeatsCache.heartbeats.length)return"";const r=Mc(),{heartbeatsToSend:i,unsentEntries:s}=function Mp(n,e=1024){const t=[];let r=n.slice();for(const i of n){const s=t.find(o=>o.agent===i.agent);if(s){if(s.dates.push(i.date),Oc(t)>e){s.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),Oc(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}(e._heartbeatsCache.heartbeats),o=$e(JSON.stringify({version:2,heartbeats:i}));return e._heartbeatsCache.lastSentHeartbeatDate=r,s.length>0?(e._heartbeatsCache.heartbeats=s,yield e._storage.overwrite(e._heartbeatsCache)):(e._heartbeatsCache.heartbeats=[],e._storage.overwrite(e._heartbeatsCache)),o})()}}function Mc(){return(new Date).toISOString().substring(0,10)}class Op{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return(0,_.Z)(function*(){return!!yc()&&function Tm(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{var s;e((null===(s=i.error)||void 0===s?void 0:s.message)||"")}}catch(t){e(t)}})}().then(()=>!0).catch(()=>!1)})()}read(){var e=this;return(0,_.Z)(function*(){if(yield e._canUseIndexedDBPromise){const r=yield function Vp(n){return lo.apply(this,arguments)}(e.app);return null!=r&&r.heartbeats?r:{heartbeats:[]}}return{heartbeats:[]}})()}overwrite(e){var t=this;return(0,_.Z)(function*(){var r;if(yield t._canUseIndexedDBPromise){const s=yield t.read();return Nc(t.app,{lastSentHeartbeatDate:null!==(r=e.lastSentHeartbeatDate)&&void 0!==r?r:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}})()}add(e){var t=this;return(0,_.Z)(function*(){var r;if(yield t._canUseIndexedDBPromise){const s=yield t.read();return Nc(t.app,{lastSentHeartbeatDate:null!==(r=e.lastSentHeartbeatDate)&&void 0!==r?r:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}})()}}function Oc(n){return $e(JSON.stringify({version:2,heartbeats:n})).length}!function Fp(n){vi(new ur("platform-logger",e=>new Zm(e),"PRIVATE")),vi(new ur("heartbeat",e=>new kp(e),"PRIVATE")),pn(ao,"0.9.26",n),pn(ao,"0.9.26","esm2017"),pn("fire-js","")}(""),pn("firebase","10.7.2","app");var R,Up=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ye={},fo=fo||{},M=Up||self;function Ai(n){var e=typeof n;return"array"==(e="object"!=e?e:n?Array.isArray(n)?"array":e:"null")||"object"==e&&"number"==typeof n.length}function lr(n){var e=typeof n;return"object"==e&&null!=n||"function"==e}var mo="closure_uid_"+(1e9*Math.random()>>>0),Gp=0;function zp(n,e,t){return n.call.apply(n.bind,arguments)}function jp(n,e,t){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),n.apply(e,i)}}return function(){return n.apply(e,arguments)}}function xe(n,e,t){return(xe=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?zp:jp).apply(null,arguments)}function wi(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var r=t.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function ge(n,e){function t(){}t.prototype=e.prototype,n.$=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.ac=function(r,i,s){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[i].apply(r,o)}}function Et(){this.s=this.s,this.o=this.o}Et.prototype.s=!1,Et.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),0)&&function qp(n){Object.prototype.hasOwnProperty.call(n,mo)&&n[mo]||(n[mo]=++Gp)}(this)},Et.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const Fc=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if("string"==typeof n)return"string"!=typeof e||1!=e.length?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function po(n){const e=n.length;if(0<e){const t=Array(e);for(let r=0;r<e;r++)t[r]=n[r];return t}return[]}function Lc(n,e){for(let t=1;t<arguments.length;t++){const r=arguments[t];if(Ai(r)){const i=n.length||0,s=r.length||0;n.length=i+s;for(let o=0;o<s;o++)n[i+o]=r[o]}else n.push(r)}}function Ce(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}Ce.prototype.h=function(){this.defaultPrevented=!0};var Kp=function(){if(!M.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{const t=()=>{};M.addEventListener("test",t,e),M.removeEventListener("test",t,e)}catch{}return n}();function hr(n){return/^[\s\xa0]*$/.test(n)}function Ri(){var n=M.navigator;return n&&(n=n.userAgent)?n:""}function tt(n){return-1!=Ri().indexOf(n)}function go(n){return go[" "](n),n}go[" "]=function(){};var yo,n,Wp=tt("Opera"),gn=tt("Trident")||tt("MSIE"),Bc=tt("Edge"),_o=Bc||gn,Uc=tt("Gecko")&&!(-1!=Ri().toLowerCase().indexOf("webkit")&&!tt("Edge"))&&!(tt("Trident")||tt("MSIE"))&&!tt("Edge"),Hp=-1!=Ri().toLowerCase().indexOf("webkit")&&!tt("Edge");function qc(){var n=M.document;return n?n.documentMode:void 0}e:{var Io="",Eo=(n=Ri(),Uc?/rv:([^\);]+)(\)|;)/.exec(n):Bc?/Edge\/([\d\.]+)/.exec(n):gn?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n):Hp?/WebKit\/(\S+)/.exec(n):Wp?/(?:Version)[ \/]?(\S+)/.exec(n):void 0);if(Eo&&(Io=Eo?Eo[1]:""),gn){var To=qc();if(null!=To&&To>parseFloat(Io)){yo=String(To);break e}}yo=Io}var Zp=M.document&&gn&&(qc()||parseInt(yo,10))||void 0;function dr(n,e){if(Ce.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(Uc){e:{try{go(e.nodeName);var i=!0;break e}catch{}i=!1}i||(e=null)}}else"mouseover"==t?e=n.fromElement:"mouseout"==t&&(e=n.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType="string"==typeof n.pointerType?n.pointerType:Jp[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&dr.$.h.call(this)}}ge(dr,Ce);var Jp={2:"touch",3:"pen",4:"mouse"};dr.prototype.h=function(){dr.$.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var fr="closure_listenable_"+(1e6*Math.random()|0),Yp=0;function Xp(n,e,t,r,i){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!r,this.la=i,this.key=++Yp,this.fa=this.ia=!1}function Pi(n){n.fa=!0,n.listener=null,n.proxy=null,n.src=null,n.la=null}function Ao(n,e,t){for(const r in n)e.call(t,n[r],r,n)}function zc(n){const e={};for(const t in n)e[t]=n[t];return e}const jc="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function $c(n,e){let t,r;for(let i=1;i<arguments.length;i++){for(t in r=arguments[i],r)n[t]=r[t];for(let s=0;s<jc.length;s++)t=jc[s],Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}}function Si(n){this.src=n,this.g={},this.h=0}function wo(n,e){var t=e.type;if(t in n.g){var s,r=n.g[t],i=Fc(r,e);(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(Pi(e),0==n.g[t].length&&(delete n.g[t],n.h--))}}function Ro(n,e,t,r){for(var i=0;i<n.length;++i){var s=n[i];if(!s.fa&&s.listener==e&&s.capture==!!t&&s.la==r)return i}return-1}Si.prototype.add=function(n,e,t,r,i){var s=n.toString();(n=this.g[s])||(n=this.g[s]=[],this.h++);var o=Ro(n,e,r,i);return-1<o?(e=n[o],t||(e.ia=!1)):((e=new Xp(e,this.src,s,!!r,i)).ia=t,n.push(e)),e};var Po="closure_lm_"+(1e6*Math.random()|0),So={};function Kc(n,e,t,r,i){if(r&&r.once)return Wc(n,e,t,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)Kc(n,e[s],t,r,i);return null}return t=Vo(t),n&&n[fr]?n.O(e,t,lr(r)?!!r.capture:!!r,i):Qc(n,e,t,!1,r,i)}function Qc(n,e,t,r,i,s){if(!e)throw Error("Invalid event type");var o=lr(i)?!!i.capture:!!i,a=xo(n);if(a||(n[Po]=a=new Si(n)),(t=a.add(e,t,r,o,s)).proxy)return t;if(r=function tg(){const e=ng;return function n(t){return e.call(n.src,n.listener,t)}}(),t.proxy=r,r.src=n,r.listener=t,n.addEventListener)Kp||(i=o),void 0===i&&(i=!1),n.addEventListener(e.toString(),r,i);else if(n.attachEvent)n.attachEvent(Zc(e.toString()),r);else{if(!n.addListener||!n.removeListener)throw Error("addEventListener and attachEvent are unavailable.");n.addListener(r)}return t}function Wc(n,e,t,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)Wc(n,e[s],t,r,i);return null}return t=Vo(t),n&&n[fr]?n.P(e,t,lr(r)?!!r.capture:!!r,i):Qc(n,e,t,!0,r,i)}function Hc(n,e,t,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)Hc(n,e[s],t,r,i);else r=lr(r)?!!r.capture:!!r,t=Vo(t),n&&n[fr]?(n=n.i,(e=String(e).toString())in n.g&&-1<(t=Ro(s=n.g[e],t,r,i))&&(Pi(s[t]),Array.prototype.splice.call(s,t,1),0==s.length&&(delete n.g[e],n.h--))):n&&(n=xo(n))&&(e=n.g[e.toString()],n=-1,e&&(n=Ro(e,t,r,i)),(t=-1<n?e[n]:null)&&bo(t))}function bo(n){if("number"!=typeof n&&n&&!n.fa){var e=n.src;if(e&&e[fr])wo(e.i,n);else{var t=n.type,r=n.proxy;e.removeEventListener?e.removeEventListener(t,r,n.capture):e.detachEvent?e.detachEvent(Zc(t),r):e.addListener&&e.removeListener&&e.removeListener(r),(t=xo(e))?(wo(t,n),0==t.h&&(t.src=null,e[Po]=null)):Pi(n)}}}function Zc(n){return n in So?So[n]:So[n]="on"+n}function ng(n,e){if(n.fa)n=!0;else{e=new dr(e,this);var t=n.listener,r=n.la||n.src;n.ia&&bo(n),n=t.call(r,e)}return n}function xo(n){return(n=n[Po])instanceof Si?n:null}var Co="__closure_events_fn_"+(1e9*Math.random()>>>0);function Vo(n){return"function"==typeof n?n:(n[Co]||(n[Co]=function(e){return n.handleEvent(e)}),n[Co])}function _e(){Et.call(this),this.i=new Si(this),this.S=this,this.J=null}function ve(n,e){var t,r=n.J;if(r)for(t=[];r;r=r.J)t.push(r);if(n=n.S,r=e.type||e,"string"==typeof e)e=new Ce(e,n);else if(e instanceof Ce)e.target=e.target||n;else{var i=e;$c(e=new Ce(r,n),i)}if(i=!0,t)for(var s=t.length-1;0<=s;s--){var o=e.g=t[s];i=bi(o,r,!0,e)&&i}if(i=bi(o=e.g=n,r,!0,e)&&i,i=bi(o,r,!1,e)&&i,t)for(s=0;s<t.length;s++)i=bi(o=e.g=t[s],r,!1,e)&&i}function bi(n,e,t,r){if(!(e=n.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.fa&&o.capture==t){var a=o.listener,u=o.la||o.src;o.ia&&wo(n.i,o),i=!1!==a.call(u,r)&&i}}return i&&!r.defaultPrevented}ge(_e,Et),_e.prototype[fr]=!0,_e.prototype.removeEventListener=function(n,e,t,r){Hc(this,n,e,t,r)},_e.prototype.N=function(){if(_e.$.N.call(this),this.i){var e,n=this.i;for(e in n.g){for(var t=n.g[e],r=0;r<t.length;r++)Pi(t[r]);delete n.g[e],n.h--}}this.J=null},_e.prototype.O=function(n,e,t,r){return this.i.add(String(n),e,!1,t,r)},_e.prototype.P=function(n,e,t,r){return this.i.add(String(n),e,!0,t,r)};var Do=M.JSON.stringify;function ig(){var n=No;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var Jc=new class rg{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new og,n=>n.reset());class og{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function ag(n){var e=1;n=n.split(":");const t=[];for(;0<e&&n.length;)t.push(n.shift()),e--;return n.length&&t.push(n.join(":")),t}function ug(n){M.setTimeout(()=>{throw n},0)}let mr,pr=!1,No=new class sg{constructor(){this.h=this.g=null}add(e,t){const r=Jc.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}},Yc=()=>{const n=M.Promise.resolve(void 0);mr=()=>{n.then(cg)}};var cg=()=>{for(var n;n=ig();){try{n.h.call(n.g)}catch(t){ug(t)}var e=Jc;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}pr=!1};function xi(n,e){_e.call(this),this.h=n||1,this.g=e||M,this.j=xe(this.qb,this),this.l=Date.now()}function ko(n){n.ga=!1,n.T&&(n.g.clearTimeout(n.T),n.T=null)}function Mo(n,e,t){if("function"==typeof n)t&&(n=xe(n,t));else{if(!n||"function"!=typeof n.handleEvent)throw Error("Invalid listener argument");n=xe(n.handleEvent,n)}return 2147483647<Number(e)?-1:M.setTimeout(n,e||0)}function Xc(n){n.g=Mo(()=>{n.g=null,n.i&&(n.i=!1,Xc(n))},n.j);const e=n.h;n.h=null,n.m.apply(null,e)}ge(xi,_e),(R=xi.prototype).ga=!1,R.T=null,R.qb=function(){if(this.ga){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-n):(this.T&&(this.g.clearTimeout(this.T),this.T=null),ve(this,"tick"),this.ga&&(ko(this),this.start()))}},R.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},R.N=function(){xi.$.N.call(this),ko(this),delete this.g};class lg extends Et{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:Xc(this)}N(){super.N(),this.g&&(M.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function gr(n){Et.call(this),this.h=n,this.g={}}ge(gr,Et);var el=[];function tl(n,e,t,r){Array.isArray(t)||(t&&(el[0]=t.toString()),t=el);for(var i=0;i<t.length;i++){var s=Kc(e,t[i],r||n.handleEvent,!1,n.h||n);if(!s)break;n.g[s.key]=s}}function nl(n){Ao(n.g,function(e,t){this.g.hasOwnProperty(t)&&bo(e)},n),n.g={}}function Ci(){this.g=!0}function _n(n,e,t,r){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+function mg(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t)for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var r=t[n];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return Do(t)}catch{return e}}(n,t)+(r?" "+r:"")})}gr.prototype.N=function(){gr.$.N.call(this),nl(this)},gr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Ci.prototype.Ea=function(){this.g=!1},Ci.prototype.info=function(){};var zt={},rl=null;function Vi(){return rl=rl||new _e}function il(n){Ce.call(this,zt.Ta,n)}function _r(n){const e=Vi();ve(e,new il(e))}function sl(n,e){Ce.call(this,zt.STAT_EVENT,n),this.stat=e}function ke(n){const e=Vi();ve(e,new sl(e,n))}function ol(n,e){Ce.call(this,zt.Ua,n),this.size=e}function yr(n,e){if("function"!=typeof n)throw Error("Fn must not be null and must be a function");return M.setTimeout(function(){n()},e)}zt.Ta="serverreachability",ge(il,Ce),zt.STAT_EVENT="statevent",ge(sl,Ce),zt.Ua="timingevent",ge(ol,Ce);var Di={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},al={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function Oo(){}function cl(){}Oo.prototype.h=null;var Bo,Ir={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function Fo(){Ce.call(this,"d")}function Lo(){Ce.call(this,"c")}function Ni(){}function Er(n,e,t,r){this.l=n,this.j=e,this.m=t,this.W=r||1,this.U=new gr(this),this.P=pg,this.V=new xi(n=_o?125:void 0),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new ll}function ll(){this.i=null,this.g="",this.h=!1}ge(Fo,Ce),ge(Lo,Ce),ge(Ni,Oo),Ni.prototype.g=function(){return new XMLHttpRequest},Ni.prototype.i=function(){return{}},Bo=new Ni;var pg=45e3,hl={},Uo={};function qo(n,e,t){n.L=1,n.A=Fi(lt(e)),n.u=t,n.S=!0,dl(n,null)}function dl(n,e){n.G=Date.now(),Tr(n),n.B=lt(n.A);var t=n.B,r=n.W;Array.isArray(r)||(r=[String(r)]),vl(t.i,"t",r),n.o=0,t=n.l.J,n.h=new ll,n.g=Kl(n.l,t?e:null,!n.u),0<n.O&&(n.M=new lg(xe(n.Pa,n,n.g),n.O)),tl(n.U,n.g,"readystatechange",n.nb),e=n.I?zc(n.I):{},n.u?(n.v||(n.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.ha(n.B,n.v,n.u,e)):(n.v="GET",n.g.ha(n.B,n.v,null,e)),_r(),function hg(n,e,t,r,i,s){n.info(function(){if(n.g)if(s)for(var o="",a=s.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var l=c[0];c=c[1];var h=l.split("_");o=2<=h.length&&"type"==h[1]?o+(l+"=")+c+"&":o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+t+"\n"+o})}(n.j,n.v,n.B,n.m,n.W,n.u)}function fl(n){return!!n.g&&"GET"==n.v&&2!=n.L&&n.l.Ha}function ml(n,e,t){let i,r=!0;for(;!n.J&&n.o<t.length;){if(i=gg(n,t),i==Uo){4==e&&(n.s=4,ke(14),r=!1),_n(n.j,n.m,null,"[Incomplete Response]");break}if(i==hl){n.s=4,ke(15),_n(n.j,n.m,t,"[Invalid Chunk]"),r=!1;break}_n(n.j,n.m,i,null),Go(n,i)}fl(n)&&0!=n.o&&(n.h.g=n.h.g.slice(n.o),n.o=0),4!=e||0!=t.length||n.h.h||(n.s=1,ke(16),r=!1),n.i=n.i&&r,r?0<t.length&&!n.ba&&(n.ba=!0,(e=n.l).g==n&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+t.length),Ho(e),e.M=!0,ke(11))):(_n(n.j,n.m,t,"[Invalid Chunked Response]"),jt(n),vr(n))}function gg(n,e){var t=n.o,r=e.indexOf("\n",t);return-1==r?Uo:(t=Number(e.substring(t,r)),isNaN(t)?hl:(r+=1)+t>e.length?Uo:(e=e.slice(r,r+t),n.o=r+t,e))}function Tr(n){n.Y=Date.now()+n.P,pl(n,n.P)}function pl(n,e){if(null!=n.C)throw Error("WatchDog timer not null");n.C=yr(xe(n.lb,n),e)}function ki(n){n.C&&(M.clearTimeout(n.C),n.C=null)}function vr(n){0==n.l.H||n.J||Gl(n.l,n)}function jt(n){ki(n);var e=n.M;e&&"function"==typeof e.sa&&e.sa(),n.M=null,ko(n.V),nl(n.U),n.g&&(e=n.g,n.g=null,e.abort(),e.sa())}function Go(n,e){try{var t=n.l;if(0!=t.H&&(t.g==n||zo(t.i,n)))if(!n.K&&zo(t.i,n)&&3==t.H){try{var r=t.Ja.g.parse(e)}catch{r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!t.u){if(t.g){if(!(t.g.G+3e3<n.G))break e;zi(t),qi(t)}Wo(t),ke(18)}}else t.Fa=i[1],0<t.Fa-t.V&&37500>i[2]&&t.G&&0==t.A&&!t.v&&(t.v=yr(xe(t.ib,t),6e3));if(1>=Rl(t.i)&&t.oa){try{t.oa()}catch{}t.oa=void 0}}else Kt(t,11)}else if((n.K||t.g==n)&&zi(t),!hr(e))for(i=t.Ja.g.parse(e),e=0;e<i.length;e++){let c=i[e];if(t.V=c[0],c=c[1],2==t.H)if("c"==c[0]){t.K=c[1],t.pa=c[2];const l=c[3];null!=l&&(t.ra=l,t.l.info("VER="+t.ra));const h=c[4];null!=h&&(t.Ga=h,t.l.info("SVER="+t.Ga));const d=c[5];null!=d&&"number"==typeof d&&0<d&&(t.L=r=1.5*d,t.l.info("backChannelRequestTimeoutMs_="+r)),r=t;const p=n.g;if(p){const E=p.g?p.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(E){var s=r.i;s.g||-1==E.indexOf("spdy")&&-1==E.indexOf("quic")&&-1==E.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(jo(s,s.h),s.h=null))}if(r.F){const A=p.g?p.g.getResponseHeader("X-HTTP-Session-Id"):null;A&&(r.Da=A,te(r.I,r.F,A))}}t.H=3,t.h&&t.h.Ba(),t.ca&&(t.S=Date.now()-n.G,t.l.info("Handshake RTT: "+t.S+"ms"));var o=n;if((r=t).wa=$l(r,r.J?r.pa:null,r.Y),o.K){Pl(r.i,o);var a=o,u=r.L;u&&a.setTimeout(u),a.C&&(ki(a),Tr(a)),r.g=o}else Ul(r);0<t.j.length&&Gi(t)}else"stop"!=c[0]&&"close"!=c[0]||Kt(t,7);else 3==t.H&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?Kt(t,7):Qo(t):"noop"!=c[0]&&t.h&&t.h.Aa(c),t.A=0)}_r()}catch{}}function gl(n,e){if(n.forEach&&"function"==typeof n.forEach)n.forEach(e,void 0);else if(Ai(n)||"string"==typeof n)Array.prototype.forEach.call(n,e,void 0);else for(var t=function yg(n){if(n.ta&&"function"==typeof n.ta)return n.ta();if(!n.Z||"function"!=typeof n.Z){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(Ai(n)||"string"==typeof n){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(const r in n)e[t++]=r;return e}}}(n),r=function _g(n){if(n.Z&&"function"==typeof n.Z)return n.Z();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if("string"==typeof n)return n.split("");if(Ai(n)){for(var e=[],t=n.length,r=0;r<t;r++)e.push(n[r]);return e}for(r in e=[],t=0,n)e[t++]=n[r];return e}(n),i=r.length,s=0;s<i;s++)e.call(void 0,r[s],t&&t[s],n)}(R=Er.prototype).setTimeout=function(n){this.P=n},R.nb=function(n){n=n.target;const e=this.M;e&&3==nt(n)?e.l():this.Pa(n)},R.Pa=function(n){try{if(n==this.g)e:{const l=nt(this.g);var e=this.g.Ia();if(this.g.da(),!(3>l)&&(3!=l||_o||this.g&&(this.h.h||this.g.ja()||kl(this.g)))){this.J||4!=l||7==e||_r(),ki(this);var t=this.g.da();this.ca=t;t:if(fl(this)){var r=kl(this.g);n="";var i=r.length,s=4==nt(this.g);if(!this.h.i){if(typeof TextDecoder>"u"){jt(this),vr(this);var o="";break t}this.h.i=new M.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,n+=this.h.i.decode(r[e],{stream:s&&e==i-1});r.length=0,this.h.g+=n,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=200==t,function dg(n,e,t,r,i,s,o){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+t+"\n"+s+" "+o})}(this.j,this.v,this.B,this.m,this.W,l,t),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,u=this.g;if((a=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!hr(a)){var c=a;break t}}c=null}if(!(t=c)){this.i=!1,this.s=3,ke(12),jt(this),vr(this);break e}_n(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Go(this,t)}this.S?(ml(this,l,o),_o&&this.i&&3==l&&(tl(this.U,this.V,"tick",this.mb),this.V.start())):(_n(this.j,this.m,o,null),Go(this,o)),4==l&&jt(this),this.i&&!this.J&&(4==l?Gl(this.l,this):(this.i=!1,Tr(this)))}else(function Og(n){const e={};n=(n.g&&2<=nt(n)&&n.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<n.length;r++){if(hr(n[r]))continue;var t=ag(n[r]);const i=t[0];if("string"!=typeof(t=t[1]))continue;t=t.trim();const s=e[i]||[];e[i]=s,s.push(t)}!function eg(n,e){for(const t in n)e.call(void 0,n[t],t,n)}(e,function(r){return r.join(", ")})})(this.g),400==t&&0<o.indexOf("Unknown SID")?(this.s=3,ke(12)):(this.s=0,ke(13)),jt(this),vr(this)}}}catch{}},R.mb=function(){if(this.g){var n=nt(this.g),e=this.g.ja();this.o<e.length&&(ki(this),ml(this,n,e),this.i&&4!=n&&Tr(this))}},R.cancel=function(){this.J=!0,jt(this)},R.lb=function(){this.C=null;const n=Date.now();0<=n-this.Y?(function fg(n,e){n.info(function(){return"TIMEOUT: "+e})}(this.j,this.B),2!=this.L&&(_r(),ke(17)),jt(this),this.s=2,vr(this)):pl(this,this.Y-n)};var _l=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function $t(n){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof $t){this.h=n.h,Mi(this,n.j),this.s=n.s,this.g=n.g,Oi(this,n.m),this.l=n.l;var e=n.i,t=new Rr;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),yl(this,t),this.o=n.o}else n&&(e=String(n).match(_l))?(this.h=!1,Mi(this,e[1]||"",!0),this.s=Ar(e[2]||""),this.g=Ar(e[3]||"",!0),Oi(this,e[4]),this.l=Ar(e[5]||"",!0),yl(this,e[6]||"",!0),this.o=Ar(e[7]||"")):(this.h=!1,this.i=new Rr(null,this.h))}function lt(n){return new $t(n)}function Mi(n,e,t){n.j=t?Ar(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function Oi(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function yl(n,e,t){e instanceof Rr?(n.i=e,function Rg(n,e){e&&!n.j&&(Tt(n),n.i=null,n.g.forEach(function(t,r){var i=r.toLowerCase();r!=i&&(El(this,r),vl(this,i,t))},n)),n.j=e}(n.i,n.h)):(t||(e=wr(e,Ag)),n.i=new Rr(e,n.h))}function te(n,e,t){n.i.set(e,t)}function Fi(n){return te(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function Ar(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function wr(n,e,t){return"string"==typeof n?(n=encodeURI(n).replace(e,Eg),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function Eg(n){return"%"+((n=n.charCodeAt(0))>>4&15).toString(16)+(15&n).toString(16)}$t.prototype.toString=function(){var n=[],e=this.j;e&&n.push(wr(e,Il,!0),":");var t=this.g;return(t||"file"==e)&&(n.push("//"),(e=this.s)&&n.push(wr(e,Il,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.m)&&n.push(":",String(t))),(t=this.l)&&(this.g&&"/"!=t.charAt(0)&&n.push("/"),n.push(wr(t,"/"==t.charAt(0)?vg:Tg,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",wr(t,wg)),n.join("")};var Il=/[#\/\?@]/g,Tg=/[#\?:]/g,vg=/[#\?]/g,Ag=/[#\?@]/g,wg=/#/g;function Rr(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function Tt(n){n.g||(n.g=new Map,n.h=0,n.i&&function Ig(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var r=n[t].indexOf("="),i=null;if(0<=r){var s=n[t].substring(0,r);i=n[t].substring(r+1)}else s=n[t];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function El(n,e){Tt(n),e=yn(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function Tl(n,e){return Tt(n),e=yn(n,e),n.g.has(e)}function vl(n,e,t){El(n,e),0<t.length&&(n.i=null,n.g.set(yn(n,e),po(t)),n.h+=t.length)}function yn(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}(R=Rr.prototype).add=function(n,e){Tt(this),this.i=null,n=yn(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this},R.forEach=function(n,e){Tt(this),this.g.forEach(function(t,r){t.forEach(function(i){n.call(e,i,r,this)},this)},this)},R.ta=function(){Tt(this);const n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let r=0;r<e.length;r++){const i=n[r];for(let s=0;s<i.length;s++)t.push(e[r])}return t},R.Z=function(n){Tt(this);let e=[];if("string"==typeof n)Tl(this,n)&&(e=e.concat(this.g.get(yn(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e},R.set=function(n,e){return Tt(this),this.i=null,Tl(this,n=yn(this,n))&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this},R.get=function(n,e){return n&&0<(n=this.Z(n)).length?String(n[0]):e},R.toString=function(){if(this.i)return this.i;if(!this.g)return"";const n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var r=e[t];const s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),n.push(i)}}return this.i=n.join("&")};var Pg=class{constructor(n,e){this.g=n,this.map=e}};function Al(n){this.l=n||Sg,n=M.PerformanceNavigationTiming?0<(n=M.performance.getEntriesByType("navigation")).length&&("hq"==n[0].nextHopProtocol||"h2"==n[0].nextHopProtocol):!!(M.g&&M.g.Ka&&M.g.Ka()&&M.g.Ka().dc),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Sg=10;function wl(n){return!!n.h||!!n.g&&n.g.size>=n.j}function Rl(n){return n.h?1:n.g?n.g.size:0}function zo(n,e){return n.h?n.h==e:!!n.g&&n.g.has(e)}function jo(n,e){n.g?n.g.add(e):n.h=e}function Pl(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}function Sl(n){if(null!=n.h)return n.i.concat(n.h.F);if(null!=n.g&&0!==n.g.size){let e=n.i;for(const t of n.g.values())e=e.concat(t.F);return e}return po(n.i)}Al.prototype.cancel=function(){if(this.i=Sl(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const n of this.g.values())n.cancel();this.g.clear()}};var bg=class{stringify(n){return M.JSON.stringify(n,void 0)}parse(n){return M.JSON.parse(n,void 0)}};function xg(){this.g=new bg}function Cg(n,e,t){const r=t||"";try{gl(n,function(i,s){let o=i;lr(i)&&(o=Do(i)),e.push(r+s+"="+encodeURIComponent(o))})}catch(i){throw e.push(r+"type="+encodeURIComponent("_badmap")),i}}function Li(n,e,t,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch{}}function Pr(n){this.l=n.ec||null,this.j=n.ob||!1}function Bi(n,e){_e.call(this),this.F=n,this.u=e,this.m=void 0,this.readyState=$o,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}ge(Pr,Oo),Pr.prototype.g=function(){return new Bi(this.l,this.j)},Pr.prototype.i=function(n){return function(){return n}}({}),ge(Bi,_e);var $o=0;function bl(n){n.j.read().then(n.Xa.bind(n)).catch(n.ka.bind(n))}function Sr(n){n.readyState=4,n.l=null,n.j=null,n.A=null,br(n)}function br(n){n.onreadystatechange&&n.onreadystatechange.call(n)}(R=Bi.prototype).open=function(n,e){if(this.readyState!=$o)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,br(this)},R.send=function(n){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.F||M).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))},R.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Sr(this)),this.readyState=$o},R.$a=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,br(this)),this.g&&(this.readyState=3,br(this),this.g)))if("arraybuffer"===this.responseType)n.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof M.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;bl(this)}else n.text().then(this.Za.bind(this),this.ka.bind(this))},R.Xa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?Sr(this):br(this),3==this.readyState&&bl(this)}},R.Za=function(n){this.g&&(this.response=this.responseText=n,Sr(this))},R.Ya=function(n){this.g&&(this.response=n,Sr(this))},R.ka=function(){this.g&&Sr(this)},R.setRequestHeader=function(n,e){this.v.append(n,e)},R.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""},R.getAllResponseHeaders=function(){if(!this.h)return"";const n=[],e=this.h.entries();for(var t=e.next();!t.done;)n.push((t=t.value)[0]+": "+t[1]),t=e.next();return n.join("\r\n")},Object.defineProperty(Bi.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(n){this.m=n?"include":"same-origin"}});var Dg=M.JSON.parse;function oe(n){_e.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=xl,this.L=this.M=!1}ge(oe,_e);var xl="",Ng=/^https?$/i,kg=["POST","PUT"];function Cl(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,Vl(n),Ui(n)}function Vl(n){n.F||(n.F=!0,ve(n,"complete"),ve(n,"error"))}function Dl(n){if(n.h&&typeof fo<"u"&&(!n.C[1]||4!=nt(n)||2!=n.da()))if(n.v&&4==nt(n))Mo(n.La,0,n);else if(ve(n,"readystatechange"),4==nt(n)){n.h=!1;try{const o=n.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var r;if(r=0===o){var i=String(n.I).match(_l)[1]||null;!i&&M.self&&M.self.location&&(i=M.self.location.protocol.slice(0,-1)),r=!Ng.test(i?i.toLowerCase():"")}t=r}if(t)ve(n,"complete"),ve(n,"success");else{n.m=6;try{var s=2<nt(n)?n.g.statusText:""}catch{s=""}n.j=s+" ["+n.da()+"]",Vl(n)}}finally{Ui(n)}}}function Ui(n,e){if(n.g){Nl(n);const t=n.g,r=n.C[0]?()=>{}:null;n.g=null,n.C=null,e||ve(n,"ready");try{t.onreadystatechange=r}catch{}}}function Nl(n){n.g&&n.L&&(n.g.ontimeout=null),n.A&&(M.clearTimeout(n.A),n.A=null)}function nt(n){return n.g?n.g.readyState:0}function kl(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.K){case xl:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}function Ml(n){let e="";return Ao(n,function(t,r){e+=r,e+=":",e+=t,e+="\r\n"}),e}function Ko(n,e,t){e:{for(r in t){var r=!1;break e}r=!0}r||(t=Ml(t),"string"==typeof n?null!=t&&encodeURIComponent(String(t)):te(n,e,t))}function xr(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function Ol(n){this.Ga=0,this.j=[],this.l=new Ci,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=xr("failFast",!1,n),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=xr("baseRetryDelayMs",5e3,n),this.hb=xr("retryDelaySeedMs",1e4,n),this.eb=xr("forwardChannelMaxRetries",2,n),this.xa=xr("forwardChannelRequestTimeoutMs",2e4,n),this.va=n&&n.xmlHttpFactory||void 0,this.Ha=n&&n.useFetchStreams||!1,this.L=void 0,this.J=n&&n.supportsCrossDomainXhr||!1,this.K="",this.i=new Al(n&&n.concurrentRequestLimit),this.Ja=new xg,this.P=n&&n.fastHandshake||!1,this.O=n&&n.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=n&&n.bc||!1,n&&n.Ea&&this.l.Ea(),n&&n.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&n&&n.detectBufferingProxy||!1,this.qa=void 0,n&&n.longPollingTimeout&&0<n.longPollingTimeout&&(this.qa=n.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function Qo(n){if(Fl(n),3==n.H){var e=n.W++,t=lt(n.I);if(te(t,"SID",n.K),te(t,"RID",e),te(t,"TYPE","terminate"),Cr(n,t),(e=new Er(n,n.l,e)).L=2,e.A=Fi(lt(t)),t=!1,M.navigator&&M.navigator.sendBeacon)try{t=M.navigator.sendBeacon(e.A.toString(),"")}catch{}!t&&M.Image&&((new Image).src=e.A,t=!0),t||(e.g=Kl(e.l,null),e.g.ha(e.A)),e.G=Date.now(),Tr(e)}jl(n)}function qi(n){n.g&&(Ho(n),n.g.cancel(),n.g=null)}function Fl(n){qi(n),n.u&&(M.clearTimeout(n.u),n.u=null),zi(n),n.i.cancel(),n.m&&("number"==typeof n.m&&M.clearTimeout(n.m),n.m=null)}function Gi(n){if(!wl(n.i)&&!n.m){n.m=!0;var e=n.Na;mr||Yc(),pr||(mr(),pr=!0),No.add(e,n),n.C=0}}function Ll(n,e){var t;t=e?e.m:n.W++;const r=lt(n.I);te(r,"SID",n.K),te(r,"RID",t),te(r,"AID",n.V),Cr(n,r),n.o&&n.s&&Ko(r,n.o,n.s),t=new Er(n,n.l,t,n.C+1),null===n.o&&(t.I=n.s),e&&(n.j=e.F.concat(n.j)),e=Bl(n,t,1e3),t.setTimeout(Math.round(.5*n.xa)+Math.round(.5*n.xa*Math.random())),jo(n.i,t),qo(t,r,e)}function Cr(n,e){n.na&&Ao(n.na,function(t,r){te(e,r,t)}),n.h&&gl({},function(t,r){te(e,r,t)})}function Bl(n,e,t){t=Math.min(n.j.length,t);var r=n.h?xe(n.h.Va,n.h,n):null;e:{var i=n.j;let s=-1;for(;;){const o=["count="+t];-1==s?0<t?(s=i[0].g,o.push("ofs="+s)):s=0:o.push("ofs="+s);let a=!0;for(let u=0;u<t;u++){let c=i[u].g;const l=i[u].map;if(c-=s,0>c)s=Math.max(0,i[u].g-100),a=!1;else try{Cg(l,o,"req"+c+"_")}catch{r&&r(l)}}if(a){r=o.join("&");break e}}}return n=n.j.splice(0,t),e.F=n,r}function Ul(n){if(!n.g&&!n.u){n.ba=1;var e=n.Ma;mr||Yc(),pr||(mr(),pr=!0),No.add(e,n),n.A=0}}function Wo(n){return!(n.g||n.u||3<=n.A||(n.ba++,n.u=yr(xe(n.Ma,n),zl(n,n.A)),n.A++,0))}function Ho(n){null!=n.B&&(M.clearTimeout(n.B),n.B=null)}function ql(n){n.g=new Er(n,n.l,"rpc",n.ba),null===n.o&&(n.g.I=n.s),n.g.O=0;var e=lt(n.wa);te(e,"RID","rpc"),te(e,"SID",n.K),te(e,"AID",n.V),te(e,"CI",n.G?"0":"1"),!n.G&&n.qa&&te(e,"TO",n.qa),te(e,"TYPE","xmlhttp"),Cr(n,e),n.o&&n.s&&Ko(e,n.o,n.s),n.L&&n.g.setTimeout(n.L);var t=n.g;n=n.pa,t.L=1,t.A=Fi(lt(e)),t.u=null,t.S=!0,dl(t,n)}function zi(n){null!=n.v&&(M.clearTimeout(n.v),n.v=null)}function Gl(n,e){var t=null;if(n.g==e){zi(n),Ho(n),n.g=null;var r=2}else{if(!zo(n.i,e))return;t=e.F,Pl(n.i,e),r=1}if(0!=n.H)if(e.i)if(1==r){t=e.u?e.u.length:0,e=Date.now()-e.G;var i=n.C;ve(r=Vi(),new ol(r,t)),Gi(n)}else Ul(n);else if(3==(i=e.s)||0==i&&0<e.ca||!(1==r&&function Fg(n,e){return!(Rl(n.i)>=n.i.j-(n.m?1:0)||(n.m?(n.j=e.F.concat(n.j),0):1==n.H||2==n.H||n.C>=(n.cb?0:n.eb)||(n.m=yr(xe(n.Na,n,e),zl(n,n.C)),n.C++,0)))}(n,e)||2==r&&Wo(n)))switch(t&&0<t.length&&(e=n.i,e.i=e.i.concat(t)),i){case 1:Kt(n,5);break;case 4:Kt(n,10);break;case 3:Kt(n,6);break;default:Kt(n,2)}}function zl(n,e){let t=n.ab+Math.floor(Math.random()*n.hb);return n.isActive()||(t*=2),t*e}function Kt(n,e){if(n.l.info("Error code "+e),2==e){var t=null;n.h&&(t=null);var r=xe(n.pb,n);t||(t=new $t("//www.google.com/images/cleardot.gif"),M.location&&"http"==M.location.protocol||Mi(t,"https"),Fi(t)),function Vg(n,e){const t=new Ci;if(M.Image){const r=new Image;r.onload=wi(Li,t,r,"TestLoadImage: loaded",!0,e),r.onerror=wi(Li,t,r,"TestLoadImage: error",!1,e),r.onabort=wi(Li,t,r,"TestLoadImage: abort",!1,e),r.ontimeout=wi(Li,t,r,"TestLoadImage: timeout",!1,e),M.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else e(!1)}(t.toString(),r)}else ke(2);n.H=0,n.h&&n.h.za(e),jl(n),Fl(n)}function jl(n){if(n.H=0,n.ma=[],n.h){const e=Sl(n.i);(0!=e.length||0!=n.j.length)&&(Lc(n.ma,e),Lc(n.ma,n.j),n.i.i.length=0,po(n.j),n.j.length=0),n.h.ya()}}function $l(n,e,t){var r=t instanceof $t?lt(t):new $t(t);if(""!=r.g)e&&(r.g=e+"."+r.g),Oi(r,r.m);else{var i=M.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var s=new $t(null);r&&Mi(s,r),e&&(s.g=e),i&&Oi(s,i),t&&(s.l=t),r=s}return e=n.Da,(t=n.F)&&e&&te(r,t,e),te(r,"VER",n.ra),Cr(n,r),r}function Kl(n,e,t){if(e&&!n.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new oe(n.Ha&&!n.va?new Pr({ob:t}):n.va)).Oa(n.J),e}function Ql(){}function ji(){if(gn&&!(10<=Number(Zp)))throw Error("Environmental error: no available transport.")}function Ue(n,e){_e.call(this),this.g=new Ol(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(n?n["X-WebChannel-Client-Profile"]=e.Ca:n={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=n,(n=e&&e.cc)&&!hr(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!hr(e)&&(this.g.F=e,null!==(n=this.h)&&e in n&&e in(n=this.h)&&delete n[e]),this.j=new In(this)}function Wl(n){Fo.call(this),n.__headers__&&(this.headers=n.__headers__,this.statusCode=n.__status__,delete n.__headers__,delete n.__status__);var e=n.__sm__;if(e){e:{for(const t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=null!==e&&n in e?e[n]:void 0),this.data=e}else this.data=n}function Hl(){Lo.call(this),this.status=1}function In(n){this.g=n}function Xe(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function Zo(n,e,t){t||(t=0);var r=Array(16);if("string"==typeof e)for(var i=0;16>i;++i)r[i]=e.charCodeAt(t++)|e.charCodeAt(t++)<<8|e.charCodeAt(t++)<<16|e.charCodeAt(t++)<<24;else for(i=0;16>i;++i)r[i]=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;var s=n.g[3],o=(e=n.g[0])+(s^(t=n.g[1])&((i=n.g[2])^s))+r[0]+3614090360&4294967295;o=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=t+(o<<7&4294967295|o>>>25))+((o=s+(i^e&(t^i))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=i+(t^s&(e^t))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^i&(s^e))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^t&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(t^i))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=i+(t^s&(e^t))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^i&(s^e))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^t&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(t^i))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=i+(t^s&(e^t))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^i&(s^e))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^t&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(t^i))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=i+(t^s&(e^t))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^i&(s^e))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^s&(t^i))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(t^i&(e^t))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^t&(s^e))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=t+(s^e&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(t^i))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(t^i&(e^t))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^t&(s^e))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=t+(s^e&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(t^i))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(t^i&(e^t))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^t&(s^e))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=t+(s^e&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(t^i))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(t^i&(e^t))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^t&(s^e))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=t+(s^e&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=e+(t^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^t^i)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^t)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=t+(i^s^e)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=e+(t^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^t^i)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^t)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=t+(i^s^e)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=e+(t^i^s)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^t^i)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^t)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=t+(i^s^e)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=e+(t^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^t^i)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^t)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=t+(i^s^e)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=e+(i^(t|~s))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(t^(e|~i))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~t))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=t+(s^(i|~e))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=e+(i^(t|~s))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(t^(e|~i))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~t))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=t+(s^(i|~e))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=e+(i^(t|~s))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(t^(e|~i))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~t))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=t+(s^(i|~e))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(e=t+((o=e+(i^(t|~s))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(t^(e|~i))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((i=s+((o=i+(e^(s|~t))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~e))+r[9]+3951481745&4294967295,n.g[0]=n.g[0]+e&4294967295,n.g[1]=n.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,n.g[2]=n.g[2]+i&4294967295,n.g[3]=n.g[3]+s&4294967295}function K(n,e){this.h=e;for(var t=[],r=!0,i=n.length-1;0<=i;i--){var s=0|n[i];r&&s==e||(t[i]=s,r=!1)}this.g=t}(R=oe.prototype).Oa=function(n){this.M=n},R.ha=function(n,e,t,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+n);e=e?e.toUpperCase():"GET",this.I=n,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():Bo.g(),this.C=function ul(n){return n.h||(n.h=n.i())}(this.u?this.u:Bo),this.g.onreadystatechange=xe(this.La,this);try{this.G=!0,this.g.open(e,String(n),!0),this.G=!1}catch(s){return void Cl(this,s)}if(n=t||"",t=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)t.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const s of r.keys())t.set(s,r.get(s))}r=Array.from(t.keys()).find(s=>"content-type"==s.toLowerCase()),i=M.FormData&&n instanceof M.FormData,!(0<=Fc(kg,e))||r||i||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[s,o]of t)this.g.setRequestHeader(s,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{Nl(this),0<this.B&&((this.L=function Mg(n){return gn&&"number"==typeof n.timeout&&void 0!==n.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=xe(this.ua,this)):this.A=Mo(this.ua,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(s){Cl(this,s)}},R.ua=function(){typeof fo<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,ve(this,"timeout"),this.abort(8))},R.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,ve(this,"complete"),ve(this,"abort"),Ui(this))},R.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Ui(this,!0)),oe.$.N.call(this)},R.La=function(){this.s||(this.G||this.v||this.l?Dl(this):this.kb())},R.kb=function(){Dl(this)},R.isActive=function(){return!!this.g},R.da=function(){try{return 2<nt(this)?this.g.status:-1}catch{return-1}},R.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}},R.Wa=function(n){if(this.g){var e=this.g.responseText;return n&&0==e.indexOf(n)&&(e=e.substring(n.length)),Dg(e)}},R.Ia=function(){return this.m},R.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(R=Ol.prototype).ra=8,R.H=1,R.Na=function(n){if(this.m)if(this.m=null,1==this.H){if(!n){this.W=Math.floor(1e5*Math.random()),n=this.W++;const i=new Er(this,this.l,n);let s=this.s;if(this.U&&(s?(s=zc(s),$c(s,this.U)):s=this.U),null!==this.o||this.O||(i.I=s,s=null),this.P)e:{for(var e=0,t=0;t<this.j.length;t++){var r=this.j[t];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=t;break e}if(4096===e||t===this.j.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=Bl(this,i,e),te(t=lt(this.I),"RID",n),te(t,"CVER",22),this.F&&te(t,"X-HTTP-Session-Id",this.F),Cr(this,t),s&&(this.O?e="headers="+encodeURIComponent(String(Ml(s)))+"&"+e:this.o&&Ko(t,this.o,s)),jo(this.i,i),this.bb&&te(t,"TYPE","init"),this.P?(te(t,"$req",e),te(t,"SID","null"),i.aa=!0,qo(i,t,null)):qo(i,t,e),this.H=2}}else 3==this.H&&(n?Ll(this,n):0==this.j.length||wl(this.i)||Ll(this))},R.Ma=function(){if(this.u=null,ql(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var n=2*this.S;this.l.info("BP detection timer enabled: "+n),this.B=yr(xe(this.jb,this),n)}},R.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,ke(10),qi(this),ql(this))},R.ib=function(){null!=this.v&&(this.v=null,qi(this),Wo(this),ke(19))},R.pb=function(n){n?(this.l.info("Successfully pinged google.com"),ke(2)):(this.l.info("Failed to ping google.com"),ke(1))},R.isActive=function(){return!!this.h&&this.h.isActive(this)},(R=Ql.prototype).Ba=function(){},R.Aa=function(){},R.za=function(){},R.ya=function(){},R.isActive=function(){return!0},R.Va=function(){},ji.prototype.g=function(n,e){return new Ue(n,e)},ge(Ue,_e),Ue.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var n=this.g,e=this.l,t=this.h||void 0;ke(0),n.Y=e,n.na=t||{},n.G=n.aa,n.I=$l(n,null,n.Y),Gi(n)},Ue.prototype.close=function(){Qo(this.g)},Ue.prototype.u=function(n){var e=this.g;if("string"==typeof n){var t={};t.__data__=n,n=t}else this.v&&((t={}).__data__=Do(n),n=t);e.j.push(new Pg(e.fb++,n)),3==e.H&&Gi(e)},Ue.prototype.N=function(){this.g.h=null,delete this.j,Qo(this.g),delete this.g,Ue.$.N.call(this)},ge(Wl,Fo),ge(Hl,Lo),ge(In,Ql),In.prototype.Ba=function(){ve(this.g,"a")},In.prototype.Aa=function(n){ve(this.g,new Wl(n))},In.prototype.za=function(n){ve(this.g,new Hl)},In.prototype.ya=function(){ve(this.g,"b")},ge(Xe,function Lg(){this.blockSize=-1}),Xe.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},Xe.prototype.j=function(n,e){void 0===e&&(e=n.length);for(var t=e-this.blockSize,r=this.m,i=this.h,s=0;s<e;){if(0==i)for(;s<=t;)Zo(this,n,s),s+=this.blockSize;if("string"==typeof n){for(;s<e;)if(r[i++]=n.charCodeAt(s++),i==this.blockSize){Zo(this,r),i=0;break}}else for(;s<e;)if(r[i++]=n[s++],i==this.blockSize){Zo(this,r),i=0;break}}this.h=i,this.i+=e},Xe.prototype.l=function(){var n=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);n[0]=128;for(var e=1;e<n.length-8;++e)n[e]=0;var t=8*this.i;for(e=n.length-8;e<n.length;++e)n[e]=255&t,t/=256;for(this.j(n),n=Array(16),e=t=0;4>e;++e)for(var r=0;32>r;r+=8)n[t++]=this.g[e]>>>r&255;return n};var Bg={};function Jo(n){return-128<=n&&128>n?function Qp(n,e){var t=Bg;return Object.prototype.hasOwnProperty.call(t,n)?t[n]:t[n]=e(n)}(n,function(e){return new K([0|e],0>e?-1:0)}):new K([0|n],0>n?-1:0)}function rt(n){if(isNaN(n)||!isFinite(n))return En;if(0>n)return Ae(rt(-n));for(var e=[],t=1,r=0;n>=t;r++)e[r]=n/t|0,t*=Yo;return new K(e,0)}var Yo=4294967296,En=Jo(0),Xo=Jo(1),Jl=Jo(16777216);function ht(n){if(0!=n.h)return!1;for(var e=0;e<n.g.length;e++)if(0!=n.g[e])return!1;return!0}function We(n){return-1==n.h}function Ae(n){for(var e=n.g.length,t=[],r=0;r<e;r++)t[r]=~n.g[r];return new K(t,~n.h).add(Xo)}function $i(n,e){return n.add(Ae(e))}function Ki(n,e){for(;(65535&n[e])!=n[e];)n[e+1]+=n[e]>>>16,n[e]&=65535,e++}function Vr(n,e){this.g=n,this.h=e}function Qi(n,e){if(ht(e))throw Error("division by zero");if(ht(n))return new Vr(En,En);if(We(n))return e=Qi(Ae(n),e),new Vr(Ae(e.g),Ae(e.h));if(We(e))return e=Qi(n,Ae(e)),new Vr(Ae(e.g),e.h);if(30<n.g.length){if(We(n)||We(e))throw Error("slowDivide_ only works with positive integers.");for(var t=Xo,r=e;0>=r.X(n);)t=Yl(t),r=Yl(r);var i=Tn(t,1),s=Tn(r,1);for(r=Tn(r,2),t=Tn(t,2);!ht(r);){var o=s.add(r);0>=o.X(n)&&(i=i.add(t),s=o),r=Tn(r,1),t=Tn(t,1)}return e=$i(n,i.R(e)),new Vr(i,e)}for(i=En;0<=n.X(e);){for(t=Math.max(1,Math.floor(n.ea()/e.ea())),r=48>=(r=Math.ceil(Math.log(t)/Math.LN2))?1:Math.pow(2,r-48),o=(s=rt(t)).R(e);We(o)||0<o.X(n);)o=(s=rt(t-=r)).R(e);ht(s)&&(s=Xo),i=i.add(s),n=$i(n,o)}return new Vr(i,n)}function Yl(n){for(var e=n.g.length+1,t=[],r=0;r<e;r++)t[r]=n.D(r)<<1|n.D(r-1)>>>31;return new K(t,n.h)}function Tn(n,e){var t=e>>5;e%=32;for(var r=n.g.length-t,i=[],s=0;s<r;s++)i[s]=0<e?n.D(s+t)>>>e|n.D(s+t+1)<<32-e:n.D(s+t);return new K(i,n.h)}(R=K.prototype).ea=function(){if(We(this))return-Ae(this).ea();for(var n=0,e=1,t=0;t<this.g.length;t++){var r=this.D(t);n+=(0<=r?r:Yo+r)*e,e*=Yo}return n},R.toString=function(n){if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if(ht(this))return"0";if(We(this))return"-"+Ae(this).toString(n);for(var e=rt(Math.pow(n,6)),t=this,r="";;){var i=Qi(t,e).g,s=((0<(t=$i(t,i.R(e))).g.length?t.g[0]:t.h)>>>0).toString(n);if(ht(t=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},R.D=function(n){return 0>n?0:n<this.g.length?this.g[n]:this.h},R.X=function(n){return We(n=$i(this,n))?-1:ht(n)?0:1},R.abs=function(){return We(this)?Ae(this):this},R.add=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0,i=0;i<=e;i++){var s=r+(65535&this.D(i))+(65535&n.D(i)),o=(s>>>16)+(this.D(i)>>>16)+(n.D(i)>>>16);r=o>>>16,t[i]=(o&=65535)<<16|(s&=65535)}return new K(t,-2147483648&t[t.length-1]?-1:0)},R.R=function(n){if(ht(this)||ht(n))return En;if(We(this))return We(n)?Ae(this).R(Ae(n)):Ae(Ae(this).R(n));if(We(n))return Ae(this.R(Ae(n)));if(0>this.X(Jl)&&0>n.X(Jl))return rt(this.ea()*n.ea());for(var e=this.g.length+n.g.length,t=[],r=0;r<2*e;r++)t[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<n.g.length;i++){var s=this.D(r)>>>16,o=65535&this.D(r),a=n.D(i)>>>16,u=65535&n.D(i);t[2*r+2*i]+=o*u,Ki(t,2*r+2*i),t[2*r+2*i+1]+=s*u,Ki(t,2*r+2*i+1),t[2*r+2*i+1]+=o*a,Ki(t,2*r+2*i+1),t[2*r+2*i+2]+=s*a,Ki(t,2*r+2*i+2)}for(r=0;r<e;r++)t[r]=t[2*r+1]<<16|t[2*r];for(r=e;r<2*e;r++)t[r]=0;return new K(t,0)},R.gb=function(n){return Qi(this,n).h},R.and=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)&n.D(r);return new K(t,this.h&n.h)},R.or=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)|n.D(r);return new K(t,this.h|n.h)},R.xor=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)^n.D(r);return new K(t,this.h^n.h)},ji.prototype.createWebChannel=ji.prototype.g,Ue.prototype.send=Ue.prototype.u,Ue.prototype.open=Ue.prototype.m,Ue.prototype.close=Ue.prototype.close,Di.NO_ERROR=0,Di.TIMEOUT=8,Di.HTTP_ERROR=6,al.COMPLETE="complete",cl.EventType=Ir,Ir.OPEN="a",Ir.CLOSE="b",Ir.ERROR="c",Ir.MESSAGE="d",_e.prototype.listen=_e.prototype.O,oe.prototype.listenOnce=oe.prototype.P,oe.prototype.getLastError=oe.prototype.Sa,oe.prototype.getLastErrorCode=oe.prototype.Ia,oe.prototype.getStatus=oe.prototype.da,oe.prototype.getResponseJson=oe.prototype.Wa,oe.prototype.getResponseText=oe.prototype.ja,oe.prototype.send=oe.prototype.ha,oe.prototype.setWithCredentials=oe.prototype.Oa,Xe.prototype.digest=Xe.prototype.l,Xe.prototype.reset=Xe.prototype.reset,Xe.prototype.update=Xe.prototype.j,K.prototype.add=K.prototype.add,K.prototype.multiply=K.prototype.R,K.prototype.modulo=K.prototype.gb,K.prototype.compare=K.prototype.X,K.prototype.toNumber=K.prototype.ea,K.prototype.toString=K.prototype.toString,K.prototype.getBits=K.prototype.D,K.fromNumber=rt,K.fromString=function Zl(n,e){if(0==n.length)throw Error("number format error: empty string");if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if("-"==n.charAt(0))return Ae(Zl(n.substring(1),e));if(0<=n.indexOf("-"))throw Error('number format error: interior "-" character');for(var t=rt(Math.pow(e,8)),r=En,i=0;i<n.length;i+=8){var s=Math.min(8,n.length-i),o=parseInt(n.substring(i,i+s),e);8>s?(s=rt(Math.pow(e,s)),r=r.R(s).add(rt(o))):r=(r=r.R(t)).add(rt(o))}return r};var Ug=Ye.createWebChannelTransport=function(){return new ji},qg=Ye.getStatEventTarget=function(){return Vi()},ea=Ye.ErrorCode=Di,Gg=Ye.EventType=al,zg=Ye.Event=zt,Xl=Ye.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},Wi=(Ye.FetchXmlHttpFactory=Pr,Ye.WebChannel=cl),jg=Ye.XhrIo=oe,$g=Ye.Md5=Xe,vn=Ye.Integer=K;const eh="@firebase/firestore";class ye{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}ye.UNAUTHENTICATED=new ye(null),ye.GOOGLE_CREDENTIALS=new ye("google-credentials-uid"),ye.FIRST_PARTY=new ye("first-party-uid"),ye.MOCK_USER=new ye("mock-user");let An="10.7.2";const vt=new Ac("@firebase/firestore");function wn(){return vt.logLevel}function y(n,...e){if(vt.logLevel<=j.DEBUG){const t=e.map(ta);vt.debug(`Firestore (${An}): ${n}`,...t)}}function ue(n,...e){if(vt.logLevel<=j.ERROR){const t=e.map(ta);vt.error(`Firestore (${An}): ${n}`,...t)}}function qe(n,...e){if(vt.logLevel<=j.WARN){const t=e.map(ta);vt.warn(`Firestore (${An}): ${n}`,...t)}}function ta(n){if("string"==typeof n)return n;try{return JSON.stringify(n)}catch{return n}}function P(n="Unexpected state"){const e=`FIRESTORE (${An}) INTERNAL ASSERTION FAILED: `+n;throw ue(e),new Error(e)}function x(n,e){n||P()}function v(n,e){return n}const g={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class I extends fn{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class fe{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class th{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Kg{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(ye.UNAUTHENTICATED))}shutdown(){}}class Qg{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Wg{constructor(e){this.t=e,this.currentUser=ye.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var r=this;let i=this.i;const s=c=>this.i!==i?(i=this.i,t(c)):Promise.resolve();let o=new fe;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new fe,e.enqueueRetryable(()=>s(this.currentUser))};const a=()=>{const c=o;e.enqueueRetryable((0,_.Z)(function*(){yield c.promise,yield s(r.currentUser)}))},u=c=>{y("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.auth.addAuthTokenListener(this.o),a()};this.t.onInit(c=>u(c)),setTimeout(()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?u(c):(y("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new fe)}},0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(y("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(x("string"==typeof r.accessToken),new th(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return x(null===e||"string"==typeof e),new ye(e)}}class Hg{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=ye.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Zg{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new Hg(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(ye.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class nh{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Jg{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const r=s=>{null!=s.error&&y("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const o=s.token!==this.R;return this.R=s.token,y("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};const i=s=>{y("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.A.getImmediate({optional:!0});s?i(s):y("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(x("string"==typeof t.token),this.R=t.token,new nh(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function Yg(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class rh{static newId(){const t=62*Math.floor(256/62);let r="";for(;r.length<20;){const i=Yg(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(i[s]%62))}return r}}function k(n,e){return n<e?-1:n>e?1:0}function Rn(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}class se{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new I(g.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new I(g.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new I(g.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new I(g.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return se.fromMillis(Date.now())}static fromDate(e){return se.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new se(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?k(this.nanoseconds,e.nanoseconds):k(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class C{constructor(e){this.timestamp=e}static fromTimestamp(e){return new C(e)}static min(){return new C(new se(0,0))}static max(){return new C(new se(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Dr{constructor(e,t,r){void 0===t?t=0:t>e.length&&P(),void 0===r?r=e.length-t:r>e.length-t&&P(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===Dr.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Dr?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let i=0;i<r;i++){const s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class U extends Dr{construct(e,t,r){return new U(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new I(g.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new U(t)}static emptyPath(){return new U([])}}const Xg=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class re extends Dr{construct(e,t,r){return new re(e,t,r)}static isValidIdentifier(e){return Xg.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),re.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new re(["__name__"])}static fromServerFormat(e){const t=[];let r="",i=0;const s=()=>{if(0===r.length)throw new I(g.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;i<e.length;){const a=e[i];if("\\"===a){if(i+1===e.length)throw new I(g.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new I(g.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,i+=2}else"`"===a?(o=!o,i++):"."!==a||o?(r+=a,i++):(s(),i++)}if(s(),o)throw new I(g.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new re(t)}static emptyPath(){return new re([])}}class w{constructor(e){this.path=e}static fromPath(e){return new w(U.fromString(e))}static fromName(e){return new w(U.fromString(e).popFirst(5))}static empty(){return new w(U.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===U.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return U.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new w(new U(e.slice()))}}function oh(n){return new Ge(n.readTime,n.key,-1)}class Ge{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Ge(C.min(),w.empty(),-1)}static max(){return new Ge(C.max(),w.empty(),-1)}}function ra(n,e){let t=n.readTime.compareTo(e.readTime);return 0!==t?t:(t=w.comparator(n.documentKey,e.documentKey),0!==t?t:k(n.largestBatchId,e.largestBatchId))}const ah="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class n_{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function At(n){return ia.apply(this,arguments)}function ia(){return ia=(0,_.Z)(function*(n){if(n.code!==g.FAILED_PRECONDITION||n.message!==ah)throw n;y("LocalStore","Unexpectedly lost primary lease")}),ia.apply(this,arguments)}class m{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&P(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new m((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof m?t:m.resolve(t)}catch(t){return m.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):m.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):m.reject(t)}static resolve(e){return new m((t,r)=>{t(e)})}static reject(e){return new m((t,r)=>{r(e)})}static waitFor(e){return new m((t,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},u=>r(u))}),o=!0,s===i&&t()})}static or(e){let t=m.resolve(!1);for(const r of e)t=t.next(i=>i?m.resolve(i):r());return t}static forEach(e,t){const r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new m((r,i)=>{const s=e.length,o=new Array(s);let a=0;for(let u=0;u<s;u++){const c=u;t(e[c]).next(l=>{o[c]=l,++a,a===s&&r(o)},l=>i(l))}})}static doWhile(e,t){return new m((r,i)=>{const s=()=>{!0===e()?t().next(()=>{s()},i):r()};s()})}}class Hi{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new fe,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new Nr(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{const i=sa(r.target.error);this.V.reject(new Nr(e,i))}}static open(e,t,r,i){try{return new Hi(t,e.transaction(i,r))}catch(s){throw new Nr(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(y("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new i_(t)}}class He{constructor(e,t,r){this.name=e,this.version=t,this.p=r,12.2===He.S($())&&ue("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return y("SimpleDb","Removing database:",e),Ht(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!yc())return!1;if(He.C())return!0;const e=$(),t=He.S(e),r=0<t&&t<10,i=He.v(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static C(){var e;return typeof process<"u"&&"YES"===(null===(e=process.__PRIVATE_env)||void 0===e?void 0:e.F)}static M(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}static v(e){const t=e.match(/Android ([\d.]+)/i),r=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(r)}O(e){var t=this;return(0,_.Z)(function*(){return t.db||(y("SimpleDb","Opening database:",t.name),t.db=yield new Promise((r,i)=>{const s=indexedDB.open(t.name,t.version);s.onsuccess=o=>{r(o.target.result)},s.onblocked=()=>{i(new Nr(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=o=>{const a=o.target.error;i("VersionError"===a.name?new I(g.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===a.name?new I(g.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a):new Nr(e,a))},s.onupgradeneeded=o=>{y("SimpleDb",'Database "'+t.name+'" requires upgrade from version:',o.oldVersion),t.p.N(o.target.result,s.transaction,o.oldVersion,t.version).next(()=>{y("SimpleDb","Database upgrade to version "+t.version+" complete")})}})),t.B&&(t.db.onversionchange=r=>t.B(r)),t.db})()}L(e){this.B=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){var s=this;return(0,_.Z)(function*(){const o="readonly"===t;let a=0;for(;;){++a;try{s.db=yield s.O(e);const u=Hi.open(s.db,e,o?"readonly":"readwrite",r),c=i(u).next(l=>(u.g(),l)).catch(l=>(u.abort(l),m.reject(l))).toPromise();return c.catch(()=>{}),yield u.m,c}catch(u){const c=u,l="FirebaseError"!==c.name&&a<3;if(y("SimpleDb","Transaction failed with error:",c.message,"Retrying:",l),s.close(),!l)return Promise.reject(c)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}class r_{constructor(e){this.k=e,this.q=!1,this.K=null}get isDone(){return this.q}get $(){return this.K}set cursor(e){this.k=e}done(){this.q=!0}U(e){this.K=e}delete(){return Ht(this.k.delete())}}class Nr extends I{constructor(e,t){super(g.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function wt(n){return"IndexedDbTransactionError"===n.name}class i_{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(y("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(y("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Ht(r)}add(e){return y("SimpleDb","ADD",this.store.name,e,e),Ht(this.store.add(e))}get(e){return Ht(this.store.get(e)).next(t=>(void 0===t&&(t=null),y("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return y("SimpleDb","DELETE",this.store.name,e),Ht(this.store.delete(e))}count(){return y("SimpleDb","COUNT",this.store.name),Ht(this.store.count())}W(e,t){const r=this.options(e,t),i=r.index?this.store.index(r.index):this.store;if("function"==typeof i.getAll){const s=i.getAll(r.range);return new m((o,a)=>{s.onerror=u=>{a(u.target.error)},s.onsuccess=u=>{o(u.target.result)}})}{const s=this.cursor(r),o=[];return this.G(s,(a,u)=>{o.push(u)}).next(()=>o)}}j(e,t){const r=this.store.getAll(e,null===t?void 0:t);return new m((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}H(e,t){y("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.J=!1;const i=this.cursor(r);return this.G(i,(s,o,a)=>a.delete())}Y(e,t){let r;t?r=e:(r={},t=e);const i=this.cursor(r);return this.G(i,t)}Z(e){const t=this.cursor({});return new m((r,i)=>{t.onerror=s=>{const o=sa(s.target.error);i(o)},t.onsuccess=s=>{const o=s.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}G(e,t){const r=[];return new m((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void i();const u=new r_(a),c=t(a.primaryKey,a.value,u);if(c instanceof m){const l=c.catch(h=>(u.done(),m.reject(h)));r.push(l)}u.isDone?i():null===u.$?a.continue():a.continue(u.$)}}).next(()=>m.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.J?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Ht(n){return new m((e,t)=>{n.onsuccess=r=>{e(r.target.result)},n.onerror=r=>{const i=sa(r.target.error);t(i)}})}let uh=!1;function sa(n){const e=He.S($());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new I("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return uh||(uh=!0,setTimeout(()=>{throw r},0)),r}}return n}let ze=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.se(i),this.oe=i=>r.writeSequenceNumber(i))}se(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.oe&&this.oe(t),t}}return n._e=-1,n})();function kr(n){return null==n}function Mr(n){return 0===n&&1/n==-1/0}function gh(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Rt(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function _h(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class X{constructor(e,t){this.comparator=e,this.root=t||we.EMPTY}insert(e,t){return new X(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,we.BLACK,null,null))}remove(e){return new X(this.comparator,this.root.remove(e,this.comparator).copy(null,null,we.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(0===i)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Ji(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Ji(this.root,e,this.comparator,!1)}getReverseIterator(){return new Ji(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Ji(this.root,e,this.comparator,!0)}}class Ji{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class we{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=null!=r?r:we.RED,this.left=null!=i?i:we.EMPTY,this.right=null!=s?s:we.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new we(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this;const s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):0===s?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return we.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return we.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,we.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,we.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw P();const e=this.left.check();if(e!==this.right.check())throw P();return e+(this.isRed()?0:1)}}we.EMPTY=null,we.RED=!0,we.BLACK=!1,we.EMPTY=new class{constructor(){this.size=0}get key(){throw P()}get value(){throw P()}get color(){throw P()}get left(){throw P()}get right(){throw P()}copy(e,t,r,i,s){return this}insert(e,t,r){return new we(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class H{constructor(e){this.comparator=e,this.data=new X(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new yh(this.data.getIterator())}getIteratorFrom(e){return new yh(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof H)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(0!==this.comparator(i,s))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new H(this.comparator);return t.data=e,t}}class yh{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Fe{constructor(e){this.fields=e,e.sort(re.comparator)}static empty(){return new Fe([])}unionWith(e){let t=new H(re.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Fe(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Rn(this.fields,e.fields,(t,r)=>t.isEqual(r))}}class Ih extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class me{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Ih("Invalid base64 string: "+s):s}}(e);return new me(t)}static fromUint8Array(e){const t=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new me(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return k(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}me.EMPTY_BYTE_STRING=new me("");const R_=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Pt(n){if(x(!!n),"string"==typeof n){let e=0;const t=R_.exec(n);if(x(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:ae(n.seconds),nanos:ae(n.nanos)}}function ae(n){return"number"==typeof n?n:"string"==typeof n?Number(n):0}function dt(n){return"string"==typeof n?me.fromBase64String(n):me.fromUint8Array(n)}function Yi(n){var e,t;return"server_timestamp"===(null===(t=((null===(e=null==n?void 0:n.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function Xi(n){const e=n.mapValue.fields.__previous_value__;return Yi(e)?Xi(e):e}function Or(n){const e=Pt(n.mapValue.fields.__local_write_time__.timestampValue);return new se(e.seconds,e.nanos)}class P_{constructor(e,t,r,i,s,o,a,u,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=u,this.useFetchStreams=c}}class Zt{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Zt("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof Zt&&e.projectId===this.projectId&&e.database===this.database}}const St={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function bt(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Yi(n)?4:Ah(n)?9007199254740991:10:P()}function st(n,e){if(n===e)return!0;const t=bt(n);if(t!==bt(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Or(n).isEqual(Or(e));case 3:return function(i,s){if("string"==typeof i.timestampValue&&"string"==typeof s.timestampValue&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const o=Pt(i.timestampValue),a=Pt(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return s=e,dt(n.bytesValue).isEqual(dt(s.bytesValue));case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,s){return ae(i.geoPointValue.latitude)===ae(s.geoPointValue.latitude)&&ae(i.geoPointValue.longitude)===ae(s.geoPointValue.longitude)}(n,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return ae(i.integerValue)===ae(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const o=ae(i.doubleValue),a=ae(s.doubleValue);return o===a?Mr(o)===Mr(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return Rn(n.arrayValue.values||[],e.arrayValue.values||[],st);case 10:return function(i,s){const o=i.mapValue.fields||{},a=s.mapValue.fields||{};if(gh(o)!==gh(a))return!1;for(const u in o)if(o.hasOwnProperty(u)&&(void 0===a[u]||!st(o[u],a[u])))return!1;return!0}(n,e);default:return P()}var s}function Fr(n,e){return void 0!==(n.values||[]).find(t=>st(t,e))}function xt(n,e){if(n===e)return 0;const t=bt(n),r=bt(e);if(t!==r)return k(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return k(n.booleanValue,e.booleanValue);case 2:return function(s,o){const a=ae(s.integerValue||s.doubleValue),u=ae(o.integerValue||o.doubleValue);return a<u?-1:a>u?1:a===u?0:isNaN(a)?isNaN(u)?0:-1:1}(n,e);case 3:return Eh(n.timestampValue,e.timestampValue);case 4:return Eh(Or(n),Or(e));case 5:return k(n.stringValue,e.stringValue);case 6:return function(s,o){const a=dt(s),u=dt(o);return a.compareTo(u)}(n.bytesValue,e.bytesValue);case 7:return function(s,o){const a=s.split("/"),u=o.split("/");for(let c=0;c<a.length&&c<u.length;c++){const l=k(a[c],u[c]);if(0!==l)return l}return k(a.length,u.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,o){const a=k(ae(s.latitude),ae(o.latitude));return 0!==a?a:k(ae(s.longitude),ae(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(s,o){const a=s.values||[],u=o.values||[];for(let c=0;c<a.length&&c<u.length;++c){const l=xt(a[c],u[c]);if(l)return l}return k(a.length,u.length)}(n.arrayValue,e.arrayValue);case 10:return function(s,o){if(s===St.mapValue&&o===St.mapValue)return 0;if(s===St.mapValue)return 1;if(o===St.mapValue)return-1;const a=s.fields||{},u=Object.keys(a),c=o.fields||{},l=Object.keys(c);u.sort(),l.sort();for(let h=0;h<u.length&&h<l.length;++h){const d=k(u[h],l[h]);if(0!==d)return d;const p=xt(a[u[h]],c[l[h]]);if(0!==p)return p}return k(u.length,l.length)}(n.mapValue,e.mapValue);default:throw P()}}function Eh(n,e){if("string"==typeof n&&"string"==typeof e&&n.length===e.length)return k(n,e);const t=Pt(n),r=Pt(e),i=k(t.seconds,r.seconds);return 0!==i?i:k(t.nanos,r.nanos)}function xn(n){return aa(n)}function aa(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=Pt(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?dt(n.bytesValue).toBase64():"referenceValue"in n?w.fromName(n.referenceValue).toString():"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(const s of t.values||[])i?i=!1:r+=",",r+=aa(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let i="{",s=!0;for(const o of r)s?s=!1:i+=",",i+=`${o}:${aa(t.fields[o])}`;return i+"}"}(n.mapValue):P()}function ua(n){return!!n&&"integerValue"in n}function Lr(n){return!!n&&"arrayValue"in n}function Th(n){return!!n&&"nullValue"in n}function vh(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function ns(n){return!!n&&"mapValue"in n}function Br(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&"object"==typeof n.timestampValue)return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Rt(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Br(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Br(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Ah(n){return"__max__"===(((n.mapValue||{}).fields||{}).__type__||{}).stringValue}class Re{constructor(e){this.value=e}static empty(){return new Re({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!ns(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Br(t)}setAll(e){let t=re.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const u=this.getFieldsMap(t);this.applyChanges(u,r,i),r={},i=[],t=a.popLast()}o?r[a.lastSegment()]=Br(o):i.push(a.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){const t=this.field(e.popLast());ns(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return st(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];ns(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Rt(t,(i,s)=>e[i]=s);for(const i of r)delete e[i]}clone(){return new Re(Br(this.value))}}function Ph(n){const e=[];return Rt(n.fields,(t,r)=>{const i=new re([t]);if(ns(r)){const s=Ph(r.mapValue).fields;if(0===s.length)e.push(i);else for(const o of s)e.push(i.child(o))}else e.push(i)}),new Fe(e)}class ne{constructor(e,t,r,i,s,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new ne(e,0,C.min(),C.min(),C.min(),Re.empty(),0)}static newFoundDocument(e,t,r,i){return new ne(e,1,t,C.min(),r,i,0)}static newNoDocument(e,t){return new ne(e,2,t,C.min(),C.min(),Re.empty(),0)}static newUnknownDocument(e,t){return new ne(e,3,t,C.min(),C.min(),Re.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(C.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Re.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Re.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=C.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof ne&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ne(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Ct{constructor(e,t){this.position=e,this.inclusive=t}}function Sh(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){const s=e[i],o=n.position[i];if(r=s.field.isKeyField()?w.comparator(w.fromName(o.referenceValue),t.key):xt(o,t.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function bh(n,e){if(null===n)return null===e;if(null===e||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!st(n.position[t],e.position[t]))return!1;return!0}class Ur{constructor(e,t="asc"){this.field=e,this.dir=t}}function x_(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class xh{}class q extends xh{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new C_(e,t,r):"array-contains"===t?new N_(e,r):"in"===t?new Mh(e,r):"not-in"===t?new k_(e,r):"array-contains-any"===t?new M_(e,r):new q(e,t,r)}static createKeyFieldInFilter(e,t,r){return"in"===t?new V_(e,r):new D_(e,r)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(xt(t,this.value)):null!==t&&bt(this.value)===bt(t)&&this.matchesComparison(xt(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return P()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Q extends xh{constructor(e,t){super(),this.filters=e,this.op=t,this.ue=null}static create(e,t){return new Q(e,t)}matches(e){return Cn(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ue||(this.ue=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ue}getFilters(){return Object.assign([],this.filters)}}function Cn(n){return"and"===n.op}function la(n){return function Ch(n){for(const e of n.filters)if(e instanceof Q)return!1;return!0}(n)&&Cn(n)}function ha(n){if(n instanceof q)return n.field.canonicalString()+n.op.toString()+xn(n.value);if(la(n))return n.filters.map(e=>ha(e)).join(",");{const e=n.filters.map(t=>ha(t)).join(",");return`${n.op}(${e})`}}function Vh(n,e){return n instanceof q?(r=n,(i=e)instanceof q&&r.op===i.op&&r.field.isEqual(i.field)&&st(r.value,i.value)):n instanceof Q?function(r,i){return i instanceof Q&&r.op===i.op&&r.filters.length===i.filters.length&&r.filters.reduce((s,o,a)=>s&&Vh(o,i.filters[a]),!0)}(n,e):void P();var r,i}function Nh(n){return n instanceof q?`${(t=n).field.canonicalString()} ${t.op} ${xn(t.value)}`:n instanceof Q?function(t){return t.op.toString()+" {"+t.getFilters().map(Nh).join(" ,")+"}"}(n):"Filter";var t}class C_ extends q{constructor(e,t,r){super(e,t,r),this.key=w.fromName(r.referenceValue)}matches(e){const t=w.comparator(e.key,this.key);return this.matchesComparison(t)}}class V_ extends q{constructor(e,t){super(e,"in",t),this.keys=kh(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class D_ extends q{constructor(e,t){super(e,"not-in",t),this.keys=kh(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function kh(n,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(r=>w.fromName(r.referenceValue))}class N_ extends q{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Lr(t)&&Fr(t.arrayValue,this.value)}}class Mh extends q{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Fr(this.value.arrayValue,t)}}class k_ extends q{constructor(e,t){super(e,"not-in",t)}matches(e){if(Fr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Fr(this.value.arrayValue,t)}}class M_ extends q{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Lr(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Fr(this.value.arrayValue,r))}}class O_{constructor(e,t=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.ce=null}}function da(n,e=null,t=[],r=[],i=null,s=null,o=null){return new O_(n,e,t,r,i,s,o)}function Yt(n){const e=v(n);if(null===e.ce){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>ha(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>{return(s=r).field.canonicalString()+s.dir;var s}).join(","),kr(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>xn(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>xn(r)).join(",")),e.ce=t}return e.ce}function qr(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!x_(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Vh(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!bh(n.startAt,e.startAt)&&bh(n.endAt,e.endAt)}function rs(n){return w.isDocumentKey(n.path)&&null===n.collectionGroup&&0===n.filters.length}class ft{constructor(e,t=null,r=[],i=[],s=null,o="F",a=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=u,this.le=null,this.he=null,this.Pe=null}}function Vn(n){return new ft(n)}function Bh(n){return 0===n.filters.length&&null===n.limit&&null==n.startAt&&null==n.endAt&&(0===n.explicitOrderBy.length||1===n.explicitOrderBy.length&&n.explicitOrderBy[0].field.isKeyField())}function Dn(n){const e=v(n);if(null===e.le){e.le=[];const t=new Set;for(const s of e.explicitOrderBy)e.le.push(s),t.add(s.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new H(re.comparator);return o.filters.forEach(u=>{u.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.le.push(new Ur(s,r))}),t.has(re.keyField().canonicalString())||e.le.push(new Ur(re.keyField(),r))}return e.le}function Me(n){const e=v(n);return e.he||(e.he=function Uh(n,e){if("F"===n.limitType)return da(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>new Ur(i.field,"desc"===i.dir?"asc":"desc"));const t=n.endAt?new Ct(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Ct(n.startAt.position,n.startAt.inclusive):null;return da(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}(e,Dn(n))),e.he}function ss(n,e,t){return new ft(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Gr(n,e){return qr(Me(n),Me(e))&&n.limitType===e.limitType}function qh(n){return`${Yt(Me(n))}|lt:${n.limitType}`}function Nn(n){return`Query(target=${function(t){let r=t.path.canonicalString();return null!==t.collectionGroup&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>Nh(i)).join(", ")}]`),kr(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>{return`${(o=i).field.canonicalString()} (${o.dir})`;var o}).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>xn(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>xn(i)).join(",")),`Target(${r})`}(Me(n))}; limitType=${n.limitType})`}function zr(n,e){return e.isFoundDocument()&&function(r,i){const s=i.key.path;return null!==r.collectionGroup?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):w.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,e)&&function(r,i){for(const s of Dn(r))if(!s.field.isKeyField()&&null===i.data.field(s.field))return!1;return!0}(n,e)&&function(r,i){for(const s of r.filters)if(!s.matches(i))return!1;return!0}(n,e)&&(i=e,!((r=n).startAt&&!function(o,a,u){const c=Sh(o,a,u);return o.inclusive?c<=0:c<0}(r.startAt,Dn(r),i)||r.endAt&&!function(o,a,u){const c=Sh(o,a,u);return o.inclusive?c>=0:c>0}(r.endAt,Dn(r),i)));var r,i}function zh(n){return(e,t)=>{let r=!1;for(const i of Dn(n)){const s=F_(i,e,t);if(0!==s)return s;r=r||i.field.isKeyField()}return 0}}function F_(n,e,t){const r=n.field.isKeyField()?w.comparator(e.key,t.key):function(s,o,a){const u=o.data.field(s),c=a.data.field(s);return null!==u&&null!==c?xt(u,c):P()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return P()}}class mt{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r)for(const[i,s]of r)if(this.equalsFn(i,e))return s}has(e){return void 0!==this.get(e)}set(e,t){const r=this.mapKeyFn(e),i=this.inner[r];if(void 0===i)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return 1===r.length?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Rt(this.inner,(t,r)=>{for(const[i,s]of r)e(i,s)})}isEmpty(){return _h(this.inner)}size(){return this.innerSize}}const L_=new X(w.comparator);function Le(){return L_}const jh=new X(w.comparator);function jr(...n){let e=jh;for(const t of n)e=e.insert(t.key,t);return e}function $h(n){let e=jh;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function ot(){return $r()}function Kh(){return $r()}function $r(){return new mt(n=>n.toString(),(n,e)=>n.isEqual(e))}const B_=new X(w.comparator),U_=new H(w.comparator);function L(...n){let e=U_;for(const t of n)e=e.add(t);return e}const q_=new H(k);function Qh(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Mr(e)?"-0":e}}function Wh(n){return{integerValue:""+n}}function Hh(n,e){return function ch(n){return"number"==typeof n&&Number.isInteger(n)&&!Mr(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}(e)?Wh(e):Qh(n,e)}class os{constructor(){this._=void 0}}function G_(n,e,t){return n instanceof kn?function(i,s){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&Yi(s)&&(s=Xi(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(t,e):n instanceof Xt?Jh(n,e):n instanceof en?Yh(n,e):function(i,s){const o=Zh(i,s),a=Xh(o)+Xh(i.Ie);return ua(o)&&ua(i.Ie)?Wh(a):Qh(i.serializer,a)}(n,e)}function z_(n,e,t){return n instanceof Xt?Jh(n,e):n instanceof en?Yh(n,e):t}function Zh(n,e){return n instanceof Mn?ua(r=e)||(s=r)&&"doubleValue"in s?e:{integerValue:0}:null;var r,s}class kn extends os{}class Xt extends os{constructor(e){super(),this.elements=e}}function Jh(n,e){const t=ed(e);for(const r of n.elements)t.some(i=>st(i,r))||t.push(r);return{arrayValue:{values:t}}}class en extends os{constructor(e){super(),this.elements=e}}function Yh(n,e){let t=ed(e);for(const r of n.elements)t=t.filter(i=>!st(i,r));return{arrayValue:{values:t}}}class Mn extends os{constructor(e,t){super(),this.serializer=e,this.Ie=t}}function Xh(n){return ae(n.integerValue||n.doubleValue)}function ed(n){return Lr(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class $_{constructor(e,t){this.version=e,this.transformResults=t}}class ie{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new ie}static exists(e){return new ie(void 0,e)}static updateTime(e){return new ie(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function as(n,e){return void 0!==n.updateTime?e.isFoundDocument()&&e.version.isEqual(n.updateTime):void 0===n.exists||n.exists===e.isFoundDocument()}class us{}function td(n,e){if(!n.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return n.isNoDocument()?new Fn(n.key,ie.none()):new On(n.key,n.data,ie.none());{const t=n.data,r=Re.empty();let i=new H(re.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);null===o&&s.length>1&&(s=s.popLast(),o=t.field(s)),null===o?r.delete(s):r.set(s,o),i=i.add(s)}return new pt(n.key,r,new Fe(i.toArray()),ie.none())}}function K_(n,e,t){n instanceof On?function(i,s,o){const a=i.value.clone(),u=id(i.fieldTransforms,s,o.transformResults);a.setAll(u),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof pt?function(i,s,o){if(!as(i.precondition,s))return void s.convertToUnknownDocument(o.version);const a=id(i.fieldTransforms,s,o.transformResults),u=s.data;u.setAll(rd(i)),u.setAll(a),s.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(n,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function Qr(n,e,t,r){return n instanceof On?function(s,o,a,u){if(!as(s.precondition,o))return a;const c=s.value.clone(),l=sd(s.fieldTransforms,u,o);return c.setAll(l),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(n,e,t,r):n instanceof pt?function(s,o,a,u){if(!as(s.precondition,o))return a;const c=sd(s.fieldTransforms,u,o),l=o.data;return l.setAll(rd(s)),l.setAll(c),o.convertToFoundDocument(o.version,l).setHasLocalMutations(),null===a?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(h=>h.field))}(n,e,t,r):(a=t,as(n.precondition,o=e)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a);var o,a}function Q_(n,e){let t=null;for(const r of n.fieldTransforms){const i=e.data.field(r.field),s=Zh(r.transform,i||null);null!=s&&(null===t&&(t=Re.empty()),t.set(r.field,s))}return t||null}function nd(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&(i=e.fieldTransforms,!!(void 0===(r=n.fieldTransforms)&&void 0===i||r&&i&&Rn(r,i,(s,o)=>function j_(n,e){return n.field.isEqual(e.field)&&(i=e.transform,(r=n.transform)instanceof Xt&&i instanceof Xt||r instanceof en&&i instanceof en?Rn(r.elements,i.elements,st):r instanceof Mn&&i instanceof Mn?st(r.Ie,i.Ie):r instanceof kn&&i instanceof kn);var r,i}(s,o))))&&(0===n.type?n.value.isEqual(e.value):1!==n.type||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask));var r,i}class On extends us{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class pt extends us{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function rd(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function id(n,e,t){const r=new Map;x(n.length===t.length);for(let i=0;i<t.length;i++){const s=n[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,z_(o,a,t[i]))}return r}function sd(n,e,t){const r=new Map;for(const i of n){const s=i.transform,o=t.data.field(i.field);r.set(i.field,G_(s,o,e))}return r}class Fn extends us{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class ga extends us{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class _a{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&K_(s,e,r[i])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Qr(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Qr(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=Kh();return this.mutations.forEach(i=>{const s=e.get(i.key),o=s.overlayedDocument;let a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;const u=td(o,a);null!==u&&r.set(i.key,u),o.isValidDocument()||o.convertToNoDocument(C.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),L())}isEqual(e){return this.batchId===e.batchId&&Rn(this.mutations,e.mutations,(t,r)=>nd(t,r))&&Rn(this.baseMutations,e.baseMutations,(t,r)=>nd(t,r))}}class ya{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){x(e.mutations.length===r.length);let i=function(){return B_}();const s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new ya(e,t,r,i)}}class Ia{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class H_{constructor(e,t){this.count=e,this.unchangedNames=t}}var de,z;function ad(n){if(void 0===n)return ue("GRPC error has no .code"),g.UNKNOWN;switch(n){case de.OK:return g.OK;case de.CANCELLED:return g.CANCELLED;case de.UNKNOWN:return g.UNKNOWN;case de.DEADLINE_EXCEEDED:return g.DEADLINE_EXCEEDED;case de.RESOURCE_EXHAUSTED:return g.RESOURCE_EXHAUSTED;case de.INTERNAL:return g.INTERNAL;case de.UNAVAILABLE:return g.UNAVAILABLE;case de.UNAUTHENTICATED:return g.UNAUTHENTICATED;case de.INVALID_ARGUMENT:return g.INVALID_ARGUMENT;case de.NOT_FOUND:return g.NOT_FOUND;case de.ALREADY_EXISTS:return g.ALREADY_EXISTS;case de.PERMISSION_DENIED:return g.PERMISSION_DENIED;case de.FAILED_PRECONDITION:return g.FAILED_PRECONDITION;case de.ABORTED:return g.ABORTED;case de.OUT_OF_RANGE:return g.OUT_OF_RANGE;case de.UNIMPLEMENTED:return g.UNIMPLEMENTED;case de.DATA_LOSS:return g.DATA_LOSS;default:return P()}}(z=de||(de={}))[z.OK=0]="OK",z[z.CANCELLED=1]="CANCELLED",z[z.UNKNOWN=2]="UNKNOWN",z[z.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",z[z.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",z[z.NOT_FOUND=5]="NOT_FOUND",z[z.ALREADY_EXISTS=6]="ALREADY_EXISTS",z[z.PERMISSION_DENIED=7]="PERMISSION_DENIED",z[z.UNAUTHENTICATED=16]="UNAUTHENTICATED",z[z.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",z[z.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",z[z.ABORTED=10]="ABORTED",z[z.OUT_OF_RANGE=11]="OUT_OF_RANGE",z[z.UNIMPLEMENTED=12]="UNIMPLEMENTED",z[z.INTERNAL=13]="INTERNAL",z[z.UNAVAILABLE=14]="UNAVAILABLE",z[z.DATA_LOSS=15]="DATA_LOSS";const Z_=new vn([4294967295,4294967295],0);function cd(n){const e=function ud(){return new TextEncoder}().encode(n),t=new $g;return t.update(e),new Uint8Array(t.digest())}function ld(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new vn([t,r],0),new vn([i,s],0)]}class Ea{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Wr(`Invalid padding: ${t}`);if(r<0)throw new Wr(`Invalid hash count: ${r}`);if(e.length>0&&0===this.hashCount)throw new Wr(`Invalid hash count: ${r}`);if(0===e.length&&0!==t)throw new Wr(`Invalid padding when bitmap length is 0: ${t}`);this.Te=8*e.length-t,this.Ee=vn.fromNumber(this.Te)}de(e,t,r){let i=e.add(t.multiply(vn.fromNumber(r)));return 1===i.compare(Z_)&&(i=new vn([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Ee).toNumber()}Ae(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Te)return!1;const t=cd(e),[r,i]=ld(t);for(let s=0;s<this.hashCount;s++){const o=this.de(r,i,s);if(!this.Ae(o))return!1}return!0}static create(e,t,r){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new Ea(s,i,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(0===this.Te)return;const t=cd(e),[r,i]=ld(t);for(let s=0;s<this.hashCount;s++){const o=this.de(r,i,s);this.Re(o)}}Re(e){const t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class Wr extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Hr{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const i=new Map;return i.set(e,Zr.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Hr(C.min(),i,new X(k),Le(),L())}}class Zr{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Zr(r,t,L(),L(),L())}}class ls{constructor(e,t,r,i){this.Ve=e,this.removedTargetIds=t,this.key=r,this.me=i}}class hd{constructor(e,t){this.targetId=e,this.fe=t}}class dd{constructor(e,t,r=me.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}}class fd{constructor(){this.ge=0,this.pe=pd(),this.ye=me.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return 0!==this.ge}get De(){return this.Se}Ce(e){e.approximateByteSize()>0&&(this.Se=!0,this.ye=e)}ve(){let e=L(),t=L(),r=L();return this.pe.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:P()}}),new Zr(this.ye,this.we,e,t,r)}Fe(){this.Se=!1,this.pe=pd()}Me(e,t){this.Se=!0,this.pe=this.pe.insert(e,t)}xe(e){this.Se=!0,this.pe=this.pe.remove(e)}Oe(){this.ge+=1}Ne(){this.ge-=1,x(this.ge>=0)}Be(){this.Se=!0,this.we=!0}}class J_{constructor(e){this.Le=e,this.ke=new Map,this.qe=Le(),this.Qe=md(),this.Ke=new X(k)}$e(e){for(const t of e.Ve)e.me&&e.me.isFoundDocument()?this.Ue(t,e.me):this.We(t,e.key,e.me);for(const t of e.removedTargetIds)this.We(t,e.key,e.me)}Ge(e){this.forEachTarget(e,t=>{const r=this.ze(t);switch(e.state){case 0:this.je(t)&&r.Ce(e.resumeToken);break;case 1:r.Ne(),r.be||r.Fe(),r.Ce(e.resumeToken);break;case 2:r.Ne(),r.be||this.removeTarget(t);break;case 3:this.je(t)&&(r.Be(),r.Ce(e.resumeToken));break;case 4:this.je(t)&&(this.He(t),r.Ce(e.resumeToken));break;default:P()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ke.forEach((r,i)=>{this.je(i)&&t(i)})}Je(e){const t=e.targetId,r=e.fe.count,i=this.Ye(t);if(i){const s=i.target;if(rs(s))if(0===r){const o=new w(s.path);this.We(t,o,ne.newNoDocument(o,C.min()))}else x(1===r);else{const o=this.Ze(t);if(o!==r){const a=this.Xe(e),u=a?this.et(a,e,o):1;0!==u&&(this.He(t),this.Ke=this.Ke.insert(t,2===u?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}Xe(e){const t=e.fe.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t;let o,a;try{o=dt(r).toUint8Array()}catch(u){if(u instanceof Ih)return qe("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{a=new Ea(o,i,s)}catch(u){return qe(u instanceof Wr?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return 0===a.Te?null:a}et(e,t,r){return t.fe.count===r-this.rt(e,t.targetId)?0:2}rt(e,t){const r=this.Le.getRemoteKeysForTarget(t);let i=0;return r.forEach(s=>{const o=this.Le.nt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.We(t,s,null),i++)}),i}it(e){const t=new Map;this.ke.forEach((s,o)=>{const a=this.Ye(o);if(a){if(s.current&&rs(a.target)){const u=new w(a.target.path);null!==this.qe.get(u)||this.st(o,u)||this.We(o,u,ne.newNoDocument(u,e))}s.De&&(t.set(o,s.ve()),s.Fe())}});let r=L();this.Qe.forEach((s,o)=>{let a=!0;o.forEachWhile(u=>{const c=this.Ye(u);return!c||"TargetPurposeLimboResolution"===c.purpose||(a=!1,!1)}),a&&(r=r.add(s))}),this.qe.forEach((s,o)=>o.setReadTime(e));const i=new Hr(e,t,this.Ke,this.qe,r);return this.qe=Le(),this.Qe=md(),this.Ke=new X(k),i}Ue(e,t){if(!this.je(e))return;const r=this.st(e,t.key)?2:0;this.ze(e).Me(t.key,r),this.qe=this.qe.insert(t.key,t),this.Qe=this.Qe.insert(t.key,this.ot(t.key).add(e))}We(e,t,r){if(!this.je(e))return;const i=this.ze(e);this.st(e,t)?i.Me(t,1):i.xe(t),this.Qe=this.Qe.insert(t,this.ot(t).delete(e)),r&&(this.qe=this.qe.insert(t,r))}removeTarget(e){this.ke.delete(e)}Ze(e){const t=this.ze(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Oe(e){this.ze(e).Oe()}ze(e){let t=this.ke.get(e);return t||(t=new fd,this.ke.set(e,t)),t}ot(e){let t=this.Qe.get(e);return t||(t=new H(k),this.Qe=this.Qe.insert(e,t)),t}je(e){const t=null!==this.Ye(e);return t||y("WatchChangeAggregator","Detected inactive target",e),t}Ye(e){const t=this.ke.get(e);return t&&t.be?null:this.Le._t(e)}He(e){this.ke.set(e,new fd),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.We(e,t,null)})}st(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function md(){return new X(w.comparator)}function pd(){return new X(w.comparator)}const Y_={asc:"ASCENDING",desc:"DESCENDING"},X_={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ey={and:"AND",or:"OR"};class ty{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Ta(n,e){return n.useProto3Json||kr(e)?e:{value:e}}function Ln(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function gd(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function ny(n,e){return Ln(n,e.toTimestamp())}function ce(n){return x(!!n),C.fromTimestamp(function(t){const r=Pt(t);return new se(r.seconds,r.nanos)}(n))}function va(n,e){return Aa(n,e).canonicalString()}function Aa(n,e){const t=(i=n,new U(["projects",i.projectId,"databases",i.database])).child("documents");var i;return void 0===e?t:t.child(e)}function _d(n){const e=U.fromString(n);return x(Sd(e)),e}function Jr(n,e){return va(n.databaseId,e.path)}function at(n,e){const t=_d(e);if(t.get(1)!==n.databaseId.projectId)throw new I(g.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new I(g.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new w(Ed(t))}function yd(n,e){return va(n.databaseId,e)}function wa(n){return new U(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Ed(n){return x(n.length>4&&"documents"===n.get(4)),n.popFirst(5)}function Td(n,e,t){return{name:Jr(n,e),fields:t.value.mapValue.fields}}function Ad(n,e){return{documents:[yd(n,e.path)]}}function Pa(n,e){const t={structuredQuery:{}},r=e.path;let i;null!==e.collectionGroup?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=yd(n,i);const s=function(c){if(0!==c.length)return Pd(Q.create(c,"and"))}(e.filters);s&&(t.structuredQuery.where=s);const o=function(c){if(0!==c.length)return c.map(l=>{return{field:Vt((d=l).field),direction:ay(d.dir)};var d})}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=Ta(n,e.limit);return null!==a&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt={before:(c=e.startAt).inclusive,values:c.position}),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),{ut:t,parent:i};var c}function wd(n){let e=function Id(n){const e=_d(n);return 4===e.length?U.emptyPath():Ed(e)}(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let i=null;if(r>0){x(1===r);const l=t.from[0];l.allDescendants?i=l.collectionId:e=e.child(l.collectionId)}let s=[];t.where&&(s=function(h){const d=Rd(h);return d instanceof Q&&la(d)?d.getFilters():[d]}(t.where));let o=[];t.orderBy&&(o=t.orderBy.map(d=>{return new Ur(Bn((E=d).field),function(T){switch(T){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(E.direction));var E}));let a=null;t.limit&&(a=function(h){let d;return d="object"==typeof h?h.value:h,kr(d)?null:d}(t.limit));let u=null;var h;t.startAt&&(u=new Ct((h=t.startAt).values||[],!!h.before));let c=null;return t.endAt&&(c=function(h){return new Ct(h.values||[],!h.before)}(t.endAt)),function Lh(n,e,t,r,i,s,o,a){return new ft(n,e,t,r,i,s,o,a)}(e,i,o,s,a,"F",u,c)}function Rd(n){return void 0!==n.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=Bn(t.unaryFilter.field);return q.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=Bn(t.unaryFilter.field);return q.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=Bn(t.unaryFilter.field);return q.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Bn(t.unaryFilter.field);return q.create(o,"!=",{nullValue:"NULL_VALUE"});default:return P()}}(n):void 0!==n.fieldFilter?q.create(Bn((t=n).fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return P()}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==n.compositeFilter?function(t){return Q.create(t.compositeFilter.filters.map(r=>Rd(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return P()}}(t.compositeFilter.op))}(n):P();var t}function ay(n){return Y_[n]}function uy(n){return X_[n]}function cy(n){return ey[n]}function Vt(n){return{fieldPath:n.canonicalString()}}function Bn(n){return re.fromServerFormat(n.fieldPath)}function Pd(n){return n instanceof q?function(t){if("=="===t.op){if(vh(t.value))return{unaryFilter:{field:Vt(t.field),op:"IS_NAN"}};if(Th(t.value))return{unaryFilter:{field:Vt(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(vh(t.value))return{unaryFilter:{field:Vt(t.field),op:"IS_NOT_NAN"}};if(Th(t.value))return{unaryFilter:{field:Vt(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Vt(t.field),op:uy(t.op),value:t.value}}}(n):n instanceof Q?function(t){const r=t.getFilters().map(i=>Pd(i));return 1===r.length?r[0]:{compositeFilter:{op:cy(t.op),filters:r}}}(n):P()}function ly(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Sd(n){return n.length>=4&&"projects"===n.get(0)&&"databases"===n.get(2)}class gt{constructor(e,t,r,i,s=C.min(),o=C.min(),a=me.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=u}withSequenceNumber(e){return new gt(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new gt(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new gt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new gt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class bd{constructor(e){this.ct=e}}function Sa(n){const e=wd({parent:n.parent,structuredQuery:n.structuredQuery});return"LAST"===n.limitType?ss(e,e.limit,"L"):e}class sn{constructor(){}Pt(e,t){this.It(e,t),t.Tt()}It(e,t){if("nullValue"in e)this.Et(t,5);else if("booleanValue"in e)this.Et(t,10),t.dt(e.booleanValue?1:0);else if("integerValue"in e)this.Et(t,15),t.dt(ae(e.integerValue));else if("doubleValue"in e){const r=ae(e.doubleValue);isNaN(r)?this.Et(t,13):(this.Et(t,15),Mr(r)?t.dt(0):t.dt(r))}else if("timestampValue"in e){const r=e.timestampValue;this.Et(t,20),"string"==typeof r?t.At(r):(t.At(`${r.seconds||""}`),t.dt(r.nanos||0))}else if("stringValue"in e)this.Rt(e.stringValue,t),this.Vt(t);else if("bytesValue"in e)this.Et(t,30),t.ft(dt(e.bytesValue)),this.Vt(t);else if("referenceValue"in e)this.gt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.Et(t,45),t.dt(r.latitude||0),t.dt(r.longitude||0)}else"mapValue"in e?Ah(e)?this.Et(t,Number.MAX_SAFE_INTEGER):(this.yt(e.mapValue,t),this.Vt(t)):"arrayValue"in e?(this.wt(e.arrayValue,t),this.Vt(t)):P()}Rt(e,t){this.Et(t,25),this.St(e,t)}St(e,t){t.At(e)}yt(e,t){const r=e.fields||{};this.Et(t,55);for(const i of Object.keys(r))this.Rt(i,t),this.It(r[i],t)}wt(e,t){const r=e.values||[];this.Et(t,50);for(const i of r)this.It(i,t)}gt(e,t){this.Et(t,37),w.fromName(e).path.forEach(r=>{this.Et(t,60),this.St(r,t)})}Et(e,t){e.dt(t)}Vt(e){e.dt(2)}}sn.bt=new sn;class yy{constructor(){this._n=new Na}addToCollectionParentIndex(e,t){return this._n.add(t),m.resolve()}getCollectionParents(e,t){return m.resolve(this._n.getEntries(t))}addFieldIndex(e,t){return m.resolve()}deleteFieldIndex(e,t){return m.resolve()}deleteAllFieldIndexes(e){return m.resolve()}createTargetIndexes(e,t){return m.resolve()}getDocumentsMatchingTarget(e,t){return m.resolve(null)}getIndexType(e,t){return m.resolve(0)}getFieldIndexes(e,t){return m.resolve([])}getNextCollectionGroupToUpdate(e){return m.resolve(null)}getMinOffset(e,t){return m.resolve(Ge.min())}getMinOffsetFromCollectionGroup(e,t){return m.resolve(Ge.min())}updateCollectionGroup(e,t,r){return m.resolve()}updateIndexEntries(e,t){return m.resolve()}}class Na{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new H(U.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new H(U.comparator)).toArray()}}new Uint8Array(0);class De{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new De(e,De.DEFAULT_COLLECTION_PERCENTILE,De.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}De.DEFAULT_COLLECTION_PERCENTILE=10,De.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,De.DEFAULT=new De(41943040,De.DEFAULT_COLLECTION_PERCENTILE,De.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),De.DISABLED=new De(-1,0,0);class an{constructor(e){this.On=e}next(){return this.On+=2,this.On}static Nn(){return new an(0)}static Bn(){return new an(-1)}}class wy{constructor(){this.changes=new mt(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ne.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return void 0!==r?m.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Sy{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class tf{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(null!==r&&Qr(r.mutation,i,Fe.empty(),se.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,L()).next(()=>r))}getLocalViewOfDocuments(e,t,r=L()){const i=ot();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=jr();return s.forEach((a,u)=>{o=o.insert(a,u.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=ot();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,L()))}populateOverlays(e,t,r){const i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,i){let s=Le();const o=$r(),a=$r();return t.forEach((u,c)=>{const l=r.get(c.key);i.has(c.key)&&(void 0===l||l.mutation instanceof pt)?s=s.insert(c.key,c):void 0!==l?(o.set(c.key,l.mutation.getFieldMask()),Qr(l.mutation,c,l.mutation.getFieldMask(),se.now())):o.set(c.key,Fe.empty())}),this.recalculateAndSaveOverlays(e,s).next(u=>(u.forEach((c,l)=>o.set(c,l)),t.forEach((c,l)=>{var h;return a.set(c,new Sy(l,null!==(h=o.get(c))&&void 0!==h?h:null))}),a))}recalculateAndSaveOverlays(e,t){const r=$r();let i=new X((o,a)=>o-a),s=L();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(u=>{const c=t.get(u);if(null===c)return;let l=r.get(u)||Fe.empty();l=a.applyToLocalView(c,l),r.set(u,l);const h=(i.get(a.batchId)||L()).add(u);i=i.insert(a.batchId,h)})}).next(()=>{const o=[],a=i.getReverseIterator();for(;a.hasNext();){const u=a.getNext(),c=u.key,l=u.value,h=Kh();l.forEach(d=>{if(!s.has(d)){const p=td(t.get(d),r.get(d));null!==p&&h.set(d,p),s=s.add(d)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,h))}return m.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return w.isDocumentKey((o=t).path)&&null===o.collectionGroup&&0===o.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):function fa(n){return null!==n.collectionGroup}(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i);var o}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{const o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):m.resolve(ot());let a=-1,u=s;return o.next(c=>m.forEach(c,(l,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),s.get(l)?m.resolve():this.remoteDocumentCache.getEntry(e,l).next(d=>{u=u.insert(l,d)}))).next(()=>this.populateOverlays(e,c,s)).next(()=>this.computeViews(e,u,c,L())).next(l=>({batchId:a,changes:$h(l)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new w(t)).next(r=>{let i=jr();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){const s=t.collectionGroup;let o=jr();return this.indexManager.getCollectionParents(e,s).next(a=>m.forEach(a,u=>{const c=(h=t,d=u.child(s),new ft(d,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt));var h,d;return this.getDocumentsMatchingCollectionQuery(e,c,r,i).next(l=>{l.forEach((h,d)=>{o=o.insert(h,d)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((u,c)=>{const l=c.getKey();null===o.get(l)&&(o=o.insert(l,ne.newInvalidDocument(l)))});let a=jr();return o.forEach((u,c)=>{const l=s.get(u);void 0!==l&&Qr(l.mutation,c,Fe.empty(),se.now()),zr(t,c)&&(a=a.insert(u,c))}),a})}}class by{constructor(e){this.serializer=e,this.cr=new Map,this.lr=new Map}getBundleMetadata(e,t){return m.resolve(this.cr.get(t))}saveBundleMetadata(e,t){return this.cr.set(t.id,{id:(i=t).id,version:i.version,createTime:ce(i.createTime)}),m.resolve();var i}getNamedQuery(e,t){return m.resolve(this.lr.get(t))}saveNamedQuery(e,t){return this.lr.set(t.name,{name:(i=t).name,query:Sa(i.bundledQuery),readTime:ce(i.readTime)}),m.resolve();var i}}class xy{constructor(){this.overlays=new X(w.comparator),this.hr=new Map}getOverlay(e,t){return m.resolve(this.overlays.get(t))}getOverlays(e,t){const r=ot();return m.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.ht(e,t,s)}),m.resolve()}removeOverlaysForBatchId(e,t,r){const i=this.hr.get(r);return void 0!==i&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.hr.delete(r)),m.resolve()}getOverlaysForCollection(e,t,r){const i=ot(),s=t.length+1,o=new w(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const u=a.getNext().value,c=u.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===s&&u.largestBatchId>r&&i.set(u.getKey(),u)}return m.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new X((c,l)=>c-l);const o=this.overlays.getIterator();for(;o.hasNext();){const c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>r){let l=s.get(c.largestBatchId);null===l&&(l=ot(),s=s.insert(c.largestBatchId,l)),l.set(c.getKey(),c)}}const a=ot(),u=s.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((c,l)=>a.set(c,l)),!(a.size()>=i)););return m.resolve(a)}ht(e,t,r){const i=this.overlays.get(r.key);if(null!==i){const o=this.hr.get(i.largestBatchId).delete(r.key);this.hr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Ia(t,r));let s=this.hr.get(t);void 0===s&&(s=L(),this.hr.set(t,s)),this.hr.set(t,s.add(r.key))}}class ka{constructor(){this.Pr=new H(Ee.Ir),this.Tr=new H(Ee.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(e,t){const r=new Ee(e,t);this.Pr=this.Pr.add(r),this.Tr=this.Tr.add(r)}dr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Ar(new Ee(e,t))}Rr(e,t){e.forEach(r=>this.removeReference(r,t))}Vr(e){const t=new w(new U([])),r=new Ee(t,e),i=new Ee(t,e+1),s=[];return this.Tr.forEachInRange([r,i],o=>{this.Ar(o),s.push(o.key)}),s}mr(){this.Pr.forEach(e=>this.Ar(e))}Ar(e){this.Pr=this.Pr.delete(e),this.Tr=this.Tr.delete(e)}gr(e){const t=new w(new U([])),r=new Ee(t,e),i=new Ee(t,e+1);let s=L();return this.Tr.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){const t=new Ee(e,0),r=this.Pr.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class Ee{constructor(e,t){this.key=e,this.pr=t}static Ir(e,t){return w.comparator(e.key,t.key)||k(e.pr,t.pr)}static Er(e,t){return k(e.pr,t.pr)||w.comparator(e.key,t.key)}}class Cy{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.yr=1,this.wr=new H(Ee.Ir)}checkEmpty(e){return m.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,i){const s=this.yr;this.yr++;const o=new _a(s,t,r,i);this.mutationQueue.push(o);for(const a of i)this.wr=this.wr.add(new Ee(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return m.resolve(o)}lookupMutationBatch(e,t){return m.resolve(this.Sr(t))}getNextMutationBatchAfterBatchId(e,t){const i=this.br(t+1),s=i<0?0:i;return m.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return m.resolve(0===this.mutationQueue.length?-1:this.yr-1)}getAllMutationBatches(e){return m.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new Ee(t,0),i=new Ee(t,Number.POSITIVE_INFINITY),s=[];return this.wr.forEachInRange([r,i],o=>{const a=this.Sr(o.pr);s.push(a)}),m.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new H(k);return t.forEach(i=>{const s=new Ee(i,0),o=new Ee(i,Number.POSITIVE_INFINITY);this.wr.forEachInRange([s,o],a=>{r=r.add(a.pr)})}),m.resolve(this.Dr(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1;let s=r;w.isDocumentKey(s)||(s=s.child(""));const o=new Ee(new w(s),0);let a=new H(k);return this.wr.forEachWhile(u=>{const c=u.key.path;return!!r.isPrefixOf(c)&&(c.length===i&&(a=a.add(u.pr)),!0)},o),m.resolve(this.Dr(a))}Dr(e){const t=[];return e.forEach(r=>{const i=this.Sr(r);null!==i&&t.push(i)}),t}removeMutationBatch(e,t){x(0===this.Cr(t.batchId,"removed")),this.mutationQueue.shift();let r=this.wr;return m.forEach(t.mutations,i=>{const s=new Ee(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.wr=r})}Mn(e){}containsKey(e,t){const r=new Ee(t,0),i=this.wr.firstAfterOrEqual(r);return m.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return m.resolve()}Cr(e,t){return this.br(e)}br(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Sr(e){const t=this.br(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Vy{constructor(e){this.vr=e,this.docs=new X(w.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.vr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return m.resolve(r?r.document.mutableCopy():ne.newInvalidDocument(t))}getEntries(e,t){let r=Le();return t.forEach(i=>{const s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():ne.newInvalidDocument(i))}),m.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=Le();const o=t.path,a=new w(o.child("")),u=this.docs.getIteratorFrom(a);for(;u.hasNext();){const{key:c,value:{document:l}}=u.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||ra(oh(l),r)<=0||(i.has(l.key)||zr(t,l))&&(s=s.insert(l.key,l.mutableCopy()))}return m.resolve(s)}getAllFromCollectionGroup(e,t,r,i){P()}Fr(e,t){return m.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new Dy(this)}getSize(e){return m.resolve(this.size)}}class Dy extends wy{constructor(e){super(),this.ar=e}applyChanges(e){const t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.ar.addEntry(e,i)):this.ar.removeEntry(r)}),m.waitFor(t)}getFromCache(e,t){return this.ar.getEntry(e,t)}getAllFromCache(e,t){return this.ar.getEntries(e,t)}}class Ny{constructor(e){this.persistence=e,this.Mr=new mt(t=>Yt(t),qr),this.lastRemoteSnapshotVersion=C.min(),this.highestTargetId=0,this.Or=0,this.Nr=new ka,this.targetCount=0,this.Br=an.Nn()}forEachTarget(e,t){return this.Mr.forEach((r,i)=>t(i)),m.resolve()}getLastRemoteSnapshotVersion(e){return m.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return m.resolve(this.Or)}allocateTargetId(e){return this.highestTargetId=this.Br.next(),m.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Or&&(this.Or=t),m.resolve()}qn(e){this.Mr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Br=new an(t),this.highestTargetId=t),e.sequenceNumber>this.Or&&(this.Or=e.sequenceNumber)}addTargetData(e,t){return this.qn(t),this.targetCount+=1,m.resolve()}updateTargetData(e,t){return this.qn(t),m.resolve()}removeTargetData(e,t){return this.Mr.delete(t.target),this.Nr.Vr(t.targetId),this.targetCount-=1,m.resolve()}removeTargets(e,t,r){let i=0;const s=[];return this.Mr.forEach((o,a)=>{a.sequenceNumber<=t&&null===r.get(a.targetId)&&(this.Mr.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),m.waitFor(s).next(()=>i)}getTargetCount(e){return m.resolve(this.targetCount)}getTargetData(e,t){const r=this.Mr.get(t)||null;return m.resolve(r)}addMatchingKeys(e,t,r){return this.Nr.dr(t,r),m.resolve()}removeMatchingKeys(e,t,r){this.Nr.Rr(t,r);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),m.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Nr.Vr(t),m.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Nr.gr(t);return m.resolve(r)}containsKey(e,t){return m.resolve(this.Nr.containsKey(t))}}class Ma{constructor(e,t){this.Lr={},this.overlays={},this.kr=new ze(0),this.qr=!1,this.qr=!0,this.referenceDelegate=e(this),this.Qr=new Ny(this),this.indexManager=new yy,this.remoteDocumentCache=new Vy(r=>this.referenceDelegate.Kr(r)),this.serializer=new bd(t),this.$r=new by(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new xy,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.Lr[e.toKey()];return r||(r=new Cy(t,this.referenceDelegate),this.Lr[e.toKey()]=r),r}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(e,t,r){y("MemoryPersistence","Starting transaction:",e);const i=new ky(this.kr.next());return this.referenceDelegate.Ur(),r(i).next(s=>this.referenceDelegate.Wr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Gr(e,t){return m.or(Object.values(this.Lr).map(r=>()=>r.containsKey(e,t)))}}class ky extends n_{constructor(e){super(),this.currentSequenceNumber=e}}class ys{constructor(e){this.persistence=e,this.zr=new ka,this.jr=null}static Hr(e){return new ys(e)}get Jr(){if(this.jr)return this.jr;throw P()}addReference(e,t,r){return this.zr.addReference(r,t),this.Jr.delete(r.toString()),m.resolve()}removeReference(e,t,r){return this.zr.removeReference(r,t),this.Jr.add(r.toString()),m.resolve()}markPotentiallyOrphaned(e,t){return this.Jr.add(t.toString()),m.resolve()}removeTarget(e,t){this.zr.Vr(t.targetId).forEach(i=>this.Jr.add(i.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Jr.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}Ur(){this.jr=new Set}Wr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return m.forEach(this.Jr,r=>{const i=w.fromPath(r);return this.Yr(e,i).next(s=>{s||t.removeEntry(i,C.min())})}).next(()=>(this.jr=null,t.apply(e)))}updateLimboDocument(e,t){return this.Yr(e,t).next(r=>{r?this.Jr.delete(t.toString()):this.Jr.add(t.toString())})}Kr(e){return 0}Yr(e,t){return m.or([()=>m.resolve(this.zr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Gr(e,t)])}}class Ba{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.qi=r,this.Qi=i}static Ki(e,t){let r=L(),i=L();for(const s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new Ba(e,t.fromCache,r,i)}}class Oy{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class rf{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=function Em(){return!function S(){var n;const e=null===(n=dn())||void 0===n?void 0:n.forceEnvironment;if("node"===e)return!0;if("browser"===e)return!1;try{return"[object process]"===Object.prototype.toString.call(global.process)}catch{return!1}}()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}()?8:He.v($())>0?6:4}initialize(e,t){this.zi=e,this.indexManager=t,this.$i=!0}getDocumentsMatchingQuery(e,t,r,i){const s={result:null};return this.ji(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.Hi(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;const o=new Oy;return this.Ji(e,t,o).next(a=>{if(s.result=a,this.Ui)return this.Yi(e,t,o,a.size)})}).next(()=>s.result)}Yi(e,t,r,i){return r.documentReadCount<this.Wi?(wn()<=j.DEBUG&&y("QueryEngine","SDK will not create cache indexes for query:",Nn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),m.resolve()):(wn()<=j.DEBUG&&y("QueryEngine","Query:",Nn(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Gi*i?(wn()<=j.DEBUG&&y("QueryEngine","The SDK decides to create cache indexes for query:",Nn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Me(t))):m.resolve())}ji(e,t){if(Bh(t))return m.resolve(null);let r=Me(t);return this.indexManager.getIndexType(e,r).next(i=>0===i?null:(null!==t.limit&&1===i&&(t=ss(t,null,"F"),r=Me(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{const o=L(...s);return this.zi.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(u=>{const c=this.Zi(t,a);return this.Xi(t,c,o,u.readTime)?this.ji(e,ss(t,null,"F")):this.es(e,c,t,u)}))})))}Hi(e,t,r,i){return Bh(t)||i.isEqual(C.min())?m.resolve(null):this.zi.getDocuments(e,r).next(s=>{const o=this.Zi(t,s);return this.Xi(t,o,r,i)?m.resolve(null):(wn()<=j.DEBUG&&y("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Nn(t)),this.es(e,o,t,function sh(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=C.fromTimestamp(1e9===r?new se(t+1,0):new se(t,r));return new Ge(i,w.empty(),e)}(i,-1)).next(a=>a))})}Zi(e,t){let r=new H(zh(e));return t.forEach((i,s)=>{zr(e,s)&&(r=r.add(s))}),r}Xi(e,t,r,i){if(null===e.limit)return!1;if(r.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Ji(e,t,r){return wn()<=j.DEBUG&&y("QueryEngine","Using full collection scan to execute query:",Nn(t)),this.zi.getDocumentsMatchingQuery(e,t,Ge.min(),r)}es(e,t,r,i){return this.zi.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}}class Fy{constructor(e,t,r,i){this.persistence=e,this.ts=t,this.serializer=i,this.ns=new X(k),this.rs=new mt(s=>Yt(s),qr),this.ss=new Map,this.os=e.getRemoteDocumentCache(),this.Qr=e.getTargetCache(),this.$r=e.getBundleCache(),this._s(r)}_s(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new tf(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.ns))}}function of(n,e){return Ua.apply(this,arguments)}function Ua(){return Ua=(0,_.Z)(function*(n,e){const t=v(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t._s(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{const o=[],a=[];let u=L();for(const c of i){o.push(c.batchId);for(const l of c.mutations)u=u.add(l.key)}for(const c of s){a.push(c.batchId);for(const l of c.mutations)u=u.add(l.key)}return t.localDocuments.getDocuments(r,u).next(c=>({us:c,removedBatchIds:o,addedBatchIds:a}))})})}),Ua.apply(this,arguments)}function af(n){const e=v(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Qr.getLastRemoteSnapshotVersion(t))}function Uy(n,e){const t=v(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function $n(n,e,t){return qa.apply(this,arguments)}function qa(){return qa=(0,_.Z)(function*(n,e,t){const r=v(n),i=r.ns.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!wt(o))throw o;y("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.ns=r.ns.remove(e),r.rs.delete(i.target)}),qa.apply(this,arguments)}function Ts(n,e,t){const r=v(n);let i=C.min(),s=L();return r.persistence.runTransaction("Execute query","readwrite",o=>function(u,c,l){const h=v(u),d=h.rs.get(l);return void 0!==d?m.resolve(h.ns.get(d)):h.Qr.getTargetData(c,l)}(r,o,Me(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.Qr.getMatchingKeysForTargetId(o,a.targetId).next(u=>{s=u})}).next(()=>r.ts.getDocumentsMatchingQuery(o,e,t?i:C.min(),t?s:L())).next(a=>(function hf(n,e,t){let r=n.ss.get(e)||C.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.ss.set(e,r)}(r,function Gh(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}(e),a),{documents:a,hs:s})))}class Ka{constructor(){this.activeTargetIds=function pa(){return q_}()}As(e){this.activeTargetIds=this.activeTargetIds.add(e)}Rs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}ds(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class mf{constructor(){this.no=new Ka,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.no.As(e),this.ro[e]||"not-current"}updateQueryState(e,t,r){this.ro[e]=t}removeLocalQueryTarget(e){this.no.Rs(e)}isLocalQueryTarget(e){return this.no.activeTargetIds.has(e)}clearQueryState(e){delete this.ro[e]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(e){return this.no.activeTargetIds.has(e)}start(){return this.no=new Ka,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class zy{io(e){}shutdown(){}}class pf{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(e){this.uo.push(e)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){y("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.uo)e(0)}ao(){y("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.uo)e(1)}static D(){return typeof window<"u"&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let ws=null;function Wa(){return null===ws?ws=268435456+Math.round(2147483648*Math.random()):ws++,"0x"+ws.toString(16)}const jy={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class $y{constructor(e){this.lo=e.lo,this.ho=e.ho}Po(e){this.Io=e}To(e){this.Eo=e}onMessage(e){this.Ao=e}close(){this.ho()}send(e){this.lo(e)}Ro(){this.Io()}Vo(e){this.Eo(e)}mo(e){this.Ao(e)}}const Ne="WebChannelConnection";class Ky extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const r=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.fo=r+"://"+t.host,this.po=`projects/${i}/databases/${s}`,this.yo="(default)"===this.databaseId.database?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get wo(){return!1}So(t,r,i,s,o){const a=Wa(),u=this.bo(t,r.toUriEncodedString());y("RestConnection",`Sending RPC '${t}' ${a}:`,u,i);const c={"google-cloud-resource-prefix":this.po,"x-goog-request-params":this.yo};return this.Do(c,s,o),this.Co(t,u,c,i).then(l=>(y("RestConnection",`Received RPC '${t}' ${a}: `,l),l),l=>{throw qe("RestConnection",`RPC '${t}' ${a} failed with error: `,l,"url: ",u,"request:",i),l})}vo(t,r,i,s,o,a){return this.So(t,r,i,s,o)}Do(t,r,i){t["X-Goog-Api-Client"]="gl-js/ fire/"+An,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,o)=>t[o]=s),i&&i.headers.forEach((s,o)=>t[o]=s)}bo(t,r){return`${this.fo}/v1/${r}:${jy[t]}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Co(e,t,r,i){const s=Wa();return new Promise((o,a)=>{const u=new jg;u.setWithCredentials(!0),u.listenOnce(Gg.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case ea.NO_ERROR:const l=u.getResponseJson();y(Ne,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(l)),o(l);break;case ea.TIMEOUT:y(Ne,`RPC '${e}' ${s} timed out`),a(new I(g.DEADLINE_EXCEEDED,"Request time out"));break;case ea.HTTP_ERROR:const h=u.getStatus();if(y(Ne,`RPC '${e}' ${s} failed with status:`,h,"response text:",u.getResponseText()),h>0){let d=u.getResponseJson();Array.isArray(d)&&(d=d[0]);const p=null==d?void 0:d.error;if(p&&p.status&&p.message){const E=function(T){const V=T.toLowerCase().replace(/_/g,"-");return Object.values(g).indexOf(V)>=0?V:g.UNKNOWN}(p.status);a(new I(E,p.message))}else a(new I(g.UNKNOWN,"Server responded with status "+u.getStatus()))}else a(new I(g.UNAVAILABLE,"Connection failed."));break;default:P()}}finally{y(Ne,`RPC '${e}' ${s} completed.`)}});const c=JSON.stringify(i);y(Ne,`RPC '${e}' ${s} sending request:`,i),u.send(t,"POST",c,r,15)})}Fo(e,t,r){const i=Wa(),s=[this.fo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=Ug(),a=qg(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(u.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Do(u.initMessageHeaders,t,r),u.encodeInitMessageHeaders=!0;const l=s.join("");y(Ne,`Creating RPC '${e}' stream ${i}: ${l}`,u);const h=o.createWebChannel(l,u);let d=!1,p=!1;const E=new $y({lo:T=>{p?y(Ne,`Not sending because RPC '${e}' stream ${i} is closed:`,T):(d||(y(Ne,`Opening RPC '${e}' stream ${i} transport.`),h.open(),d=!0),y(Ne,`RPC '${e}' stream ${i} sending:`,T),h.send(T))},ho:()=>h.close()}),A=(T,V,O)=>{T.listen(V,D=>{try{O(D)}catch(B){setTimeout(()=>{throw B},0)}})};return A(h,Wi.EventType.OPEN,()=>{p||y(Ne,`RPC '${e}' stream ${i} transport opened.`)}),A(h,Wi.EventType.CLOSE,()=>{p||(p=!0,y(Ne,`RPC '${e}' stream ${i} transport closed`),E.Vo())}),A(h,Wi.EventType.ERROR,T=>{p||(p=!0,qe(Ne,`RPC '${e}' stream ${i} transport errored:`,T),E.Vo(new I(g.UNAVAILABLE,"The operation could not be completed")))}),A(h,Wi.EventType.MESSAGE,T=>{var V;if(!p){const O=T.data[0];x(!!O);const B=O.error||(null===(V=O[0])||void 0===V?void 0:V.error);if(B){y(Ne,`RPC '${e}' stream ${i} received error:`,B);const J=B.status;let W=function(VE){const Im=de[VE];if(void 0!==Im)return ad(Im)}(J),pe=B.message;void 0===W&&(W=g.INTERNAL,pe="Unknown error status: "+J+" with message "+B.message),p=!0,E.Vo(new I(W,pe)),h.close()}else y(Ne,`RPC '${e}' stream ${i} received:`,O),E.mo(O)}}),A(a,zg.STAT_EVENT,T=>{T.stat===Xl.PROXY?y(Ne,`RPC '${e}' stream ${i} detected buffering proxy`):T.stat===Xl.NOPROXY&&y(Ne,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{E.Ro()},0),E}}function Rs(){return typeof document<"u"?document:null}function oi(n){return new ty(n,!0)}class Ha{constructor(e,t,r=1e3,i=1.5,s=6e4){this.oi=e,this.timerId=t,this.Mo=r,this.xo=i,this.Oo=s,this.No=0,this.Bo=null,this.Lo=Date.now(),this.reset()}reset(){this.No=0}ko(){this.No=this.Oo}qo(e){this.cancel();const t=Math.floor(this.No+this.Qo()),r=Math.max(0,Date.now()-this.Lo),i=Math.max(0,t-r);i>0&&y("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.No} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.Bo=this.oi.enqueueAfterDelay(this.timerId,i,()=>(this.Lo=Date.now(),e())),this.No*=this.xo,this.No<this.Mo&&(this.No=this.Mo),this.No>this.Oo&&(this.No=this.Oo)}Ko(){null!==this.Bo&&(this.Bo.skipDelay(),this.Bo=null)}cancel(){null!==this.Bo&&(this.Bo.cancel(),this.Bo=null)}Qo(){return(Math.random()-.5)*this.No}}class _f{constructor(e,t,r,i,s,o,a,u){this.oi=e,this.$o=r,this.Uo=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=u,this.state=0,this.Wo=0,this.Go=null,this.zo=null,this.stream=null,this.jo=new Ha(e,t)}Ho(){return 1===this.state||5===this.state||this.Jo()}Jo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Yo()}stop(){var e=this;return(0,_.Z)(function*(){e.Ho()&&(yield e.close(0))})()}Zo(){this.state=0,this.jo.reset()}Xo(){this.Jo()&&null===this.Go&&(this.Go=this.oi.enqueueAfterDelay(this.$o,6e4,()=>this.e_()))}t_(e){this.n_(),this.stream.send(e)}e_(){var e=this;return(0,_.Z)(function*(){if(e.Jo())return e.close(0)})()}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}r_(){this.zo&&(this.zo.cancel(),this.zo=null)}close(e,t){var r=this;return(0,_.Z)(function*(){r.n_(),r.r_(),r.jo.cancel(),r.Wo++,4!==e?r.jo.reset():t&&t.code===g.RESOURCE_EXHAUSTED?(ue(t.toString()),ue("Using maximum backoff delay to prevent overloading the backend."),r.jo.ko()):t&&t.code===g.UNAUTHENTICATED&&3!==r.state&&(r.authCredentialsProvider.invalidateToken(),r.appCheckCredentialsProvider.invalidateToken()),null!==r.stream&&(r.i_(),r.stream.close(),r.stream=null),r.state=e,yield r.listener.To(t)})()}i_(){}auth(){this.state=1;const e=this.s_(this.Wo),t=this.Wo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Wo===t&&this.o_(r,i)},r=>{e(()=>{const i=new I(g.UNKNOWN,"Fetching auth token failed: "+r.message);return this.__(i)})})}o_(e,t){const r=this.s_(this.Wo);this.stream=this.a_(e,t),this.stream.Po(()=>{r(()=>(this.state=2,this.zo=this.oi.enqueueAfterDelay(this.Uo,1e4,()=>(this.Jo()&&(this.state=3),Promise.resolve())),this.listener.Po()))}),this.stream.To(i=>{r(()=>this.__(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}Yo(){var e=this;this.state=5,this.jo.qo((0,_.Z)(function*(){e.state=0,e.start()}))}__(e){return y("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}s_(e){return t=>{this.oi.enqueueAndForget(()=>this.Wo===e?t():(y("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Qy extends _f{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}a_(e,t){return this.connection.Fo("Listen",e,t)}onMessage(e){this.jo.reset();const t=function iy(n,e){let t;if("targetChange"in e){const r="NO_CHANGE"===(c=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===c?1:"REMOVE"===c?2:"CURRENT"===c?3:"RESET"===c?4:P(),i=e.targetChange.targetIds||[],s=function(c,l){return c.useProto3Json?(x(void 0===l||"string"==typeof l),me.fromBase64String(l||"")):(x(void 0===l||l instanceof Uint8Array),me.fromUint8Array(l||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){const l=void 0===c.code?g.UNKNOWN:ad(c.code);return new I(l,c.message||"")}(o);t=new dd(r,i,s,a||null)}else if("documentChange"in e){const r=e.documentChange,i=at(n,r.document.name),s=ce(r.document.updateTime),o=r.document.createTime?ce(r.document.createTime):C.min(),a=new Re({mapValue:{fields:r.document.fields}}),u=ne.newFoundDocument(i,s,o,a);t=new ls(r.targetIds||[],r.removedTargetIds||[],u.key,u)}else if("documentDelete"in e){const r=e.documentDelete,i=at(n,r.document),s=r.readTime?ce(r.readTime):C.min(),o=ne.newNoDocument(i,s);t=new ls([],r.removedTargetIds||[],o.key,o)}else if("documentRemove"in e){const r=e.documentRemove,i=at(n,r.document);t=new ls([],r.removedTargetIds||[],i,null)}else{if(!("filter"in e))return P();{const r=e.filter,{count:i=0,unchangedNames:s}=r,o=new H_(i,s);t=new hd(r.targetId,o)}}var c;return t}(this.serializer,e),r=function(s){if(!("targetChange"in s))return C.min();const o=s.targetChange;return o.targetIds&&o.targetIds.length?C.min():o.readTime?ce(o.readTime):C.min()}(e);return this.listener.u_(t,r)}c_(e){const t={};t.database=wa(this.serializer),t.addTarget=function(s,o){let a;const u=o.target;if(a=rs(u)?{documents:Ad(s,u)}:{query:Pa(s,u).ut},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=gd(s,o.resumeToken);const c=Ta(s,o.expectedCount);null!==c&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo(C.min())>0){a.readTime=Ln(s,o.snapshotVersion.toTimestamp());const c=Ta(s,o.expectedCount);null!==c&&(a.expectedCount=c)}return a}(this.serializer,e);const r=function oy(n,e){const t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return P()}}(e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);r&&(t.labels=r),this.t_(t)}l_(e){const t={};t.database=wa(this.serializer),t.removeTarget=e,this.t_(t)}}class Wy extends _f{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s,this.h_=!1}get P_(){return this.h_}start(){this.h_=!1,this.lastStreamToken=void 0,super.start()}i_(){this.h_&&this.I_([])}a_(e,t){return this.connection.Fo("Write",e,t)}onMessage(e){if(x(!!e.streamToken),this.lastStreamToken=e.streamToken,this.h_){this.jo.reset();const t=function sy(n,e){return n&&n.length>0?(x(void 0!==e),n.map(t=>function(i,s){let o=ce(i.updateTime?i.updateTime:s);return o.isEqual(C.min())&&(o=ce(s)),new $_(o,i.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),r=ce(e.commitTime);return this.listener.T_(r,t)}return x(!e.writeResults||0===e.writeResults.length),this.h_=!0,this.listener.E_()}d_(){const e={};e.database=wa(this.serializer),this.t_(e)}I_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>function Yr(n,e){let t;if(e instanceof On)t={update:Td(n,e.key,e.value)};else if(e instanceof Fn)t={delete:Jr(n,e.key)};else if(e instanceof pt)t={update:Td(n,e.key,e.data),updateMask:ly(e.fieldMask)};else{if(!(e instanceof ga))return P();t={verify:Jr(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,o){const a=o.transform;if(a instanceof kn)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Xt)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof en)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Mn)return{fieldPath:o.field.canonicalString(),increment:a.Ie};throw P()}(0,r))),e.precondition.isNone||(t.currentDocument=void 0!==(s=e.precondition).updateTime?{updateTime:ny(n,s.updateTime)}:void 0!==s.exists?{exists:s.exists}:P()),t;var s}(this.serializer,r))};this.t_(t)}}class Hy extends class{}{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.A_=!1}R_(){if(this.A_)throw new I(g.FAILED_PRECONDITION,"The client has already been terminated.")}So(e,t,r,i){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.So(e,Aa(t,r),i,s,o)).catch(s=>{throw"FirebaseError"===s.name?(s.code===g.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new I(g.UNKNOWN,s.toString())})}vo(e,t,r,i,s){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.vo(e,Aa(t,r),i,o,a,s)).catch(o=>{throw"FirebaseError"===o.name?(o.code===g.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new I(g.UNKNOWN,o.toString())})}terminate(){this.A_=!0,this.connection.terminate()}}class Jy{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.m_=0,this.f_=null,this.g_=!0}p_(){0===this.m_&&(this.y_("Unknown"),this.f_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.f_=null,this.w_("Backend didn't respond within 10 seconds."),this.y_("Offline"),Promise.resolve())))}S_(e){"Online"===this.state?this.y_("Unknown"):(this.m_++,this.m_>=1&&(this.b_(),this.w_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.y_("Offline")))}set(e){this.b_(),this.m_=0,"Online"===e&&(this.g_=!1),this.y_(e)}y_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}w_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.g_?(ue(t),this.g_=!1):y("OnlineStateTracker",t)}b_(){null!==this.f_&&(this.f_.cancel(),this.f_=null)}}class Yy{constructor(e,t,r,i,s){var o=this;this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.D_=[],this.C_=new Map,this.v_=new Set,this.F_=[],this.M_=s,this.M_.io(a=>{r.enqueueAndForget((0,_.Z)(function*(){var u;Mt(o)&&(y("RemoteStore","Restarting streams for network reachability change."),yield(u=(0,_.Z)(function*(l){const h=v(l);h.v_.add(4),yield Kn(h),h.x_.set("Unknown"),h.v_.delete(4),yield ai(h)}),function c(l){return u.apply(this,arguments)})(o))}))}),this.x_=new Jy(r,i)}}function ai(n){return Ja.apply(this,arguments)}function Ja(){return Ja=(0,_.Z)(function*(n){if(Mt(n))for(const e of n.F_)yield e(!0)}),Ja.apply(this,arguments)}function Kn(n){return Ya.apply(this,arguments)}function Ya(){return Ya=(0,_.Z)(function*(n){for(const e of n.F_)yield e(!1)}),Ya.apply(this,arguments)}function Ps(n,e){const t=v(n);t.C_.has(e.targetId)||(t.C_.set(e.targetId,e),tu(t)?eu(t):Wn(t).Jo()&&Xa(t,e))}function ui(n,e){const t=v(n),r=Wn(t);t.C_.delete(e),r.Jo()&&yf(t,e),0===t.C_.size&&(r.Jo()?r.Xo():Mt(t)&&t.x_.set("Unknown"))}function Xa(n,e){if(n.O_.Oe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(C.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Wn(n).c_(e)}function yf(n,e){n.O_.Oe(e),Wn(n).l_(e)}function eu(n){n.O_=new J_({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),_t:e=>n.C_.get(e)||null,nt:()=>n.datastore.serializer.databaseId}),Wn(n).start(),n.x_.p_()}function tu(n){return Mt(n)&&!Wn(n).Ho()&&n.C_.size>0}function Mt(n){return 0===v(n).v_.size}function If(n){n.O_=void 0}function Xy(n){return nu.apply(this,arguments)}function nu(){return nu=(0,_.Z)(function*(n){n.C_.forEach((e,t)=>{Xa(n,e)})}),nu.apply(this,arguments)}function eI(n,e){return ru.apply(this,arguments)}function ru(){return ru=(0,_.Z)(function*(n,e){If(n),tu(n)?(n.x_.S_(e),eu(n)):n.x_.set("Unknown")}),ru.apply(this,arguments)}function tI(n,e,t){return iu.apply(this,arguments)}function iu(){return iu=(0,_.Z)(function*(n,e,t){if(n.x_.set("Online"),e instanceof dd&&2===e.state&&e.cause)try{yield(r=(0,_.Z)(function*(s,o){const a=o.cause;for(const u of o.targetIds)s.C_.has(u)&&(yield s.remoteSyncer.rejectListen(u,a),s.C_.delete(u),s.O_.removeTarget(u))}),function i(s,o){return r.apply(this,arguments)})(n,e)}catch(r){y("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield Ss(n,r)}else if(e instanceof ls?n.O_.$e(e):e instanceof hd?n.O_.Je(e):n.O_.Ge(e),!t.isEqual(C.min()))try{const r=yield af(n.localStore);t.compareTo(r)>=0&&(yield function(s,o){const a=s.O_.it(o);return a.targetChanges.forEach((u,c)=>{if(u.resumeToken.approximateByteSize()>0){const l=s.C_.get(c);l&&s.C_.set(c,l.withResumeToken(u.resumeToken,o))}}),a.targetMismatches.forEach((u,c)=>{const l=s.C_.get(u);if(!l)return;s.C_.set(u,l.withResumeToken(me.EMPTY_BYTE_STRING,l.snapshotVersion)),yf(s,u);const h=new gt(l.target,u,c,l.sequenceNumber);Xa(s,h)}),s.remoteSyncer.applyRemoteEvent(a)}(n,t))}catch(r){y("RemoteStore","Failed to raise snapshot:",r),yield Ss(n,r)}var r}),iu.apply(this,arguments)}function Ss(n,e,t){return su.apply(this,arguments)}function su(){return su=(0,_.Z)(function*(n,e,t){if(!wt(e))throw e;n.v_.add(1),yield Kn(n),n.x_.set("Offline"),t||(t=()=>af(n.localStore)),n.asyncQueue.enqueueRetryable((0,_.Z)(function*(){y("RemoteStore","Retrying IndexedDB access"),yield t(),n.v_.delete(1),yield ai(n)}))}),su.apply(this,arguments)}function Ef(n,e){return e().catch(t=>Ss(n,t,e))}function Qn(n){return ou.apply(this,arguments)}function ou(){return ou=(0,_.Z)(function*(n){const e=v(n),t=Ot(e);let r=e.D_.length>0?e.D_[e.D_.length-1].batchId:-1;for(;nI(e);)try{const i=yield Uy(e.localStore,r);if(null===i){0===e.D_.length&&t.Xo();break}r=i.batchId,rI(e,i)}catch(i){yield Ss(e,i)}Tf(e)&&vf(e)}),ou.apply(this,arguments)}function nI(n){return Mt(n)&&n.D_.length<10}function rI(n,e){n.D_.push(e);const t=Ot(n);t.Jo()&&t.P_&&t.I_(e.mutations)}function Tf(n){return Mt(n)&&!Ot(n).Ho()&&n.D_.length>0}function vf(n){Ot(n).start()}function iI(n){return au.apply(this,arguments)}function au(){return au=(0,_.Z)(function*(n){Ot(n).d_()}),au.apply(this,arguments)}function sI(n){return uu.apply(this,arguments)}function uu(){return uu=(0,_.Z)(function*(n){const e=Ot(n);for(const t of n.D_)e.I_(t.mutations)}),uu.apply(this,arguments)}function oI(n,e,t){return cu.apply(this,arguments)}function cu(){return cu=(0,_.Z)(function*(n,e,t){const r=n.D_.shift(),i=ya.from(r,e,t);yield Ef(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield Qn(n)}),cu.apply(this,arguments)}function aI(n,e){return lu.apply(this,arguments)}function lu(){return lu=(0,_.Z)(function*(n,e){var t;e&&Ot(n).P_&&(yield(t=(0,_.Z)(function*(i,s){if(function od(n){switch(n){default:return P();case g.CANCELLED:case g.UNKNOWN:case g.DEADLINE_EXCEEDED:case g.RESOURCE_EXHAUSTED:case g.INTERNAL:case g.UNAVAILABLE:case g.UNAUTHENTICATED:return!1;case g.INVALID_ARGUMENT:case g.NOT_FOUND:case g.ALREADY_EXISTS:case g.PERMISSION_DENIED:case g.FAILED_PRECONDITION:case g.ABORTED:case g.OUT_OF_RANGE:case g.UNIMPLEMENTED:case g.DATA_LOSS:return!0}}(a=s.code)&&a!==g.ABORTED){const o=i.D_.shift();Ot(i).Zo(),yield Ef(i,()=>i.remoteSyncer.rejectFailedWrite(o.batchId,s)),yield Qn(i)}var a}),function r(i,s){return t.apply(this,arguments)})(n,e)),Tf(n)&&vf(n)}),lu.apply(this,arguments)}function Af(n,e){return hu.apply(this,arguments)}function hu(){return hu=(0,_.Z)(function*(n,e){const t=v(n);t.asyncQueue.verifyOperationInProgress(),y("RemoteStore","RemoteStore received new credentials");const r=Mt(t);t.v_.add(3),yield Kn(t),r&&t.x_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.v_.delete(3),yield ai(t)}),hu.apply(this,arguments)}function fu(){return fu=(0,_.Z)(function*(n,e){const t=v(n);e?(t.v_.delete(2),yield ai(t)):e||(t.v_.add(2),yield Kn(t),t.x_.set("Unknown"))}),fu.apply(this,arguments)}function Wn(n){return n.N_||(n.N_=function(t,r,i){const s=v(t);return s.R_(),new Qy(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Po:Xy.bind(null,n),To:eI.bind(null,n),u_:tI.bind(null,n)}),n.F_.push(function(){var e=(0,_.Z)(function*(t){t?(n.N_.Zo(),tu(n)?eu(n):n.x_.set("Unknown")):(yield n.N_.stop(),If(n))});return function(t){return e.apply(this,arguments)}}())),n.N_}function Ot(n){return n.B_||(n.B_=function(t,r,i){const s=v(t);return s.R_(),new Wy(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Po:iI.bind(null,n),To:aI.bind(null,n),E_:sI.bind(null,n),T_:oI.bind(null,n)}),n.F_.push(function(){var e=(0,_.Z)(function*(t){t?(n.B_.Zo(),yield Qn(n)):(yield n.B_.stop(),n.D_.length>0&&(y("RemoteStore",`Stopping write stream with ${n.D_.length} pending writes`),n.D_=[]))});return function(t){return e.apply(this,arguments)}}())),n.B_}class mu{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new fe,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){const o=Date.now()+r,a=new mu(e,t,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new I(g.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Hn(n,e){if(ue("AsyncQueue",`${e}: ${n}`),wt(n))return new I(g.UNAVAILABLE,`${e}: ${n}`);throw n}class Zn{constructor(e){this.comparator=e?(t,r)=>e(t,r)||w.comparator(t.key,r.key):(t,r)=>w.comparator(t.key,r.key),this.keyedMap=jr(),this.sortedSet=new X(this.comparator)}static emptySet(e){return new Zn(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Zn)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const r=new Zn;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class wf{constructor(){this.L_=new X(w.comparator)}track(e){const t=e.doc.key,r=this.L_.get(t);r?0!==e.type&&3===r.type?this.L_=this.L_.insert(t,e):3===e.type&&1!==r.type?this.L_=this.L_.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.L_=this.L_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.L_=this.L_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.L_=this.L_.remove(t):1===e.type&&2===r.type?this.L_=this.L_.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.L_=this.L_.insert(t,{type:2,doc:e.doc}):P():this.L_=this.L_.insert(t,e)}k_(){const e=[];return this.L_.inorderTraversal((t,r)=>{e.push(r)}),e}}class Jn{constructor(e,t,r,i,s,o,a,u,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=u,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,i,s){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new Jn(e,t,Zn.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Gr(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}}class uI{constructor(){this.q_=void 0,this.Q_=[]}}class cI{constructor(){this.queries=new mt(e=>qh(e),Gr),this.onlineState="Unknown",this.K_=new Set}}function pu(n,e){return gu.apply(this,arguments)}function gu(){return gu=(0,_.Z)(function*(n,e){const t=v(n),r=e.query;let i=!1,s=t.queries.get(r);if(s||(i=!0,s=new uI),i)try{s.q_=yield t.onListen(r)}catch(o){const a=Hn(o,`Initialization of query '${Nn(e.query)}' failed`);return void e.onError(a)}t.queries.set(r,s),s.Q_.push(e),e.U_(t.onlineState),s.q_&&e.W_(s.q_)&&Iu(t)}),gu.apply(this,arguments)}function _u(n,e){return yu.apply(this,arguments)}function yu(){return yu=(0,_.Z)(function*(n,e){const t=v(n),r=e.query;let i=!1;const s=t.queries.get(r);if(s){const o=s.Q_.indexOf(e);o>=0&&(s.Q_.splice(o,1),i=0===s.Q_.length)}if(i)return t.queries.delete(r),t.onUnlisten(r)}),yu.apply(this,arguments)}function lI(n,e){const t=v(n);let r=!1;for(const i of e){const o=t.queries.get(i.query);if(o){for(const a of o.Q_)a.W_(i)&&(r=!0);o.q_=i}}r&&Iu(t)}function hI(n,e,t){const r=v(n),i=r.queries.get(e);if(i)for(const s of i.Q_)s.onError(t);r.queries.delete(e)}function Iu(n){n.K_.forEach(e=>{e.next()})}class Eu{constructor(e,t,r){this.query=e,this.G_=t,this.z_=!1,this.j_=null,this.onlineState="Unknown",this.options=r||{}}W_(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)3!==i.type&&r.push(i);e=new Jn(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.z_?this.H_(e)&&(this.G_.next(e),t=!0):this.J_(e,this.onlineState)&&(this.Y_(e),t=!0),this.j_=e,t}onError(e){this.G_.error(e)}U_(e){this.onlineState=e;let t=!1;return this.j_&&!this.z_&&this.J_(this.j_,e)&&(this.Y_(this.j_),t=!0),t}J_(e,t){return!e.fromCache||(!this.options.Z_||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}H_(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.j_&&this.j_.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}Y_(e){e=Jn.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.z_=!0,this.G_.next(e)}}class Sf{constructor(e){this.key=e}}class bf{constructor(e){this.key=e}}class xf{constructor(e,t){this.query=e,this.oa=t,this._a=null,this.hasCachedResults=!1,this.current=!1,this.aa=L(),this.mutatedKeys=L(),this.ua=zh(e),this.ca=new Zn(this.ua)}get la(){return this.oa}ha(e,t){const r=t?t.Pa:new wf,i=t?t.ca:this.ca;let s=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1;const u="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,c="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((l,h)=>{const d=i.get(l),p=zr(this.query,h)?h:null,E=!!d&&this.mutatedKeys.has(d.key),A=!!p&&(p.hasLocalMutations||this.mutatedKeys.has(p.key)&&p.hasCommittedMutations);let T=!1;d&&p?d.data.isEqual(p.data)?E!==A&&(r.track({type:3,doc:p}),T=!0):this.Ia(d,p)||(r.track({type:2,doc:p}),T=!0,(u&&this.ua(p,u)>0||c&&this.ua(p,c)<0)&&(a=!0)):!d&&p?(r.track({type:0,doc:p}),T=!0):d&&!p&&(r.track({type:1,doc:d}),T=!0,(u||c)&&(a=!0)),T&&(p?(o=o.add(p),s=A?s.add(l):s.delete(l)):(o=o.delete(l),s=s.delete(l)))}),null!==this.query.limit)for(;o.size>this.query.limit;){const l="F"===this.query.limitType?o.last():o.first();o=o.delete(l.key),s=s.delete(l.key),r.track({type:1,doc:l})}return{ca:o,Pa:r,Xi:a,mutatedKeys:s}}Ia(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){const s=this.ca;this.ca=e.ca,this.mutatedKeys=e.mutatedKeys;const o=e.Pa.k_();o.sort((l,h)=>function(p,E){const A=T=>{switch(T){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return P()}};return A(p)-A(E)}(l.type,h.type)||this.ua(l.doc,h.doc)),this.Ta(r),i=null!=i&&i;const a=t&&!i?this.Ea():[],u=0===this.aa.size&&this.current&&!i?1:0,c=u!==this._a;return this._a=u,0!==o.length||c?{snapshot:new Jn(this.query,e.ca,s,o,e.mutatedKeys,0===u,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),da:a}:{da:a}}U_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({ca:this.ca,Pa:new wf,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{da:[]}}Aa(e){return!this.oa.has(e)&&!!this.ca.has(e)&&!this.ca.get(e).hasLocalMutations}Ta(e){e&&(e.addedDocuments.forEach(t=>this.oa=this.oa.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.oa=this.oa.delete(t)),this.current=e.current)}Ea(){if(!this.current)return[];const e=this.aa;this.aa=L(),this.ca.forEach(r=>{this.Aa(r.key)&&(this.aa=this.aa.add(r.key))});const t=[];return e.forEach(r=>{this.aa.has(r)||t.push(new bf(r))}),this.aa.forEach(r=>{e.has(r)||t.push(new Sf(r))}),t}Ra(e){this.oa=e.hs,this.aa=L();const t=this.ha(e.documents);return this.applyChanges(t,!0)}Va(){return Jn.fromInitialDocuments(this.query,this.ca,this.mutatedKeys,0===this._a,this.hasCachedResults)}}class mI{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class pI{constructor(e){this.key=e,this.ma=!1}}class gI{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.fa={},this.ga=new mt(a=>qh(a),Gr),this.pa=new Map,this.ya=new Set,this.wa=new X(w.comparator),this.Sa=new Map,this.ba=new ka,this.Da={},this.Ca=new Map,this.va=an.Bn(),this.onlineState="Unknown",this.Fa=void 0}get isPrimaryClient(){return!0===this.Fa}}function _I(n,e){return Tu.apply(this,arguments)}function Tu(){return Tu=(0,_.Z)(function*(n,e){const t=function ju(n){const e=v(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Cf.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=PI.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=EI.bind(null,e),e.fa.u_=lI.bind(null,e.eventManager),e.fa.xa=hI.bind(null,e.eventManager),e}(n);let r,i;const s=t.ga.get(e);if(s)r=s.targetId,t.sharedClientState.addLocalQueryTarget(r),i=s.view.Va();else{const o=yield function jn(n,e){const t=v(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.Qr.getTargetData(r,e).next(s=>s?(i=s,m.resolve(i)):t.Qr.allocateTargetId(r).next(o=>(i=new gt(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Qr.addTargetData(r,i).next(()=>i))))}).then(r=>{const i=t.ns.get(r.targetId);return(null===i||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.ns=t.ns.insert(r.targetId,r),t.rs.set(e,r.targetId)),r})}(t.localStore,Me(e)),a=t.sharedClientState.addLocalQueryTarget(o.targetId);r=o.targetId,i=yield function vu(n,e,t,r,i){return Au.apply(this,arguments)}(t,e,r,"current"===a,o.resumeToken),t.isPrimaryClient&&Ps(t.remoteStore,o)}return i}),Tu.apply(this,arguments)}function Au(){return Au=(0,_.Z)(function*(n,e,t,r,i){n.Ma=(h,d,p)=>{return(E=(0,_.Z)(function*(T,V,O,D){let B=V.view.ha(O);B.Xi&&(B=yield Ts(T.localStore,V.query,!1).then(({documents:Ze})=>V.view.ha(Ze,B)));const J=D&&D.targetChanges.get(V.targetId),W=D&&null!=D.targetMismatches.get(V.targetId),pe=V.view.applyChanges(B,T.isPrimaryClient,J,W);return Nu(T,V.targetId,pe.da),pe.snapshot}),function A(T,V,O,D){return E.apply(this,arguments)})(n,h,d,p);var E};const s=yield Ts(n.localStore,e,!0),o=new xf(e,s.hs),a=o.ha(s.documents),u=Zr.createSynthesizedTargetChangeForCurrentChange(t,r&&"Offline"!==n.onlineState,i),c=o.applyChanges(a,n.isPrimaryClient,u);Nu(n,t,c.da);const l=new mI(e,t,o);return n.ga.set(e,l),n.pa.has(t)?n.pa.get(t).push(e):n.pa.set(t,[e]),c.snapshot}),Au.apply(this,arguments)}function yI(n,e){return wu.apply(this,arguments)}function wu(){return wu=(0,_.Z)(function*(n,e){const t=v(n),r=t.ga.get(e),i=t.pa.get(r.targetId);if(i.length>1)return t.pa.set(r.targetId,i.filter(s=>!Gr(s,e))),void t.ga.delete(e);t.isPrimaryClient?(t.sharedClientState.removeLocalQueryTarget(r.targetId),t.sharedClientState.isActiveQueryTarget(r.targetId)||(yield $n(t.localStore,r.targetId,!1).then(()=>{t.sharedClientState.clearQueryState(r.targetId),ui(t.remoteStore,r.targetId),Yn(t,r.targetId)}).catch(At))):(Yn(t,r.targetId),yield $n(t.localStore,r.targetId,!0))}),wu.apply(this,arguments)}function Ru(){return Ru=(0,_.Z)(function*(n,e,t){const r=function $u(n){const e=v(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=TI.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=vI.bind(null,e),e}(n);try{const i=yield function(o,a){const u=v(o),c=se.now(),l=a.reduce((p,E)=>p.add(E.key),L());let h,d;return u.persistence.runTransaction("Locally write mutations","readwrite",p=>{let E=Le(),A=L();return u.os.getEntries(p,l).next(T=>{E=T,E.forEach((V,O)=>{O.isValidDocument()||(A=A.add(V))})}).next(()=>u.localDocuments.getOverlayedDocuments(p,E)).next(T=>{h=T;const V=[];for(const O of a){const D=Q_(O,h.get(O.key).overlayedDocument);null!=D&&V.push(new pt(O.key,D,Ph(D.value.mapValue),ie.exists(!0)))}return u.mutationQueue.addMutationBatch(p,c,V,a)}).next(T=>{d=T;const V=T.applyToLocalDocumentSet(h,A);return u.documentOverlayCache.saveOverlays(p,T.batchId,V)})}).then(()=>({batchId:d.batchId,changes:$h(h)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(o,a,u){let c=o.Da[o.currentUser.toKey()];c||(c=new X(k)),c=c.insert(a,u),o.Da[o.currentUser.toKey()]=c}(r,i.batchId,t),yield _t(r,i.changes),yield Qn(r.remoteStore)}catch(i){const s=Hn(i,"Failed to persist write");t.reject(s)}}),Ru.apply(this,arguments)}function Cf(n,e){return Pu.apply(this,arguments)}function Pu(){return Pu=(0,_.Z)(function*(n,e){const t=v(n);try{const r=yield function By(n,e){const t=v(n),r=e.snapshotVersion;let i=t.ns;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const o=t.os.newChangeBuffer({trackRemovals:!0});i=t.ns;const a=[];e.targetChanges.forEach((l,h)=>{const d=i.get(h);if(!d)return;a.push(t.Qr.removeMatchingKeys(s,l.removedDocuments,h).next(()=>t.Qr.addMatchingKeys(s,l.addedDocuments,h)));let p=d.withSequenceNumber(s.currentSequenceNumber);var A,T,V;null!==e.targetMismatches.get(h)?p=p.withResumeToken(me.EMPTY_BYTE_STRING,C.min()).withLastLimboFreeSnapshotVersion(C.min()):l.resumeToken.approximateByteSize()>0&&(p=p.withResumeToken(l.resumeToken,r)),i=i.insert(h,p),T=p,V=l,(0===(A=d).resumeToken.approximateByteSize()||T.snapshotVersion.toMicroseconds()-A.snapshotVersion.toMicroseconds()>=3e8||V.addedDocuments.size+V.modifiedDocuments.size+V.removedDocuments.size>0)&&a.push(t.Qr.updateTargetData(s,p))});let u=Le(),c=L();if(e.documentUpdates.forEach(l=>{e.resolvedLimboDocuments.has(l)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,l))}),a.push(function uf(n,e,t){let r=L(),i=L();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=Le();return t.forEach((a,u)=>{const c=s.get(a);u.isFoundDocument()!==c.isFoundDocument()&&(i=i.add(a)),u.isNoDocument()&&u.version.isEqual(C.min())?(e.removeEntry(a,u.readTime),o=o.insert(a,u)):!c.isValidDocument()||u.version.compareTo(c.version)>0||0===u.version.compareTo(c.version)&&c.hasPendingWrites?(e.addEntry(u),o=o.insert(a,u)):y("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",u.version)}),{cs:o,ls:i}})}(s,o,e.documentUpdates).next(l=>{u=l.cs,c=l.ls})),!r.isEqual(C.min())){const l=t.Qr.getLastRemoteSnapshotVersion(s).next(h=>t.Qr.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(l)}return m.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,u,c)).next(()=>u)}).then(s=>(t.ns=i,s))}(t.localStore,e);e.targetChanges.forEach((i,s)=>{const o=t.Sa.get(s);o&&(x(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.ma=!0:i.modifiedDocuments.size>0?x(o.ma):i.removedDocuments.size>0&&(x(o.ma),o.ma=!1))}),yield _t(t,r,e)}catch(r){yield At(r)}}),Pu.apply(this,arguments)}function Vf(n,e,t){const r=v(n);if(r.isPrimaryClient&&0===t||!r.isPrimaryClient&&1===t){const i=[];r.ga.forEach((s,o)=>{const a=o.view.U_(e);a.snapshot&&i.push(a.snapshot)}),function(o,a){const u=v(o);u.onlineState=a;let c=!1;u.queries.forEach((l,h)=>{for(const d of h.Q_)d.U_(a)&&(c=!0)}),c&&Iu(u)}(r.eventManager,e),i.length&&r.fa.u_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function EI(n,e,t){return Su.apply(this,arguments)}function Su(){return Su=(0,_.Z)(function*(n,e,t){const r=v(n);r.sharedClientState.updateQueryState(e,"rejected",t);const i=r.Sa.get(e),s=i&&i.key;if(s){let o=new X(w.comparator);o=o.insert(s,ne.newNoDocument(s,C.min()));const a=L().add(s),u=new Hr(C.min(),new Map,new X(k),o,a);yield Cf(r,u),r.wa=r.wa.remove(s),r.Sa.delete(e),ku(r)}else yield $n(r.localStore,e,!1).then(()=>Yn(r,e,t)).catch(At)}),Su.apply(this,arguments)}function TI(n,e){return bu.apply(this,arguments)}function bu(){return bu=(0,_.Z)(function*(n,e){const t=v(n),r=e.batch.batchId;try{const i=yield function Ly(n,e){const t=v(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const i=e.batch.keys(),s=t.os.newChangeBuffer({trackRemovals:!0});return function(a,u,c,l){const h=c.batch,d=h.keys();let p=m.resolve();return d.forEach(E=>{p=p.next(()=>l.getEntry(u,E)).next(A=>{const T=c.docVersions.get(E);x(null!==T),A.version.compareTo(T)<0&&(h.applyToRemoteDocument(A,c),A.isValidDocument()&&(A.setReadTime(c.commitVersion),l.addEntry(A)))})}),p.next(()=>a.mutationQueue.removeMutationBatch(u,h))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let u=L();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(u=u.add(a.batch.mutations[c].key));return u}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}(t.localStore,e);Du(t,r,null),Vu(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield _t(t,i)}catch(i){yield At(i)}}),bu.apply(this,arguments)}function vI(n,e,t){return xu.apply(this,arguments)}function xu(){return xu=(0,_.Z)(function*(n,e,t){const r=v(n);try{const i=yield function(o,a){const u=v(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let l;return u.mutationQueue.lookupMutationBatch(c,a).next(h=>(x(null!==h),l=h.keys(),u.mutationQueue.removeMutationBatch(c,h))).next(()=>u.mutationQueue.performConsistencyCheck(c)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(c,l,a)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,l)).next(()=>u.localDocuments.getDocuments(c,l))})}(r.localStore,e);Du(r,e,t),Vu(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield _t(r,i)}catch(i){yield At(i)}}),xu.apply(this,arguments)}function Vu(n,e){(n.Ca.get(e)||[]).forEach(t=>{t.resolve()}),n.Ca.delete(e)}function Du(n,e,t){const r=v(n);let i=r.Da[r.currentUser.toKey()];if(i){const s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.Da[r.currentUser.toKey()]=i}}function Yn(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.pa.get(e))n.ga.delete(r),t&&n.fa.xa(r,t);n.pa.delete(e),n.isPrimaryClient&&n.ba.Vr(e).forEach(r=>{n.ba.containsKey(r)||Df(n,r)})}function Df(n,e){n.ya.delete(e.path.canonicalString());const t=n.wa.get(e);null!==t&&(ui(n.remoteStore,t),n.wa=n.wa.remove(e),n.Sa.delete(t),ku(n))}function Nu(n,e,t){for(const r of t)r instanceof Sf?(n.ba.addReference(r.key,e),wI(n,r)):r instanceof bf?(y("SyncEngine","Document no longer in limbo: "+r.key),n.ba.removeReference(r.key,e),n.ba.containsKey(r.key)||Df(n,r.key)):P()}function wI(n,e){const t=e.key,r=t.path.canonicalString();n.wa.get(t)||n.ya.has(r)||(y("SyncEngine","New document in limbo: "+t),n.ya.add(r),ku(n))}function ku(n){for(;n.ya.size>0&&n.wa.size<n.maxConcurrentLimboResolutions;){const e=n.ya.values().next().value;n.ya.delete(e);const t=new w(U.fromString(e)),r=n.va.next();n.Sa.set(r,new pI(t)),n.wa=n.wa.insert(t,r),Ps(n.remoteStore,new gt(Me(Vn(t.path)),r,"TargetPurposeLimboResolution",ze._e))}}function _t(n,e,t){return Mu.apply(this,arguments)}function Mu(){return Mu=(0,_.Z)(function*(n,e,t){const r=v(n),i=[],s=[],o=[];var a;r.ga.isEmpty()||(r.ga.forEach((a,u)=>{o.push(r.Ma(u,e,t).then(c=>{if((c||t)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(u.targetId,null!=c&&c.fromCache?"not-current":"current"),c){i.push(c);const l=Ba.Ki(u.targetId,c);s.push(l)}}))}),yield Promise.all(o),r.fa.u_(i),yield(a=(0,_.Z)(function*(c,l){const h=v(c);try{yield h.persistence.runTransaction("notifyLocalViewChanges","readwrite",d=>m.forEach(l,p=>m.forEach(p.qi,E=>h.persistence.referenceDelegate.addReference(d,p.targetId,E)).next(()=>m.forEach(p.Qi,E=>h.persistence.referenceDelegate.removeReference(d,p.targetId,E)))))}catch(d){if(!wt(d))throw d;y("LocalStore","Failed to update sequence numbers: "+d)}for(const d of l){const p=d.targetId;if(!d.fromCache){const E=h.ns.get(p),T=E.withLastLimboFreeSnapshotVersion(E.snapshotVersion);h.ns=h.ns.insert(p,T)}}}),function u(c,l){return a.apply(this,arguments)})(r.localStore,s))}),Mu.apply(this,arguments)}function RI(n,e){return Ou.apply(this,arguments)}function Ou(){return Ou=(0,_.Z)(function*(n,e){const t=v(n);if(!t.currentUser.isEqual(e)){y("SyncEngine","User change. New user:",e.toKey());const r=yield of(t.localStore,e);t.currentUser=e,(s=t).Ca.forEach(a=>{a.forEach(u=>{u.reject(new I(g.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),s.Ca.clear(),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield _t(t,r.us)}var s}),Ou.apply(this,arguments)}function PI(n,e){const t=v(n),r=t.Sa.get(e);if(r&&r.ma)return L().add(r.key);{let i=L();const s=t.pa.get(e);if(!s)return i;for(const o of s){const a=t.ga.get(o);i=i.unionWith(a.view.la)}return i}}class bs{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,_.Z)(function*(){t.serializer=oi(e.databaseInfo.databaseId),t.sharedClientState=t.createSharedClientState(e),t.persistence=t.createPersistence(e),yield t.persistence.start(),t.localStore=t.createLocalStore(e),t.gcScheduler=t.createGarbageCollectionScheduler(e,t.localStore),t.indexBackfillerScheduler=t.createIndexBackfillerScheduler(e,t.localStore)})()}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return function sf(n,e,t,r){return new Fy(n,e,t,r)}(this.persistence,new rf,e.initialUser,this.serializer)}createPersistence(e){return new Ma(ys.Hr,this.serializer)}createSharedClientState(e){return new mf}terminate(){var e=this;return(0,_.Z)(function*(){var t,r;null===(t=e.gcScheduler)||void 0===t||t.stop(),null===(r=e.indexBackfillerScheduler)||void 0===r||r.stop(),e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class Xn{initialize(e,t){var r=this;return(0,_.Z)(function*(){r.localStore||(r.localStore=e.localStore,r.sharedClientState=e.sharedClientState,r.datastore=r.createDatastore(t),r.remoteStore=r.createRemoteStore(t),r.eventManager=r.createEventManager(t),r.syncEngine=r.createSyncEngine(t,!e.synchronizeTabs),r.sharedClientState.onlineStateHandler=i=>Vf(r.syncEngine,i,1),r.remoteStore.remoteSyncer.handleCredentialChange=RI.bind(null,r.syncEngine),yield function du(n,e){return fu.apply(this,arguments)}(r.remoteStore,r.syncEngine.isPrimaryClient))})()}createEventManager(e){return new cI}createDatastore(e){const t=oi(e.databaseInfo.databaseId),r=new Ky(e.databaseInfo);return new Hy(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return r=this.localStore,i=this.datastore,s=e.asyncQueue,o=t=>Vf(this.syncEngine,t,0),a=pf.D()?new pf:new zy,new Yy(r,i,s,o,a);var r,i,s,o,a}createSyncEngine(e,t){return function(i,s,o,a,u,c,l){const h=new gI(i,s,o,a,u,c);return l&&(h.Fa=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){var e=this;return(0,_.Z)(function*(){var t,r;yield(r=(0,_.Z)(function*(s){const o=v(s);y("RemoteStore","RemoteStore shutting down."),o.v_.add(5),yield Kn(o),o.M_.shutdown(),o.x_.set("Unknown")}),function i(s){return r.apply(this,arguments)})(e.remoteStore),null===(t=e.datastore)||void 0===t||t.terminate()})()}}class xs{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ba(this.observer.next,e)}error(e){this.observer.error?this.Ba(this.observer.error,e):ue("Uncaught Error in snapshot listener:",e.toString())}La(){this.muted=!0}Ba(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class BI{constructor(e,t,r,i){var s=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=ye.UNAUTHENTICATED,this.clientId=rh.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,function(){var o=(0,_.Z)(function*(a){y("FirestoreClient","Received user=",a.uid),yield s.authCredentialListener(a),s.user=a});return function(a){return o.apply(this,arguments)}}()),this.appCheckCredentials.start(r,o=>(y("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new I(g.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new fe;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,_.Z)(function*(){try{e._onlineComponents&&(yield e._onlineComponents.terminate()),e._offlineComponents&&(yield e._offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(r){const i=Hn(r,"Failed to shutdown persistence");t.reject(i)}})),t.promise}}function Cs(n,e){return Ku.apply(this,arguments)}function Ku(){return Ku=(0,_.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress(),y("FirestoreClient","Initializing OfflineComponentProvider");const t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(function(){var i=(0,_.Z)(function*(s){r.isEqual(s)||(yield of(e.localStore,s),r=s)});return function(s){return i.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}),Ku.apply(this,arguments)}function Qu(n,e){return Wu.apply(this,arguments)}function Wu(){return Wu=(0,_.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress();const t=yield function Hu(n){return Zu.apply(this,arguments)}(n);y("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>Af(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>Af(e.remoteStore,i)),n._onlineComponents=e}),Wu.apply(this,arguments)}function Zu(){return Zu=(0,_.Z)(function*(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){y("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Cs(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function Lf(n){return"FirebaseError"===n.name?n.code===g.FAILED_PRECONDITION||n.code===g.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||22===n.code||20===n.code||11===n.code}(t))throw t;qe("Error using user provided cache. Falling back to memory cache: "+t),yield Cs(n,new bs)}}else y("FirestoreClient","Using default OfflineComponentProvider"),yield Cs(n,new bs);return n._offlineComponents}),Zu.apply(this,arguments)}function Vs(n){return Ju.apply(this,arguments)}function Ju(){return Ju=(0,_.Z)(function*(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(y("FirestoreClient","Using user provided OnlineComponentProvider"),yield Qu(n,n._uninitializedComponentsProvider._online)):(y("FirestoreClient","Using default OnlineComponentProvider"),yield Qu(n,new Xn))),n._onlineComponents}),Ju.apply(this,arguments)}function tr(n){return Xu.apply(this,arguments)}function Xu(){return Xu=(0,_.Z)(function*(n){const e=yield Vs(n),t=e.eventManager;return t.onListen=_I.bind(null,e.syncEngine),t.onUnlisten=yI.bind(null,e.syncEngine),t}),Xu.apply(this,arguments)}function jf(n){const e={};return void 0!==n.timeoutSeconds&&(e.timeoutSeconds=n.timeoutSeconds),e}const $f=new Map;function ec(n,e,t){if(!t)throw new I(g.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Kf(n){if(!w.isDocumentKey(n))throw new I(g.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Qf(n){if(w.isDocumentKey(n))throw new I(g.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Ds(n){if(void 0===n)return"undefined";if(null===n)return"null";if("string"==typeof n)return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if("number"==typeof n||"boolean"==typeof n)return""+n;if("object"==typeof n){if(n instanceof Array)return"an array";{const e=(r=n).constructor?r.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var r;return"function"==typeof n?"a function":P()}function G(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new I(g.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Ds(n);throw new I(g.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}class Hf{constructor(e){var t,r;if(void 0===e.host){if(void 0!==e.ssl)throw new I(g.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new I(g.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function ZI(n,e,t,r){if(!0===e&&!0===r)throw new I(g.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!(this.experimentalForceLongPolling||void 0!==e.experimentalAutoDetectLongPolling&&!e.experimentalAutoDetectLongPolling),this.experimentalLongPollingOptions=jf(null!==(r=e.experimentalLongPollingOptions)&&void 0!==r?r:{}),function(s){if(void 0!==s.timeoutSeconds){if(isNaN(s.timeoutSeconds))throw new I(g.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new I(g.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new I(g.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.experimentalLongPollingOptions.timeoutSeconds===e.experimentalLongPollingOptions.timeoutSeconds&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class ci{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Hf({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new I(g.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new I(g.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Hf(e),void 0!==e.credentials&&(this._authCredentials=function(r){if(!r)return new Kg;switch(r.type){case"firstParty":return new Zg(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new I(g.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=$f.get(t);r&&(y("ComponentProvider","Removing Datastore"),$f.delete(t),r.terminate())}(this),Promise.resolve()}}class Pe{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Pe(this.firestore,e,this._query)}}class le{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ut(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new le(this.firestore,e,this._key)}}class ut extends Pe{constructor(e,t,r){super(e,t,Vn(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new le(this.firestore,null,new w(e))}withConverter(e){return new ut(this.firestore,e,this._path)}}function tc(n,e,...t){if(n=mn(n),ec("collection","path",e),n instanceof ci){const r=U.fromString(e,...t);return Qf(r),new ut(n,null,r)}{if(!(n instanceof le||n instanceof ut))throw new I(g.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(U.fromString(e,...t));return Qf(r),new ut(n.firestore,null,r)}}function nc(n,e,...t){if(n=mn(n),1===arguments.length&&(e=rh.newId()),ec("doc","path",e),n instanceof ci){const r=U.fromString(e,...t);return Kf(r),new le(n,null,new w(r))}{if(!(n instanceof le||n instanceof ut))throw new I(g.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(U.fromString(e,...t));return Kf(r),new le(n.firestore,n instanceof ut?n.converter:null,new w(r))}}class YI{constructor(){this.Xa=Promise.resolve(),this.eu=[],this.tu=!1,this.nu=[],this.ru=null,this.iu=!1,this.su=!1,this.ou=[],this.jo=new Ha(this,"async_queue_retry"),this._u=()=>{const t=Rs();t&&y("AsyncQueue","Visibility state changed to "+t.visibilityState),this.jo.Ko()};const e=Rs();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this._u)}get isShuttingDown(){return this.tu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.au(),this.uu(e)}enterRestrictedMode(e){if(!this.tu){this.tu=!0,this.su=e||!1;const t=Rs();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._u)}}enqueue(e){if(this.au(),this.tu)return new Promise(()=>{});const t=new fe;return this.uu(()=>this.tu&&this.su?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.eu.push(e),this.cu()))}cu(){var e=this;return(0,_.Z)(function*(){if(0!==e.eu.length){try{yield e.eu[0](),e.eu.shift(),e.jo.reset()}catch(t){if(!wt(t))throw t;y("AsyncQueue","Operation failed with retryable error: "+t)}e.eu.length>0&&e.jo.qo(()=>e.cu())}})()}uu(e){const t=this.Xa.then(()=>(this.iu=!0,e().catch(r=>{throw this.ru=r,this.iu=!1,ue("INTERNAL UNHANDLED ERROR: ",function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+"\n"+o.stack),a}(r)),r}).then(r=>(this.iu=!1,r))));return this.Xa=t,t}enqueueAfterDelay(e,t,r){this.au(),this.ou.indexOf(e)>-1&&(t=0);const i=mu.createAndSchedule(this,e,t,r,s=>this.lu(s));return this.nu.push(i),i}au(){this.ru&&P()}verifyOperationInProgress(){}hu(){var e=this;return(0,_.Z)(function*(){let t;do{t=e.Xa,yield t}while(t!==e.Xa)})()}Pu(e){for(const t of this.nu)if(t.timerId===e)return!0;return!1}Iu(e){return this.hu().then(()=>{this.nu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.nu)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.hu()})}Tu(e){this.ou.push(e)}lu(e){const t=this.nu.indexOf(e);this.nu.splice(t,1)}}function rc(n){return function(t,r){if("object"!=typeof t||null===t)return!1;const i=t;for(const s of["next","error","complete"])if(s in i&&"function"==typeof i[s])return!0;return!1}(n)}class ee extends ci{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new YI,this._persistenceKey=(null==i?void 0:i.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||Jf(this),this._firestoreClient.terminate()}}function eE(n,e){const t="object"==typeof n?n:function bp(n=Ei){const e=Gt.get(n);if(!e&&n===Ei&&gi())return Vc();if(!e)throw ct.create("no-app",{appName:n});return e}(),r="string"==typeof n?n:e||"(default)",i=function Cc(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}(t,"firestore").getImmediate({identifier:r});if(!i._initialized){const s=(n=>{const e=(n=>{var e,t;return null===(t=null===(e=dn())||void 0===e?void 0:e.emulatorHosts)||void 0===t?void 0:t[n]})(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return"["===e[0]?[e.substring(1,t-1),r]:[e.substring(0,t),r]})("firestore");s&&function JI(n,e,t,r={}){var i;const s=(n=G(n,ci))._getSettings(),o=`${e}:${t}`;if("firestore.googleapis.com"!==s.host&&s.host!==o&&qe("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,u;if("string"==typeof r.mockUserToken)a=r.mockUserToken,u=ye.MOCK_USER;else{a=function N(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const r=e||"demo-project",i=n.iat||0,s=n.sub||n.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},n);return[$e(JSON.stringify({alg:"none",type:"JWT"})),$e(JSON.stringify(o)),""].join(".")}(r.mockUserToken,null===(i=n._app)||void 0===i?void 0:i.options.projectId);const c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new I(g.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new ye(c)}n._authCredentials=new Qg(new th(a,u))}}(i,...s)}return i}function he(n){return n._firestoreClient||Jf(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function Jf(n){var e,t,r;const i=n._freezeSettings(),s=(u=(null===(e=n._app)||void 0===e?void 0:e.options.appId)||"",new P_(n._databaseId,u,n._persistenceKey,(l=i).host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,jf(l.experimentalLongPollingOptions),l.useFetchStreams));var u,l;n._firestoreClient=new BI(n._authCredentials,n._appCheckCredentials,n._queue,s),null!==(t=i.localCache)&&void 0!==t&&t._offlineComponentProvider&&null!==(r=i.localCache)&&void 0!==r&&r._onlineComponentProvider&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}class cn{constructor(e){this._byteString=e}static fromBase64String(e){try{return new cn(me.fromBase64String(e))}catch(t){throw new I(g.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new cn(me.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class nr{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new I(g.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new re(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class em{constructor(e){this._methodName=e}}class ic{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new I(g.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new I(g.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return k(this._lat,e._lat)||k(this._long,e._long)}}const nE=/^__.*__$/;class rE{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new pt(e,this.data,this.fieldMask,t,this.fieldTransforms):new On(e,this.data,t,this.fieldTransforms)}}function nm(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw P()}}class Ns{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,void 0===s&&this.Eu(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get du(){return this.settings.du}Au(e){return new Ns(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ru(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.Au({path:r,Vu:!1});return i.mu(e),i}fu(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.Au({path:r,Vu:!1});return i.Eu(),i}gu(e){return this.Au({path:void 0,Vu:!0})}pu(e){return Ms(e,this.settings.methodName,this.settings.yu||!1,this.path,this.settings.wu)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Eu(){if(this.path)for(let e=0;e<this.path.length;e++)this.mu(this.path.get(e))}mu(e){if(0===e.length)throw this.pu("Document fields must not be empty");if(nm(this.du)&&nE.test(e))throw this.pu('Document fields cannot begin and end with "__"')}}class iE{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||oi(e)}Su(e,t,r,i=!1){return new Ns({du:e,methodName:t,wu:r,path:re.emptyPath(),Vu:!1,yu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function rr(n){const e=n._freezeSettings(),t=oi(n._databaseId);return new iE(n._databaseId,!!e.ignoreUndefinedProperties,t)}function sc(n,e,t,r,i,s={}){const o=n.Su(s.merge||s.mergeFields?2:0,e,t,i);lc("Data must be an object, but it was:",o,r);const a=am(r,o);let u,c;if(s.merge)u=new Fe(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){const l=[];for(const h of s.mergeFields){const d=di(e,h,t);if(!o.contains(d))throw new I(g.INVALID_ARGUMENT,`Field '${d}' is specified in your field mask but missing from your input data.`);cm(l,d)||l.push(d)}u=new Fe(l),c=o.fieldTransforms.filter(h=>u.covers(h.field))}else u=null,c=o.fieldTransforms;return new rE(new Re(a),u,c)}function ln(n,e){if(um(n=mn(n)))return lc("Unsupported field value:",e,n),am(n,e);if(n instanceof em)return function(r,i){if(!nm(i.du))throw i.pu(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.pu(`${r._methodName}() is not currently supported inside arrays`);const s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,e),null;if(void 0===n&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.Vu&&4!==e.du)throw e.pu("Nested arrays are not supported");return function(r,i){const s=[];let o=0;for(const a of r){let u=ln(a,i.gu(o));null==u&&(u={nullValue:"NULL_VALUE"}),s.push(u),o++}return{arrayValue:{values:s}}}(n,e)}return function(r,i){if(null===(r=mn(r)))return{nullValue:"NULL_VALUE"};if("number"==typeof r)return Hh(i.serializer,r);if("boolean"==typeof r)return{booleanValue:r};if("string"==typeof r)return{stringValue:r};if(r instanceof Date){const s=se.fromDate(r);return{timestampValue:Ln(i.serializer,s)}}if(r instanceof se){const s=new se(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Ln(i.serializer,s)}}if(r instanceof ic)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof cn)return{bytesValue:gd(i.serializer,r._byteString)};if(r instanceof le){const s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.pu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:va(r.firestore._databaseId||i.databaseId,r._key.path)}}throw i.pu(`Unsupported field value: ${Ds(r)}`)}(n,e)}function am(n,e){const t={};return _h(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Rt(n,(r,i)=>{const s=ln(i,e.Ru(r));null!=s&&(t[r]=s)}),{mapValue:{fields:t}}}function um(n){return!("object"!=typeof n||null===n||n instanceof Array||n instanceof Date||n instanceof se||n instanceof ic||n instanceof cn||n instanceof le||n instanceof em)}function lc(n,e,t){if(!um(t)||"object"!=typeof(i=t)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i)){const r=Ds(t);throw e.pu("an object"===r?n+" a custom object":n+" "+r)}var i}function di(n,e,t){if((e=mn(e))instanceof nr)return e._internalPath;if("string"==typeof e)return ks(n,e);throw Ms("Field path arguments must be of type string or ",n,!1,void 0,t)}const sE=new RegExp("[~\\*/\\[\\]]");function ks(n,e,t){if(e.search(sE)>=0)throw Ms(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new nr(...e.split("."))._internalPath}catch{throw Ms(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Ms(n,e,t,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(s||o)&&(u+=" (found",s&&(u+=` in field ${r}`),o&&(u+=` in document ${i}`),u+=")"),new I(g.INVALID_ARGUMENT,a+n+u)}function cm(n,e){return n.some(t=>t.isEqual(e))}class hc{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new le(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new oE(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Os("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class oE extends hc{data(){return super.data()}}function Os(n,e){return"string"==typeof e?ks(n,e):e instanceof nr?e._internalPath:e._delegate._internalPath}function lm(n){if("L"===n.limitType&&0===n.explicitOrderBy.length)throw new I(g.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class uE{convertValue(e,t="none"){switch(bt(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ae(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(dt(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw P()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return Rt(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertGeoPoint(e){return new ic(ae(e.latitude),ae(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=Xi(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Or(e));default:return null}}convertTimestamp(e){const t=Pt(e);return new se(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=U.fromString(e);x(Sd(r));const i=new Zt(r.get(1),r.get(3)),s=new w(r.popFirst(5));return i.isEqual(t)||ue(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function fc(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class hn{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class sr extends hc{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Us(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Os("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class Us extends sr{data(e={}){return super.data(e)}}class or{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new hn(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Us(this._firestore,this._userDataWriter,r.key,r,new hn(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new I(g.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(a=>({type:"added",doc:new Us(i._firestore,i._userDataWriter,a.doc.key,a.doc,new hn(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter),oldIndex:-1,newIndex:o++}))}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(a=>s||3!==a.type).map(a=>{const u=new Us(i._firestore,i._userDataWriter,a.doc.key,a.doc,new hn(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);let c=-1,l=-1;return 0!==a.type&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),1!==a.type&&(o=o.add(a.doc),l=o.indexOf(a.doc.key)),{type:lE(a.type),doc:u,oldIndex:c,newIndex:l}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function lE(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return P()}}class Ft extends uE{constructor(e){super(),this.firestore=e}convertBytes(e){return new cn(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new le(this.firestore,null,t)}}function mi(n,e){return function(r,i){const s=new fe;return r.asyncQueue.enqueueAndForget((0,_.Z)(function*(){return function II(n,e,t){return Ru.apply(this,arguments)}(yield function Yu(n){return Vs(n).then(e=>e.syncEngine)}(r),i,s)})),s.promise}(he(n),e)}!function(e,t=!0){An="10.7.2",vi(new ur("firestore",(r,{instanceIdentifier:i,options:s})=>{const o=r.getProvider("app").getImmediate(),a=new ee(new Wg(r.getProvider("auth-internal")),new Jg(r.getProvider("app-check-internal")),function(c,l){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new I(g.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Zt(c.options.projectId,l)}(o,i),o);return s=Object.assign({useFetchStreams:t},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),pn(eh,"4.4.1",e),pn(eh,"4.4.1","esm2017")}();var bE=Z(8645),xE=Z(9212);let CE=(()=>{var n;class e{constructor(){var r=this;this.firebase=Vc(Se.N.firebaseConfig),this.database=eE(this.firebase),this.collections$={},this.collections={},this.subs=[],this.subscription=function(){var i=(0,_.Z)(function*(s,o){return function pE(n,...e){var t,r,i;n=mn(n);let s={includeMetadataChanges:!1},o=0;"object"!=typeof e[o]||rc(e[o])||(s=e[o],o++);const a={includeMetadataChanges:s.includeMetadataChanges};if(rc(e[o])){const h=e[o];e[o]=null===(t=h.next)||void 0===t?void 0:t.bind(h),e[o+1]=null===(r=h.error)||void 0===r?void 0:r.bind(h),e[o+2]=null===(i=h.complete)||void 0===i?void 0:i.bind(h)}let u,c,l;if(n instanceof le)c=G(n.firestore,ee),l=Vn(n._key.path),u={next:h=>{e[o]&&e[o](function mc(n,e,t){const r=t.docs.get(e._key),i=new Ft(n);return new sr(n,i,e._key,r,new hn(t.hasPendingWrites,t.fromCache),e.converter)}(c,n,h))},error:e[o+1],complete:e[o+2]};else{const h=G(n,Pe);c=G(h.firestore,ee),l=h._query;const d=new Ft(c);u={next:p=>{e[o]&&e[o](new or(c,d,h,p))},error:e[o+1],complete:e[o+2]},lm(n._query)}return function(d,p,E,A){const T=new xs(A),V=new Eu(p,T,E);return d.asyncQueue.enqueueAndForget((0,_.Z)(function*(){return pu(yield tr(d),V)})),()=>{T.La(),d.asyncQueue.enqueueAndForget((0,_.Z)(function*(){return _u(yield tr(d),V)}))}}(he(c),l,a,u)}(tc(r.database,s.toLowerCase()),u=>{o&&o(s)})});return function(s,o){return i.apply(this,arguments)}}()}ngOnDestroy(){this.subs.forEach(r=>r.Unsubscribe())}getCollection(r){return this.collections[r]||this.subscriptionCreate(r),this.collections[r]}subscriptionCreate(r){this.collections$[r]=new bE.x,this.collections[r]=this.collections$[r].asObservable(),this.subs.push(this.subscription(r,()=>{this.updateCollection(r)}))}updateCollection(r){var i=this;return(0,_.Z)(function*(){i.collections$[r].next(yield i.getAllDocuments(r))})()}addNewDocument(r,i){var s=this;return(0,_.Z)(function*(){try{return yield function mE(n,e){const t=G(n.firestore,ee),r=nc(n),i=fc(n.converter,e);return mi(t,[sc(rr(n.firestore),"addDoc",r._key,i,null!==n.converter,{}).toMutation(r._key,ie.exists(!1))]).then(()=>r)}(tc(s.database,r),i)}catch(o){return console.error("Error adding document: ",o),null}})()}setDocument(r,i,s){var o=this;return(0,_.Z)(function*(){try{const a=nc(o.database,r,i);return yield function dE(n,e,t){n=G(n,le);const r=G(n.firestore,ee),i=fc(n.converter,e,t);return mi(r,[sc(rr(r),"setDoc",n._key,i,null!==n.converter,t).toMutation(n._key,ie.none())])}(a,s)}catch(a){return console.error("error setting document: ",a),null}})()}getAllDocuments(r){var i=this;return(0,_.Z)(function*(){try{const s=[];return(yield function hE(n){n=G(n,Pe);const e=G(n.firestore,ee),t=he(e),r=new Ft(e);return lm(n._query),function zf(n,e,t={}){const r=new fe;return n.asyncQueue.enqueueAndForget((0,_.Z)(function*(){return function(s,o,a,u,c){const l=new xs({next:d=>{o.enqueueAndForget(()=>_u(s,h)),d.fromCache&&"server"===u.source?c.reject(new I(g.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(d)},error:d=>c.reject(d)}),h=new Eu(a,l,{includeMetadataChanges:!0,Z_:!0});return pu(s,h)}(yield tr(n),n.asyncQueue,e,t,r)})),r.promise}(t,n._query).then(i=>new or(e,r,n,i))}(tc(i.database,r))).forEach(a=>{s.push({id:a.id,...a.data()})}),s}catch(s){return console.error("Error getting documents: ",s),null}})()}deleteDocument(r,i){var s=this;return(0,_.Z)(function*(){try{const o=nc(s.database,r,i);return yield function fE(n){return mi(G(n.firestore,ee),[new Fn(n._key,ie.none())])}(o)}catch(o){return console.error("Error deleting document: ",o),null}})()}}return(n=e).\u0275fac=function(r){return new(r||n)},n.\u0275prov=xE.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),e})()},6208:(zs,Lt,Z)=>{Z.d(Lt,{m:()=>Bt});var _=Z(6814),Se=Z(95),f=Z(451),yt=Z(9212);let Bt=(()=>{var be;class je{}return(be=je).\u0275fac=function(Je){return new(Je||be)},be.\u0275mod=yt.oAB({type:be}),be.\u0275inj=yt.cJS({imports:[f.Pc,_.ez,Se.u5]}),je})()}}]);